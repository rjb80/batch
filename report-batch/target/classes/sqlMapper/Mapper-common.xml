<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="common">

		  <select id="select_date"  resultType="HashMap">
			select ymd
			from copy_ymd
			where ymd between #{as_from_dt} and #{as_to_dt} 		  
		  </select>
	
	
		  <select id="select_sysdate"  resultType="HashMap">
		
		    SELECT to_char(sysdate,'YYYYMMDDHH24MISS') sysdt
		    from dual
	
		 </select> 	  		
	
	  <select id="select_order_cancel_list"  resultType="java.util.LinkedHashMap">
			  <![CDATA[
			  
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.order_id beq_order_id
					,b.order_seq beq_order_seq
					,'취소' status
					,to_char(to_timestamp(a.efF_sta_dt,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') created_at
					from rmords a,rmordd b,rmordm c
					where a.efF_sta_dt between #{as_from_dt} || '000000' and #{as_to_dt} || '235959'
					and a.eff_end_Dt ='99991231235959'
					and a.status_cd='16' 
					and b.order_ret_gb <> '15'
					and a.order_id = b.order_id
					and a.order_seq = b.order_seq
					and a.order_id = c.order_id
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
					
					
					union all 
					
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.order_id beq_order_id
					,b.order_seq beq_order_seq
					,'취소' status
					,to_char(to_timestamp(a.efF_sta_dt,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') created_at
					from rmords a,rmordd b,rmordm c
					where a.efF_sta_dt between #{as_from_dt} || '000000' and #{as_to_dt} || '235959'
					and a.eff_end_Dt ='99991231235959'
					and a.status_cd in ('13','14') 
					and b.order_ret_gb <> '15'
					and a.order_id = b.order_id
					and a.order_seq = b.order_seq
					and a.order_id = c.order_id
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
					
			  
			  
			  ]]>
	  </select>	
	
	  <select id="select_return_cancel_list"  resultType="java.util.LinkedHashMap">
			  <![CDATA[
			  
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.bef_order_id beq_order_id
					,b.bef_order_seq beq_order_seq
					,'반품취소' status
					,to_char(to_timestamp(b.reg_dt,'YYYYMMDDHH24MISS') ,'YYYY-MM-DD HH24:MI:SS') created_at
					from rmordd b,rmordm c
					where b.order_dt between #{as_from_dt} and #{as_to_dt}
					and b.order_ret_gb like '2%'
					and b.order_ret_gb <> '25'
					and b.order_id = c.order_id
					and b.status_cd='25'
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
					
					
					
					union all 
					
					
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.bef_order_id beq_order_id
					,b.bef_order_seq beq_order_seq
					,'반품취소' status
					,to_char(to_timestamp(b.reg_dt,'YYYYMMDDHH24MISS') ,'YYYY-MM-DD HH24:MI:SS') created_at
					from rmordd b,rmordm c
					where b.order_dt between #{as_from_dt} and #{as_to_dt}
					and b.order_ret_gb like '2%'
					and b.order_ret_gb <> '25'
					and b.order_id = c.order_id
					and b.status_cd='31'
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
					
			  
			  	
			  ]]>
	  </select>
	
	
		  <select id="select_return_comp_list"  resultType="java.util.LinkedHashMap">
			  <![CDATA[
			  
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.bef_order_id beq_order_id
					,b.bef_order_seq beq_order_seq
					,'반품완료' status
					,to_char(to_timestamp(b.reg_dt,'YYYYMMDDHH24MISS') ,'YYYY-MM-DD HH24:MI:SS') created_at
					from rmordd b,rmordm c
					where b.order_dt between #{as_from_dt} and #{as_to_dt}
					and b.order_ret_gb like '2%'
					and b.order_ret_gb <> '25'
					and b.order_id = c.order_id
					and b.status_cd='24'
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
					
					
					union all 
					
					
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.bef_order_id beq_order_id
					,b.bef_order_seq beq_order_Seq
					,'반품완료' status
					,to_char(to_timestamp(b.reg_dt,'YYYYMMDDHH24MISS') ,'YYYY-MM-DD HH24:MI:SS') created_at
					from rmordd b,rmordm c
					where b.order_dt between #{as_from_dt} and #{as_to_dt}
					and b.order_ret_gb like '2%'
					and b.order_ret_gb <> '25'
					and b.order_id = c.order_id
					and b.status_cd='33'
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
			  
			  
			  ]]>
		  
		  </select>	
		  
		  
		  <select id="select_return_list"  resultType="java.util.LinkedHashMap">
			  <![CDATA[
								  
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.bef_order_id beq_order_id
					,b.bef_order_seq beq_order_seq
					,'반품접수' status
					,to_char(to_timestamp(b.reg_dt,'YYYYMMDDHH24MISS') ,'YYYY-MM-DD HH24:MI:SS') created_at
					from rmordd b,rmordm c
					where b.order_dt between #{as_from_dt} and #{as_to_dt}
					and b.order_ret_gb like '2%'
					and b.order_ret_gb <> '25'
					and b.order_id = c.order_id
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
					
					
					
					
					union all
					
					select /*+ index(a RMORDS_IND3) ordered use_nl(a b c) */
					b.bef_order_id beq_order_id
					,b.bef_order_seq beq_order_seq
					,'반품접수' status
					,to_char(to_timestamp(b.reg_dt,'YYYYMMDDHH24MISS')  ,'YYYY-MM-DD HH24:MI:SS') created_at
					from rmordd b,rmordm c
					where b.order_dt between #{as_from_dt} and #{as_to_dt}
					and b.order_ret_gb like '2%'
					and b.order_ret_gb <> '25'
					and b.order_id = c.order_id
					and c.site_gb like #{as_service_gb}
					and b.site_gb like #{as_site_gb}
			  
			  ]]>
		  
		  </select>			  
	
		  <select id="select_ship_2018_list"  resultType="java.util.LinkedHashMap">
		  <![CDATA[ 		  
				select aa.site_gb 
				,aa.site_nm site
				,aa.order_id beq_order_id
				,aa.order_seq beq_order_seq
				,'출고' status
				,aa.DISP_B_CATEGORY_NM large_category
				,aa.DISP_M_CATEGORY_NM medium_category
				,aa.DISP_S_CATEGORY_NM small_category
				,aa.contact_site purchase_site
				,aa.join_nm affiliate
				,nvl(aa.assort_model_n,'*') assort_model_n
				,aa.vd_nm account
				,aa.brand_id_n brand_id
				,aa.brand_nm brand
				,aa.brand_enm
				,aa.assort_id_n product_code
				,aa.assort_nm_n product
				,aa.assort_model_n
				,aa.user_nm md
				,aa.order_QTY quantity
				,aa.ORDER_DISCOUNT           
				,aa.SALE_COST                
				,aa.CUSTOMS_TAX              
				,aa.NOPAY_AMT                
				,aa.SALE_RATE                
				,aa.SALE_TRAN                
				,aa.SALE_ITEM                
				,aa.SALE_EXCEPT_ITEM         
				,aa.SALE_TOTAL   
				,round ( aa.sale_total / aa.order_discount , 4) * 100 sale_total_rate            
				,aa.COST_ITEM                
				,aa.COST_TRAN                
				,aa.COST_SORTING_FEE         
				,aa.FIX_SORTING_FEE          
				,aa.COST_GSM_CARD_FEE         
				,aa.coupon_amt
				,aa.point_amt
				,aa.sun_SALE_TOTAL
				,round ( sun_sale_total / order_discount , 4) * 100 sun_sale_total_rate
				,aa.c1 company
				,aa.c2 sales
				,aa.c3 marketing
				,aa.c4 operation
				,aa.c5 address
				,aa.c6 employee
				,aa.bb1 coupon_total
				,aa.b4 coupon_sales_marketing
				,aa.coupon_amt_set
				,aa.VD_INTERNATIONAL_GB
				,nvl(aa.VD_SELLER_GB,'*') VD_SELLER_GB       
				,nvl(aa.VD_GB     ,'*') VD_GB
				,aa.MOBILE_ORDER_YN  
				,sun_sale_total - (  cost_item +  cost_tran +  cost_sorting_fee +  fix_sorting_fee ) sale_profit
				,round ( (sun_sale_total - (  cost_item +  cost_tran +  cost_sorting_fee +  fix_sorting_fee )) / order_discount , 4) * 100 sale_profit_rate
				,to_char(to_timestamp(aa.apply_day || aa.apply_time,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') created_at
				
				from (
				SELECT  /* d_ac110801lp_master_3 : 판매실적(GMS)*/
				        MAX(A.SITE_GB)                          AS  SITE_GB,                    /*사이트구분*/
				        A.VENDOR_ID                             AS  VENDOR_ID,                  /*사이트구분*/
				        MAX(A.SITE_NM)                          AS  SITE_NM,                    /*사이트명*/
				        A.DISP_B_CATEGORY_NM                    AS  DISP_B_CATEGORY_NM,         /*카테고리대분류*/
				        A.DISP_M_CATEGORY_NM                    AS  DISP_M_CATEGORY_NM,         /*카테고리중분류*/
				        A.DISP_S_CATEGORY_NM                    AS  DISP_S_CATEGORY_NM,         /*카테고리소분류*/
				        decode(a.contact_site,'10','WIZWID','20','SKINRX','30','HAUOLIN','40','SPORTS25')      as contact_site,
				        a.join_nm,
				         a.vendor_id_n,
				         a.brand_id_n,                 
				         (select max(x.brand_knm) from itbrnd x where x.brand_id = a.brand_id_n) brand_nm,
				         (select max(x.brand_enm) from itbrnd x where x.brand_id = a.brand_id_n) brand_enm,
				         a.assort_id_n,        
				 a.assort_nm_n,
				 a.assort_model_n,
				         (select y.user_nm from itasrt x,cmuser y where x.assort_id = a.assort_id_n and x.user_id = y.user_id) user_nm,
				        SUM(A.CNT)                              AS  CNT,                        /*전체건수*/
				        SUM(A.QTY)                              AS  QTY,                        /*전체수량*/
				        SUM(A.SHIP_CNT)                         AS  SHIP_CNT,                   /*출고건수 : 소팅피 계산시 사용*/
				        SUM(A.QTY_CHGO)                         AS  QTY_CHGO,                   /*출고수량*/
				        SUM(A.QTY_IPGO)                         AS  QTY_IPGO,                   /*반품수량*/
				        SUM(A.QTY_CHGO) + SUM(A.QTY_IPGO)       AS  order_QTY,        
				        SUM(A.ORDER_DISCOUNT_CHGO)              AS  ORDER_DISCOUNT_CHGO,        /*출고금액*/
				        SUM(A.ORDER_DISCOUNT_IPGO)              AS  ORDER_DISCOUNT_IPGO,        /*반품금액*/
				        SUM(A.ORDER_DISCOUNT)                   AS  ORDER_DISCOUNT,             /*GMS*/
				        SUM(A.SALE_COST)                        AS  SALE_COST,                  /*샵물대 또는 상품원가*/
				        SUM(A.CUSTOMS_TAX)                      AS  CUSTOMS_TAX,                /*관세등*/
				        SUM(A.NOPAY_AMT)                        AS  NOPAY_AMT,                  /*업체물대*/
				        SUM(A.SALE_RATE)                        AS  SALE_RATE,                  /*수수료매출*/
				        SUM(A.SALE_TRAN)                        AS  SALE_TRAN,                  /*운송매출*/
				        SUM(A.SALE_ITEM)                        AS  SALE_ITEM,                  /*상품매출*/
				        SUM(A.SALE_EXCEPT_ITEM)                 AS  SALE_EXCEPT_ITEM,           /*매출제외금액*/
				        SUM(A.SALE_TOTAL)                       AS  SALE_TOTAL,                 /*매출총액*/
				        SUM(A.COST_ITEM)                        AS  COST_ITEM,                  /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
				        SUM(A.COST_TRAN)                        AS  COST_TRAN,                  /*운송매출원가 - 국제운송원가*/
				        SUM(A.COST_SORTING_FEE)                 AS  COST_SORTING_FEE,           /*운송매출원가 - SORTING FEE*/
				        SUM(A.FIX_SORTING_FEE)                  AS  FIX_SORTING_FEE,            /*운송매출원가 - 고정비*/
				        SUM(A.COST_GSM_CARD_FEE)                AS  COST_GSM_CARD_FEE           /*구매대행매출원가 - GSM 카드결제 수수료*/
				        ,sum(nvl(a.coupon_amt,0) + nvl(a.coupon_amt_minus,0)) coupon_amt
				        ,sum(nvl(a.point_amt,0) + nvl(a.point_amt_minus,0)) point_amt
				         ,apply_day
				         ,apply_time
				        , a.order_id ,a.order_seq
				, SUM(A.SALE_TOTAL)  - (sum(nvl(cc3,0) + nvl(cc4,0))   +   sum(nvl(cc5,0) + nvl(cc6,0))   +   sum(nvl(cc7,0) + nvl(cc8,0))   +   sum(nvl(cc9,0) + nvl(cc10,0))  ) -  (sum(nvl(a.point_amt,0) + nvl(a.point_amt_minus,0)))                    AS  sun_SALE_TOTAL
				,sum(nvl(cc1,0) + nvl(cc2,0)) c1
				,sum(nvl(cc3,0) + nvl(cc4,0)) c2
				,sum(nvl(cc5,0) + nvl(cc6,0)) c3
				,sum(nvl(cc7,0) + nvl(cc8,0)) c4
				,sum(nvl(cc9,0) + nvl(cc10,0)) c5
				,sum(nvl(cc11,0) + nvl(cc12,0)) c6
				,sum(nvl(bb1,0) + nvl(bb2,0)) bb1
				,sum(nvl(cc3,0) + nvl(cc4,0)) + sum(nvl(cc5,0) + nvl(cc6,0)) + sum(nvl(cc7,0) + nvl(cc8,0)) + sum(nvl(cc9,0) + nvl(cc10,0)) b4
				,sum( nvl(coupon_amt_set,0) + nvl(coupon_amt_minus_set,0) ) coupon_amt_set
				,b.vd_nm
				,decode(b.VD_INTERNATIONAL_GB,'03','03','') VD_INTERNATIONAL_GB
				,b.VD_SELLER_GB       
				,b.VD_GB     
				,decode(a.MOBILE_ORDER_YN,'01','WEB','02','MOBILE','03','APP') MOBILE_ORDER_YN         
				FROM    (
				        SELECT  /* d_ac110801lp_master_3 : 판매실적(GMS)*/
				                MAX(A.SITE_GB)                          AS  SITE_GB,                    /*사이트구분*/
				                A.VENDOR_ID                             AS  VENDOR_ID,                  /*사이트구분*/
				                MAX(A.SITE_NM)                          AS  SITE_NM,                    /*사이트명*/
				                A.DISP_CATEGORY_ID                      AS  DISP_CATEGORY_ID,           /*부서코드*/
				/*                (SELECT CATEGORY_NM
				                 FROM ITCATG
				                 WHERE LVL = '1'
				                 START WITH CATEGORY_ID = A.DISP_CATEGORY_ID
				                 CONNECT BY PRIOR UP_CATEGORY_ID = CATEGORY_ID
				                 ) DISP_B_CATEGORY_NM,
				               (SELECT CATEGORY_NM
				                 FROM ITCATG
				                 WHERE LVL = '2'
				                 START WITH CATEGORY_ID = A.DISP_CATEGORY_ID
				                 CONNECT BY PRIOR UP_CATEGORY_ID = CATEGORY_ID
				                 ) DISP_M_CATEGORY_NM,
				               (SELECT CATEGORY_NM
				                 FROM ITCATG
				                 WHERE LVL = '3'
				                 START WITH CATEGORY_ID = A.DISP_CATEGORY_ID
				                 CONNECT BY PRIOR UP_CATEGORY_ID = CATEGORY_ID
				                 ) DISP_S_CATEGORY_NM,*/
				                FIT0017P(A.DISP_CATEGORY_ID,1,'02') DISP_B_CATEGORY_NM,
				                FIT0017P(A.DISP_CATEGORY_ID,2,'02') DISP_M_CATEGORY_NM,
				                FIT0017P(A.DISP_CATEGORY_ID,3,'02') DISP_S_CATEGORY_NM,
				                 a.contact_site,
				                 a.join_nm,
				                 a.vendor_id_n,
				                 a.brand_id_n,
				                 a.assort_id_n,
				                 a.assort_nm_n,
				                 a.assort_model_n,
				                SUM(A.CNT)                              AS  CNT,                        /*전체건수*/
				                SUM(A.QTY)                              AS  QTY,                        /*전체수량*/
				                SUM(A.SHIP_CNT)                         AS  SHIP_CNT,                   /*출고건수 : 소팅피 계산시 사용*/
				                SUM(A.QTY_CHGO)                         AS  QTY_CHGO,                   /*출고수량*/
				                SUM(A.QTY_IPGO)                         AS  QTY_IPGO,                   /*반품수량*/
				                SUM(A.ORDER_DISCOUNT_CHGO)              AS  ORDER_DISCOUNT_CHGO,        /*출고금액*/
				                SUM(A.ORDER_DISCOUNT_IPGO)              AS  ORDER_DISCOUNT_IPGO,        /*반품금액*/
				                SUM(A.ORDER_DISCOUNT)                   AS  ORDER_DISCOUNT,             /*GMS*/
				                SUM(A.SALE_COST)                        AS  SALE_COST,                  /*샵물대 또는 상품원가*/
				                SUM(A.CUSTOMS_TAX)                      AS  CUSTOMS_TAX,                /*관세등*/
				                SUM(A.NOPAY_AMT)                        AS  NOPAY_AMT,                  /*업체물대*/
				                SUM(A.SALE_RATE)                        AS  SALE_RATE,                  /*수수료매출*/
				                SUM(A.SALE_TRAN)                        AS  SALE_TRAN,                  /*운송매출*/
				                SUM(A.SALE_ITEM)                        AS  SALE_ITEM,                  /*상품매출*/
				                SUM(A.SALE_EXCEPT_ITEM)                 AS  SALE_EXCEPT_ITEM,           /*매출제외금액*/
				                SUM(A.SALE_TOTAL)                       AS  SALE_TOTAL,                 /*매출총액*/
				                SUM(A.COST_ITEM)                        AS  COST_ITEM,                  /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
				                SUM(A.COST_TRAN)                        AS  COST_TRAN,                  /*운송매출원가 - 국제운송원가*/
				                SUM(A.COST_SORTING_FEE)                 AS  COST_SORTING_FEE,           /*운송매출원가 - SORTING FEE*/
				                SUM(A.FIX_SORTING_FEE1)                 AS  FIX_SORTING_FEE,            /*운송매출원가 - 고정비*/
				                SUM(A.COST_GSM_CARD_FEE)                AS  COST_GSM_CARD_FEE           /*구매대행매출원가 - GSM 카드결제 수수료*/
				                , a.order_id ,a.order_seq
				                ,(
				                select sum(b.amt_real)
				                from rmdmdl b
				                where b.order_id = a.order_id
				                and b.order_seq = a.order_seq
				                and b.pay_cd ='13'
				                and b.INOUT_GB = '01'
				                ) coupon_amt
				                ,(
				                select sum(b.amt_real)
				                from rmdmdl b
				                where b.order_id = a.order_id
				                and b.order_seq = a.order_seq
				                and b.pay_cd ='10'
				                and b.INOUT_GB = '01'
				                ) point_amt    
				                ,(
				                select sum(c.amt_real)
				                from rmordd b,rmdmdl c
				                where b.order_id = a.order_id
				                and b.order_seq = a.order_seq
				                and b.bef_order_id = c.order_id
				                and b.bef_order_seq = c.order_seq
				                and c.pay_cd ='13'
				                and c.INOUT_GB = '02'
				                ) coupon_amt_minus
				                ,(
				                select sum(c.amt_real)
				                from rmordd b,rmdmdl c
				                where b.order_id = a.order_id
				                and b.order_seq = a.order_seq
				                and b.bef_order_id = c.order_id
				                and b.bef_order_seq = c.order_seq
				                and c.pay_cd ='10'
				                and c.INOUT_GB = '02'
				                ) point_amt_minus                
				                ,a.apply_day
				                ,a.apply_time
				
				   ,(
				                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and aa.order_ret_gb like '1%'
				                ) bb1
				                ,(
				                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                and aa.order_ret_gb like '2%'
				                 ) bb2
				                ,(
				                select sum(b.amt_real *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmdmdl b
				                where aa.order_id = a.order_id
				                and aa.order_seq = a.order_seq
				                and aa.order_ret_gb like '1%'
				                and b.order_id = aa.order_id
				                and b.order_seq = decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq)
				                and b.pay_cd ='13'
				                and b.INOUT_GB = '01'
				                and aa.set_gb ='04'
				                ) coupon_amt_set
				                ,(
				                select sum(c.amt_real * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd b,rmordd aa,rmdmdl c
				                where b.order_id = a.order_id
				                and b.order_seq = a.order_seq
				                and b.order_ret_gb like '2%'
				                and b.bef_order_id = aa.order_id
				                and b.bef_order_seq = aa.order_seq
				                and aa.order_id = c.order_id
				                and decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = c.order_seq
				                and c.pay_cd ='13'
				                and c.INOUT_GB = '02'
				                and b.set_gb ='04'
				                ) coupon_amt_minus_set
				                
				                ,(
				                select sum(bb.vendor_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and  bb.md_gb='01'
				                and aa.order_ret_gb like '1%'
				                ) cc1
				                ,(
				                select sum(bb.vendor_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                 and  bb.md_gb='01'
				                and aa.order_ret_gb like '2%'
				                 ) cc2    
				                 
				                ,(
				                select sum(bb.burden_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and  bb.md_gb='01'
				                and aa.order_ret_gb like '1%'
				                ) cc3
				                ,(
				                select sum(bb.burden_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                 and  bb.md_gb='01'
				                and aa.order_ret_gb like '2%'
				                 ) cc4         
				                 
				               ,(
				                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and  bb.md_gb in ('02','03')
				                and aa.order_ret_gb like '1%'
				                ) cc5
				                ,(
				                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                and  bb.md_gb in ('02','03')
				                and aa.order_ret_gb like '2%'
				                 ) cc6      
				               ,(
				                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and  bb.md_gb in ('04')
				                and aa.order_ret_gb like '1%'
				                ) cc7
				                ,(
				                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                and  bb.md_gb in ('04')
				                and aa.order_ret_gb like '2%'
				                 ) cc8                                                 
				               ,(
				                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and  bb.md_gb in ('05')
				                and aa.order_ret_gb like '1%'
				                ) cc9
				                ,(
				                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                and  bb.md_gb in ('05')
				                and aa.order_ret_gb like '2%'
				                 ) cc10       
				              ,(
				                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq = a.order_seq
				                and  aa.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
				                and  bb.md_gb in ('06')
				                and aa.order_ret_gb like '1%'
				                ) cc11
				                ,(
				                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
				                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
				                where aa.order_id = a.order_id
				                and  aa.order_seq =a.order_seq
				                and aa.bef_order_id = cc.order_id
				                and aa.bef_order_seq = cc.order_seq
				                and  cc.order_id = bb.order_id
				                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
				                and  bb.md_gb in ('06')
				                and aa.order_ret_gb like '2%'
				                 ) cc12                             
				                   ,(select aa.MOBILE_ORDER_YN from rmordm aa where aa.order_id = a.order_id) MOBILE_ORDER_YN                            
				        FROM    (
				                SELECT  A.SITE_GB,
				                        A.VENDOR_ID,
				                        A.SITE_NM,
				                        A.STORAGE_ID,
				                        A.DATA_GB,
				                        A.DISP_CATEGORY_ID,
				                        A.CNT,
				                        A.QTY,
				                        A.SHIP_CNT,
				                        A.NOSET_QTY_CHGO + (A.SET_QTY_CHGO/2) QTY_CHGO,
				                        A.NOSET_QTY_IPGO + (A.SET_QTY_IPGO/2) QTY_IPGO,
				                        A.ORDER_DISCOUNT_CHGO,
				                        A.ORDER_DISCOUNT_IPGO,
				                        A.ORDER_DISCOUNT,
				                        A.SALE_COST,
				                        A.CUSTOMS_TAX,
				                        A.NOPAY_AMT,
				                        ROUND(A.SALE_RATE/1.1)      AS  SALE_RATE,
				                        A.SALE_TRAN                 AS  SALE_TRAN,
				                        ROUND(A.SALE_ITEM/1.1)      AS  SALE_ITEM,
				                        A.SALE_EXCEPT_ITEM                                              AS  SALE_EXCEPT_ITEM,
				                        ROUND(A.SALE_RATE/1.1) + A.SALE_TRAN + ROUND(A.SALE_ITEM/1.1)   AS  SALE_TOTAL,
				                        A.COST_ITEM,                                                        /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
				                        A.COST_TRAN,                                                        /*운송매출원가 - 국제운송원가*/
				                        A.COST_SORTING_FEE,                                                 /*운송매출원가 - SORTING FEE*/
				                        A.FIX_SORTING_FEE,                                                  /*운송매출원가 - 고정 SORTING FEE*/
				                        SUM(CASE WHEN A.STORAGE_ID <> 'MALL' AND ( SUBSTR(A.DATA_GB, 1, 2) = '11' OR SUBSTR(A.DATA_GB, 1, 2) = '12' OR SUBSTR(A.DATA_GB, 1, 2) = '14') THEN A.SHIP_CNT
				                                                ELSE 0
				                                                END ) OVER (PARTITION BY A.STORAGE_ID) FIX_SHIP_CNT,
				                        ROUND(A.FIX_SORTING_FEE / DECODE(SUM(CASE WHEN A.STORAGE_ID <> 'MALL' AND ( SUBSTR(A.DATA_GB, 1, 2) = '11' OR SUBSTR(A.DATA_GB, 1, 2) = '12' OR SUBSTR(A.DATA_GB, 1, 2) = '14') THEN A.SHIP_CNT
				                                                         ELSE 0
				                                                         END ) OVER (PARTITION BY A.STORAGE_ID), 0, 1, SUM(  CASE WHEN A.STORAGE_ID <> 'MALL' AND ( SUBSTR(A.DATA_GB, 1, 2) = '11' OR SUBSTR(A.DATA_GB, 1, 2) = '12' OR SUBSTR(A.DATA_GB, 1, 2) = '14') THEN A.SHIP_CNT
				                                                                                                             ELSE 0
				                                                                                                             END ) OVER (PARTITION BY A.STORAGE_ID))
				                        ) FIX_SORTING_FEE1,
				                        CASE WHEN A.SITE_GB = '22' OR A.SITE_GB = '24' OR A.SITE_GB = '26' OR A.SITE_GB = '28' THEN 0
				                        ELSE (SELECT    TO_NUMBER(CD_REF1)  FROM    CMCODE WHERE    CD_MAJOR = '0619' AND #{as_to_dt}||'000000' BETWEEN CD_STA_DT AND CD_END_DT AND CD_MINOR <> '00')
				                        END * (ROUND(A.SALE_RATE/1.1) + A.SALE_TRAN + ROUND(A.SALE_ITEM/1.1)) COST_GSM_CARD_FEE ,    /*구매대행매출원가 - GSM 카드결제 수수료*/
				                        a.contact_site,
				                        a.join_nm,
				                        a.vendor_id_n vendor_id_n,
				                        a.brand_id_n brand_id_n,
				                        a.assort_id_n assort_id_n,
				                        a.assort_nm_n assort_nm_n
				                        ,a.assort_model_n
				                        ,a.order_id ,a.order_seq
				                     ,a.apply_day
				                     ,a.apply_time
				                FROM    (
				                        SELECT  /*+ ORDERED USE_NL(X Y) USE_HASH(Z, A, B, C) */
				                                X.SITE_GB                   AS SITE_GB,
				                                MAX(B.CD_REF1)              AS VENDOR_ID,
				                                MAX(B.CD_FNAME)             AS SITE_NM,
				                                X.O_STORAGE_ID              AS STORAGE_ID,
				                                X.DATA_GB                   AS DATA_GB,
				                                Z.DISP_CATEGORY_ID          AS DISP_CATEGORY_ID,
				                                x.contact_site              as contact_site,
				                                NVL((select join_nm 
				                                from   MKJONM MK 
				                                where  MK.join_id    = x.join_id 
				                                AND    MK.balance_gb = '02'
				                                and    MK.adjst_cd   = '05'
				                                and    MK.join_path  = '01'
				                                and    MK.join_type  IN ('03','13')
				                                and    MK.up_join_id = '*'
				                                ),'WIZWID') join_nm,      
				                                z.vendor_id vendor_id_n,
				                                z.brand_id brand_id_n,
				                                z.assort_id assort_id_n ,                                                         
				                                z.assort_nm assort_nm_n ,
				                                z.assort_model assort_model_n,
				                                /*x.join_id                   as join_id,*/
				                                SUM(ABS(X.QTY))             AS CNT,
				                                SUM(X.QTY)                  AS QTY,
				                                SUM(1/CNT)                  AS SHIP_CNT,
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 1, X.QTY, 0), 0))     AS NOSET_QTY_CHGO,      /*출고*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 1, X.QTY, 0), 0))     AS NOSET_QTY_IPGO,      /*반품*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 1, 0, X.QTY), 0))     AS SET_QTY_CHGO,        /*출고*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 1, 0, X.QTY), 0))     AS SET_QTY_IPGO,        /*반품*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_CHGO,     /*출고*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_IPGO,     /*반품*/
				                                SUM(X.ORDER_DISCOUNT)       AS ORDER_DISCOUNT,
				                                SUM(X.SALE_COST)            AS SALE_COST,
				                                SUM(X.CUSTOMS_TAX)          AS CUSTOMS_TAX,
				                                SUM(X.NOPAY_AMT)            AS NOPAY_AMT,
				                                SUM(X.SALE_RATE)            AS SALE_RATE,
				                                SUM(X.SALE_TRAN)            AS SALE_TRAN,
				                                SUM(X.SALE_ITEM)            AS SALE_ITEM,
				                                SUM(X.NOPAY_AMT + DECODE(SUBSTR(DATA_GB,1,2), '11', X.SALE_COST, 0) + X.CUSTOMS_TAX) AS SALE_EXCEPT_ITEM,   /*샵은 정상출고일때만 상품대를 매출제외금액에 포함.*/
				                                ROUND(SUM(X.SUM_WEIGHT))    AS SUM_WEIGHT,
				                                TRUNC(SUM(X.COST_TRAN))     AS COST_TRAN,
				                                SUM(DECODE(SUBSTR(X.DATA_GB,1,2), '13', X.SALE_COST, '14', X.SALE_COST, '26', X.SALE_COST,  '28', X.SALE_COST, 0)) COST_ITEM,   /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
				                                SUM(X.BASERATE * X.COST_SORTING_FEE * 1/CNT) COST_SORTING_FEE,                                              /*운송매출원가 - SORTING FEE*/
				                                SUM(X.BASERATE * X.FIX_SORTING_FEE * X.DATE_CNT * 1/CNT)  FIX_SORTING_FEE,
				                                MAX(X.DATE_CNT) DATE_CNT
				                                , x.order_id,x.order_seq
				                             ,x.apply_day
				                             ,x.apply_time
				                        FROM    (
				                                    SELECT /*+ ORDERED USE_HASH(B, C, D) FULL(D) */
				                                           /* SHOP 사전 정상출고 */
				                                           '11.SHOP 사전 정상출고' DATA_GB,
				                                           FLS0039P(ORDER_ID, ORDER_SEQ, ASSORT_ID) ORDER_DT,
				                                           SITE_GB,
				                                           ORDER_ID,
				                                           ORDER_SEQ,
				                                           APPLY_DAY,
				                                           apply_time,
				                                           DEPOSIT_NO,
				                                           DEPOSIT_SEQ,
				                                           SHIP_GB,
				                                           STORAGE_ID,
				                                           O_STORAGE_ID,
				                                           ASSORT_ID,
				                                           ITEM_ID,
				                                           ASSORT_WEIGHT,
				                                           SUBSTR(A.DELI_CURRENCY,1,2) DELI_COMPANY_ID,
				                                           SUBSTR(A.DELI_CURRENCY,3,2) CURRENCY_UNIT,
				                                           EXC_APP_DT,
				                                           QTY,
				                                           DECODE(SET_QTY,0,1,SET_QTY) SET_QTY,
				                                           ORDER_DISCOUNT,
				                                           SALE_COST,
				                                           CUSTOMS_TAX,
				                                           0 NOPAY_AMT,
				                                           ORDER_DISCOUNT - SALE_COST - CUSTOMS_TAX - (B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY)) SALE_RATE,
				                                           B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY) SALE_TRAN,
				                                           0 SALE_ITEM,
				                                           (C.TRANS_COST/CNT) COST_TRAN,
				                                           (SUM_WEIGHT - 0.5 * (CNT - 1)) / CNT SUM_WEIGHT,
				                                           CNT,
				                                           D.BASERATE,
				                                    CASE WHEN A.SITE_GB = '21' THEN  3                                   /*어드레스 3   달러*/
				                                    ELSE CASE WHEN  A.STORAGE_ID = '7' THEN 2.5      /*미국     2   달러*/
				                                        when  A.STORAGE_ID = '3'  then 3
				                                              WHEN A.STORAGE_ID = '4'                       THEN 1.2    /*이태리   1.2 유로*/
				                                              WHEN A.STORAGE_ID = '6'                       THEN 1      /*영국     1   파운드*/
				                                              WHEN A.STORAGE_ID = '8'                       THEN 249.15      /*일본 249.15엔*/
				                                              END
				                                    END COST_SORTING_FEE,                                               /*운송매출원가 - SORTING FEE*/
				                                    CASE WHEN A.SITE_GB = '21' THEN 0                                   /*어드레스 0   달러*/
				                                    ELSE CASE WHEN A.STORAGE_ID = '3' OR A.STORAGE_ID = '7' THEN 0      /*미국     0   달러*/
				                                              WHEN A.STORAGE_ID = '4'                       THEN 4000   /*이태리   4000 유로*/
				                                              WHEN A.STORAGE_ID = '6'                       THEN 2500   /*영국     2500 파운드*/
				                                              WHEN A.STORAGE_ID = '8'                       THEN 0 /*일본 0*/
				                                              END
				                                    END FIX_SORTING_FEE,                                                /*운송매출원가 - 고정비 SORTING FEE*/
				                                            (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                            a.contact_site,
				                                            a.join_id
				                                      FROM (
				                                            SELECT /*+ ORDERED USE_NL ( X A B C D) INDEX( A LSSHPM_IND4)
				                                                       NO_MERGE FULL(X) INDEX(D, ITASRN_PK) INDEX(E, ITASRN_PK) USE_HASH(F) SWAP_JOIN_INPUTS(F) */
				                                                   A.APPLY_DAY    APPLY_DAY,
				                                                   a.apply_time   apply_time,
				                                                   A.STORAGE_ID   STORAGE_ID,
				                                                   A.SHIP_GB      SHIP_GB,
				                                                   A.STORAGE_ID   O_STORAGE_ID,
				                                                   B.SITE_GB      SITE_GB,
				                                                   B.SHIP_ID      DEPOSIT_NO,
				                                                   B.SHIP_SEQ     DEPOSIT_SEQ,
				                                                   B.DEPOSIT_NO   MIN_DEPOSIT_NO,
				                                                   B.DEPOSIT_SEQ      MIN_DEPOSIT_SEQ,
				                                                   B.ORDER_ID     ORDER_ID,
				                                                   B.ORDER_SEQ    ORDER_SEQ,
				                                                   B.ASSORT_ID    ASSORT_ID,
				                                                   B.ORDER_ITEM_ID    ITEM_ID,
				                                                   B.SHIP_QTY     QTY,
				                                                   (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                                    COUNT(*)
				                                                    FROM RMORDD R,
				                                                         RMORDD S
				                                                    WHERE C.ORDER_ID = R.ORDER_ID
				                                                      AND C.ORDER_SEQ = R.ORDER_SEQ
				                                                      AND R.ORDER_ID = S.ORDER_ID
				                                                      AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                                       ) SET_QTY,
				                                                   B.SALE_COST     SALE_COST,
				                                                   B.ORDER_DISCOUNT    ORDER_DISCOUNT,
				                                                   nvl(B.CUSTOMS_TAX,0)       CUSTOMS_TAX,
				                                                   D.WEIGHT        ASSORT_WEIGHT,
				                                                   B.EXC_APP_DT    EXC_APP_DT,
				                                                   (SELECT CD_REF1||CD_REF2
				                                                     FROM CMCODE
				                                                    WHERE CD_MAJOR ='0504'
				                                                      AND CD_MINOR = A.STORAGE_ID
				                                                      AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_CURRENCY,
				                                                   SUM(E.WEIGHT) OVER (PARTITION BY A.SHIP_ID) SUM_WEIGHT,
				                                                   SUM(1) OVER (PARTITION BY A.SHIP_ID) CNT,
				                                                   g.CONTACT_SITE contact_site,
				                                            g.join_id
				                                              FROM CMSTGM X,
				                                                   LSSHPM A,
				                                                   LSSHPD B,
				                                                   RMORDD C,
				                                                   ITASRN D,
				                                                   ITASRN E,
				                                                   CMCODE F,
				                                                   rmordm g
				                                             WHERE X.STORAGE_GB ='01'
				                                               AND X.AREA_GB ='02'
				                                               AND A.STORAGE_ID = X.STORAGE_ID
				                                               AND A.APPLY_DAY >= #{as_from_dt}
				                                               AND A.APPLY_DAY <= #{as_to_dt}
				                                               AND A.SITE_GB  = '23'
				                                               AND A.SHIP_STATUS BETWEEN '12' AND '17'
				                                               AND A.REMAT_GB <> '01'
				                                               AND A.SHIP_ID  = B.SHIP_ID
				                                               AND A.SITE_GB  LIKE #{as_service_gb}
				                                               AND B.SITE_GB  LIKE #{as_site_gb}
				                                               AND B.ORDER_ID = C.ORDER_ID
				                                               AND B.ORDER_SEQ = C.ORDER_SEQ
				                                               AND B.ASSORT_ID = D.ASSORT_ID
				                                               AND D.HISTORY_GB = '01'
				                                               AND D.VENDOR_ID = C.VENDOR_ID
				                                               AND C.REG_DT BETWEEN D.EFF_STA_DT AND D.EFF_END_DT
				                                               AND B.ASSORT_ID = E.ASSORT_ID
				                                               AND E.HISTORY_GB = '01'
				                                               AND E.VENDOR_ID = C.VENDOR_ID
				                                               AND A.APPLY_DAY || A.APPLY_TIME BETWEEN E.EFF_STA_DT AND E.EFF_END_DT
				                                               AND A.STORAGE_ID = F.CD_MINOR
				                                               AND F.CD_MAJOR   = '0504'
				                                               AND B.EXC_APP_DT BETWEEN F.CD_STA_DT AND F.CD_END_DT
				                                               and c.order_id = g.order_id
				                                               ) A,
				                                                LSDLVT B,
				                                                LSDLVT C,
				                                                CMXCHM D
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = B.DELI_COMPANY_ID
				                                    AND C.VENDOR_ID ='002000'
				                                    AND C.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= C.EFF_STA_DT
				                                    AND A.APPLY_DAY <  C.EFF_END_DT
				                                    AND DECODE((A.SUM_WEIGHT - 0.5 * (CNT - 1)),0,1,(A.SUM_WEIGHT - 0.5 * (CNT - 1))) > C.WEIGHT_FROM
				                                    AND DECODE((A.SUM_WEIGHT - 0.5 * (CNT - 1)),0,1,(A.SUM_WEIGHT - 0.5 * (CNT - 1))) <=C.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = C.DELI_COMPANY_ID
				                                    AND SUBSTR(A.DELI_CURRENCY,3,2) = D.CURRENCY_UNIT
				                                    AND #{as_to_dt} BETWEEN D.APPLY_FROM AND D.APPLY_TO
				                                    UNION ALL
				                                    SELECT /*+ ORDERED USE_HASH(B, D) FULL(D) */
				                                           /* ADDRESS 사전 정상출고 */
				                                           '12.ADDRESS 사전 정상출고' DATA_GB,
				                                           FLS0039P(ORDER_ID, '001', ASSORT_ID) ORDER_DT,
				                                           SITE_GB,
				                                           ORDER_ID,
				                                           '001' ORDER_SEQ,
				                                           APPLY_DAY,
				                                           apply_time,
				                                           DEPOSIT_NO,
				                                           DEPOSIT_SEQ,
				                                           SHIP_GB,
				                                           STORAGE_ID,
				                                           O_STORAGE_ID,
				                                           ASSORT_ID,
				                                           ITEM_ID,
				                                           ASSORT_WEIGHT,
				                                           SUBSTR(A.DELI_CURRENCY,1,2) DELI_COMPANY_ID,
				                                           SUBSTR(A.DELI_CURRENCY,3,2) CURRENCY_UNIT,
				                                           EXC_APP_DT,
				                                           QTY,
				                                           SET_QTY,
				                                           ORDER_DISCOUNT,
				                                           SALE_COST,
				                                           CUSTOMS_TAX,
				                                           0 NOPAY_AMT,
				                                           0 SALE_RATE,
				                                           B.TRANS_AMT + (ORDER_DISCOUNT - SALE_COST - CUSTOMS_TAX - B.TRANS_AMT) SALE_TRAN,
				                                           0 SALE_ITEM,
				                                           B.TRANS_COST/DECODE(SET_QTY,0,1,SET_QTY) COST_TRAN,
				                                           0 SUM_WEIGHT,
				                                           1 CNT,
				                                           D.BASERATE,
				                                           3 COST_SORTING_FEE,
				                                           0 FIX_SORTING_FEE,                                               /*운송매출원가 - 고정비 SORTING FEE*/
				                                           (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                           a.contact_site contact_site,
				                                           a.join_id
				                                      FROM (
				                                            SELECT /*+ ORDERED USE_NL (X A B) INDEX(A LSSHPM_IND4)
				                                                       NO_MERGE FULL(X) */
				                                                   A.APPLY_DAY    APPLY_DAY,
				                                                   a.apply_time   apply_time,
				                                                   A.STORAGE_ID   STORAGE_ID,
				                                                   A.SHIP_GB      SHIP_GB,
				                                                   A.STORAGE_ID   O_STORAGE_ID,
				                                                   A.SITE_GB      SITE_GB,
				                                                   A.SHIP_ID      DEPOSIT_NO,
				                                                   '001'          DEPOSIT_SEQ,
				                                                   A.ORDER_ID     ORDER_ID,
				                                                   '799999999'    ASSORT_ID,
				                                                   '9999'         ITEM_ID,
				                                                   1          QTY,
				                                                   1          SET_QTY,
				                                                   (SELECT SUM(ORDER_DISCOUNT)
				                                                          FROM LSSHPD
				                                                         WHERE SHIP_ID = A.SHIP_ID) ORDER_DISCOUNT,
				                                                   0          SALE_COST,
				                                                   (SELECT SUM(CUSTOMS_TAX)
				                                                      FROM LSSHPD
				                                                     WHERE SHIP_ID = A.SHIP_ID) CUSTOMS_TAX,
				                                                   B.DWEIGHT      ASSORT_WEIGHT,
				                                                   A.APPLY_DAY    EXC_APP_DT,
				                                                   (SELECT CD_REF1||CD_REF2
				                                                     FROM CMCODE
				                                                    WHERE CD_MAJOR ='0504'
				                                                      AND CD_MINOR = A.STORAGE_ID
				                                                      AND A.APPLY_DAY BETWEEN CD_STA_DT AND CD_END_DT) DELI_CURRENCY,
				                                                      b.contact_site contact_site,
				                                                b.join_id
				                                              FROM CMSTGM X,
				                                                   LSSHPM A,
				                                                   RMORDM B
				                                             WHERE X.STORAGE_GB ='01'
				                                               AND X.AREA_GB ='02'
				                                               AND A.STORAGE_ID = X.STORAGE_ID
				                                               AND A.APPLY_DAY >= #{as_from_dt}
				                                               AND A.APPLY_DAY <= #{as_to_dt}
				                                               AND A.SITE_GB = '21'
				                                               AND A.SITE_GB = '23'
				                                               AND A.SITE_GB  LIKE #{as_site_gb}
				                                               AND A.SHIP_STATUS BETWEEN '12' AND '17'
				                                               AND A.ORDER_ID = B.ORDER_ID
				                                               ) A,
				                                                LSDLVT B,
				                                                CMXCHM D
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = B.DELI_COMPANY_ID
				                                    AND SUBSTR(A.DELI_CURRENCY,3,2) = D.CURRENCY_UNIT
				                                    AND #{as_to_dt} BETWEEN D.APPLY_FROM AND D.APPLY_TO
				                                    UNION ALL
				                                    SELECT /*+ ORDERED USE_HASH(B, D) FULL(D) */
				                                           /* 사전 재매치출고 */
				                                           '14.사전 재매치 출고' DATA_GB,
				                                           FLS0039P(ORDER_ID, ORDER_SEQ, ASSORT_ID) ORDER_DT,
				                                           SITE_GB,
				                                           ORDER_ID,
				                                           ORDER_SEQ,
				                                           APPLY_DAY,
				                                           apply_time,
				                                           DEPOSIT_NO,
				                                           DEPOSIT_SEQ,
				                                           SHIP_GB,
				                                           STORAGE_ID,
				                                           O_STORAGE_ID,
				                                           ASSORT_ID,
				                                           ITEM_ID,
				                                           ASSORT_WEIGHT,
				                                           SUBSTR(A.DELI_CURRENCY,1,2) DELI_COMPANY_ID,
				                                           SUBSTR(A.DELI_CURRENCY,3,2) CURRENCY_UNIT,
				                                           EXC_APP_DT,
				                                           QTY,
				                                           SET_QTY,
				                                           ORDER_DISCOUNT,
				                                           SALE_COST,
				                                           CUSTOMS_TAX,
				                                           0 NOPAY_AMT,
				                                           0 SALE_RATE,
				                                           0 SALE_TRAN,
				                                           ORDER_DISCOUNT - CUSTOMS_TAX SALE_ITEM,   /*사전재매치는 보험료등 세금은 차감*/
				                                           0 COST_TRAN,
				                                           0 SUM_WEIGHT,
				                                           1 CNT,
				                                           D.BASERATE,
				                                   CASE WHEN A.SITE_GB = '21' THEN  3                                   /*어드레스 3   달러*/
				                                    ELSE CASE WHEN  A.STORAGE_ID = '7' THEN 2.5      /*미국     2   달러*/
				                                        when  A.STORAGE_ID = '3'  then 3
				                                              WHEN A.STORAGE_ID = '4'                       THEN 1.2    /*이태리   1.2 유로*/
				                                              WHEN A.STORAGE_ID = '6'                       THEN 1      /*영국     1   파운드*/
				                                              WHEN A.STORAGE_ID = '8'                       THEN 249.15      /*일본 249.15엔*/
				                                              END
				                                    END COST_SORTING_FEE,                                               /*운송매출원가 - SORTING FEE*/
				                                    CASE WHEN A.SITE_GB = '21' THEN 0                                   /*어드레스 0   달러*/
				                                    ELSE CASE WHEN A.STORAGE_ID = '3' OR A.STORAGE_ID = '7' THEN 0      /*미국     0   달러*/
				                                              WHEN A.STORAGE_ID = '4'                       THEN 4000   /*이태리   4000 유로*/
				                                              WHEN A.STORAGE_ID = '6'                       THEN 2500   /*영국     2500 파운드*/
				                                              WHEN A.STORAGE_ID = '8'                       THEN 0 /*일본 0*/
				                                              END
				                                    END FIX_SORTING_FEE,                                                /*운송매출원가 - 고정비 SORTING FEE*/
				                                            (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT
				                                            ,a.contact_site
				                                            ,a.join_id
				                                      FROM (
				                                            SELECT /*+ ORDERED USE_NL(X A B C D ) INDEX(D ITASRN_PK)
				                                                       NO_MERGE FULL(X) */
				                                                   A.APPLY_DAY,
				                                                   a.apply_time,
				                                                   A.STORAGE_ID,
				                                                   A.SHIP_GB,
				                                                   A.STORAGE_ID      O_STORAGE_ID,
				                                                   B.SITE_GB,
				                                                   B.SHIP_ID         DEPOSIT_NO,
				                                                   B.SHIP_SEQ        DEPOSIT_SEQ,
				                                                   B.ORDER_ID        ORDER_ID,
				                                                   B.ORDER_SEQ       ORDER_SEQ,
				                                                   B.ASSORT_ID       ASSORT_ID,
				                                                   B.ORDER_ITEM_ID   ITEM_ID,
				                                                   B.SHIP_QTY           QTY,
				                                                   B.SHIP_QTY           SET_QTY,
				                                                   B.ORDER_DISCOUNT  ORDER_DISCOUNT,
				                                                   B.SALE_COST   SALE_COST,
				                                                   ROUND(B.CUSTOMS_TAX)         CUSTOMS_TAX,
				                                                   0         DELI_SHED_AMT,
				                                                   D.WEIGHT      ASSORT_WEIGHT,
				                                                   B.EXC_APP_DT  EXC_APP_DT,
				                                                   (SELECT CD_REF1||CD_REF2
				                                                      FROM CMCODE
				                                                     WHERE CD_MAJOR ='0504'
				                                                       AND CD_MINOR = A.STORAGE_ID
				                                                       AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_CURRENCY,
				                                                       f.contact_site contact_site,
				                                                f.join_id
				                                              FROM CMSTGM X,
				                                                   LSSHPM A,
				                                                   LSSHPD B,
				                                                   RMORDD C,
				                                                   ITASRN D,
				                                                   rmordm f
				                                             WHERE X.STORAGE_GB      ='01'
				                                               AND X.AREA_GB         ='02'
				                                               AND X.STORAGE_ID      = A.STORAGE_ID
				                                               AND A.SITE_GB         IN ('23',''/* LIVING */)
				                                               AND A.SHIP_ID     = B.SHIP_ID
				                                               AND A.SITE_GB  LIKE #{as_service_gb}
				                                               AND B.SITE_GB  LIKE #{as_site_gb}
				                                               AND A.REMAT_GB    = '01'
				                                               AND A.APPLY_DAY   >= #{as_from_dt}
				                                               AND A.APPLY_DAY   <= #{as_to_dt}
				                                               AND A.SHIP_STATUS     BETWEEN '12' AND '17'
				                                               AND B.ORDER_ID    = C.ORDER_ID
				                                               AND B.ORDER_SEQ       = C.ORDER_SEQ
				                                               AND C.ASSORT_ID       = D.ASSORT_ID
				                                               AND D.HISTORY_GB      ='01'
				                                               AND C.VENDOR_ID       = D.VENDOR_ID
				                                               AND A.APPLY_DAY || A.APPLY_TIME          BETWEEN D.EFF_STA_DT AND D.EFF_END_DT
				                                               and c.order_id = f.order_id
				                                                ) A,
				                                                LSDLVT B,
				                                                CMXCHM D
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = B.DELI_COMPANY_ID
				                                    AND SUBSTR(A.DELI_CURRENCY,3,2) = D.CURRENCY_UNIT
				                                    AND #{as_to_dt} BETWEEN D.APPLY_FROM AND D.APPLY_TO
				                                    UNION ALL
				                                    SELECT /* 사후 재매치 */
				                                           '13.사후 재매치 출고' DATA_GB,
				                                           ORDER_DT,
				                                           SITE_GB,
				                                           ORDER_ID,
				                                           ORDER_SEQ,
				                                           APPLY_DAY,
				                                           apply_time,
				                                           DEPOSIT_NO,
				                                           DEPOSIT_SEQ,
				                                           SHIP_GB,
				                                           STORAGE_ID,
				                                           O_STORAGE_ID,
				                                           ASSORT_ID,
				                                           ITEM_ID,
				                                           ASSORT_WEIGHT,
				                                           SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
				                                           SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
				                                           EXC_APP_DT,
				                                           QTY,
				                                           SET_QTY,
				                                           ORDER_DISCOUNT,
				                                           SALE_COST + CUSTOMS_TAX SALE_COST,
				                                           0 CUSTOMS_TAX,
				                                           0 NOPAY_AMT,
				                                           0 SALE_RATE,
				                                           0 SALE_TRAN,
				                                           ORDER_DISCOUNT SALE_ITEM,
				                                           0 COST_TRAN,
				                                           0 SUM_WEIGHT,
				                                           1 CNT,
				                                           0 BASERATE,
				                                           0 COST_SORTING_FEE,
				                                           0 FIX_SORTING_FEE,
				                                           (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                           contact_site,
				                                           join_id
				                                      FROM (
				                                            SELECT /*+ ORDERED USE_NL(X A B C D)
				                                                       FULL(X) INDEX(D, ITASRN_PK) */
				                                                   A.APPLY_DAY      APPLY_DAY,
				                                                   a.apply_time     apply_time,
				                                                   A.STORAGE_ID     STORAGE_ID,
				                                                   B.O_STORAGE_ID       O_STORAGE_ID,
				                                                   B.SITE_GB        SITE_GB,
				                                                   A.SHIP_GB,
				                                                   B.SHIP_ID        DEPOSIT_NO,
				                                                   B.SHIP_SEQ       DEPOSIT_SEQ,
				                                                   B.ORDER_ID       ORDER_ID,
				                                                   B.ORDER_SEQ      ORDER_SEQ,
				                                                   C.REG_DT         ORDER_DT,
				                                                   B.ASSORT_ID,
				                                                   B.ORDER_ITEM_ID ITEM_ID,
				                                                   B.SHIP_QTY        QTY,
				                                                   B.SHIP_QTY    SET_QTY,
				                                                   B.ORDER_DISCOUNT   ORDER_DISCOUNT,
				                                                   B.SALE_COST    SALE_COST,
				                                                   B.CUSTOMS_TAX      CUSTOMS_TAX,
				                                                   D.WEIGHT   ASSORT_WEIGHT,
				                                                   B.EXC_APP_DT   EXC_APP_DT,
				                                                   (SELECT CD_REF1 || CD_REF2
				                                                      FROM CMCODE
				                                                     WHERE CD_MAJOR ='0504'
				                                                       AND CD_MINOR = B.O_STORAGE_ID
				                                                       AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
				                                                       f.contact_site,
				                                                        f.join_id
				                                              FROM CMSTGM X,
				                                                   LSSHPM A,
				                                                   LSSHPD B,
				                                                   RMORDD C,
				                                                   ITASRN D,
				                                                   rmordm f
				                                             WHERE X.STORAGE_GB  ='01'
				                                               AND X.AREA_GB     ='01'
				                                               AND X.STORAGE_TYPE='01'
				                                               AND X.VENDOR_ID   ='002000'
				                                               AND A.SITE_GB     = '23'
				                                               AND A.STORAGE_ID = X.STORAGE_ID
				                                               AND A.APPLY_DAY >= #{as_from_dt}
				                                               AND A.APPLY_DAY <= #{as_to_dt}
				                                               AND A.SHIP_STATUS BETWEEN '12' AND '17'
				                                               AND A.SHIP_ID     = B.SHIP_ID
				                                               AND A.SITE_GB  LIKE #{as_service_gb}
				                                               AND B.SITE_GB  LIKE #{as_site_gb}
				                                               AND B.ORDER_ID    = C.ORDER_ID
				                                               AND B.ORDER_SEQ   = C.ORDER_SEQ
				                                               AND A.APPLY_DAY || A.APPLY_TIME   BETWEEN D.EFF_STA_DT AND D.EFF_END_DT
				                                               AND D.HISTORY_GB  ='01'
				                                               AND C.VENDOR_ID   = D.VENDOR_ID
				                                               AND C.ASSORT_ID   = D.ASSORT_ID
				                                               and c.order_id = f.order_id
				                                               )
				                                       UNION ALL
				                                        SELECT /*+ ORDERED USE_HASH(B) */
				                                               /* 사후 입고_분실포함 */
				                                               '25.사후 정상반품 입고_분실포함' DATA_GB,
				                                               FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
				                                               SITE_GB,
				                                               ORDER_ID,
				                                               ORDER_SEQ,
				                                               APPLY_DAY,
				                                               apply_time,
				                                               DEPOSIT_NO,
				                                               DEPOSIT_SEQ,
				                                               SHIP_GB,
				                                               STORAGE_ID,
				                                               O_STORAGE_ID,
				                                               SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
				                                               SUBSTR(ASSORT_ITEM,10) ITEM_ID,
				                                               ASSORT_WEIGHT,
				                                               SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
				                                               SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
				                                               EXC_APP_DT,
				                                               -1 * QTY QTY,
				                                               DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
				                                               -1 * ORDER_DISCOUNT ORDER_DISCOUNT,
				                                               -1 * SALE_COST SALE_COST,
				                                               -1 * CUSTOMS_TAX CUSTOMS_TAX,
				                                               0 NOPAY_AMT,
				                                               (-1 * ORDER_DISCOUNT) - ( -1 * SALE_COST) - (-1 * CUSTOMS_TAX) - (-1 * (B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY))) SALE_RATE,
				                                               -1 * B.TRANS_AMT / DECODE(SET_QTY,0,1,SET_QTY) SALE_TRAN,
				                                               0 SALE_ITEM,
				                                               0 COST_TRAN,
				                                               0 SUM_WEIGHT,
				                                               1 CNT,
				                                               0 BASERATE,
				                                               0 COST_SORTING_FEE,
				                                               0 FIX_SORTING_FEE,
				                                               (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                               a.contact_site,
				                                               a.join_id
				                                               
				                                          FROM (
				                                                SELECT /*+ ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
				                                                           NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고*/
				                                                       SUBSTR(A.EFF_STA_DT,1,8) APPLY_DAY,
				                                                       SUBSTR(A.EFF_STA_DT,9,6) APPLY_time,
				                                                       C.STORAGE_ID         STORAGE_ID,
				                                                       B.O_STORAGE_ID           O_STORAGE_ID,
				                                                       B.SITE_GB            SITE_GB,
				                                                       B.SHIP_GB            SHIP_GB,
				                                                       B.SHIP_ID            DEPOSIT_NO,
				                                                       B.SHIP_SEQ           DEPOSIT_SEQ,
				                                                       B.ORDER_ID           ORDER_ID,
				                                                       B.ORDER_SEQ          ORDER_SEQ,
				                                                        NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
				                                                              FROM LSDPSD
				                                                             WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
				                                                               AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
				                                                               AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
				                                                               AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
				                                                       (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
				                                                       ABS(B.SHIP_INDICATE_QTY) QTY,
				                                                       (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                                              COUNT(*)
				                                                         FROM RMORDD R,
				                                                              RMORDD S
				                                                        WHERE D.ORDER_ID = R.ORDER_ID
				                                                          AND D.ORDER_SEQ = R.ORDER_SEQ
				                                                          AND R.ORDER_ID = S.ORDER_ID
				                                                          AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                                       ) SET_QTY,
				                                                       B.ORDER_DISCOUNT ORDER_DISCOUNT,
				                                                       ABS(B.SALE_COST) SALE_COST,
				                                                       B.CUSTOMS_TAX    CUSTOMS_TAX,
				                                                       H.WEIGHT ASSORT_WEIGHT,
				                                                       B.EXC_APP_DT EXC_APP_DT,
				                                                       (SELECT CD_REF1 || CD_REF2
				                                                          FROM CMCODE
				                                                         WHERE CD_MAJOR ='0504'
				                                                           AND CD_MINOR = B.O_STORAGE_ID
				                                                           AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
				                                                           i.contact_site contact_site
				                                                           ,i.join_id
				                                                  FROM LSSHPS A,
				                                                       LSSHPD B,
				                                                       LSSHPM C,
				                                                       CMSTGM X,
				                                                       RMORDD D,
				                                                       RMORDD E,
				                                                       ITASRN H,
				                                                       rmordm i
				                                                 WHERE A.SHIP_STATUS ='41'
				                                                   AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
				                                                   AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
				                                                   AND C.STORAGE_ID  = X.STORAGE_ID
				                                                   AND X.STORAGE_GB  ='01'
				                                                   AND X.AREA_GB     ='01'
				                                                   AND X.STORAGE_TYPE='01'
				                                                   AND X.VENDOR_ID   ='002000'
				                                                   AND A.SHIP_ID     = B.SHIP_ID
				                                                   AND C.SITE_GB  LIKE #{as_service_gb}
				                                                   AND B.SITE_GB  LIKE #{as_site_gb}
				                                                   AND B.SHIP_ID     = C.SHIP_ID
				                                                   AND B.ORDER_ID    = D.ORDER_ID
				                                                   AND B.ORDER_SEQ   = D.ORDER_SEQ
				                                                   AND D.BEF_ORDER_ID= E.ORDER_ID
				                                                   AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
				                                                   AND E.ASSORT_ID   = H.ASSORT_ID
				                                                   AND H.HISTORY_GB  = '01'
				                                                   AND H.VENDOR_ID   = E.VENDOR_ID
				                                                   AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
				                                                   AND EXISTS ( SELECT 'X'||ROWNUM
				                                                                      FROM RMORDD X,
				                                                                           LSPCHD Y
				                                                                     WHERE B.ORDER_ID = X.ORDER_ID
				                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
				                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
				                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
				                                                   and d.order_id = i.order_id                                                                       
				                                                   ) A,
				                                                    LSDLVT B
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
				                                    UNION ALL
				                                    SELECT /*+ ORDERED USE_HASH(B) */
				                                           /* 사후 입고_분실포함 */
				                                               '26.사후 매치반품 입고_분실포함' DATA_GB,
				                                               FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
				                                               SITE_GB,
				                                               ORDER_ID,
				                                               ORDER_SEQ,
				                                               APPLY_DAY,
				                                               apply_time,
				                                               DEPOSIT_NO,
				                                               DEPOSIT_SEQ,
				                                               SHIP_GB,
				                                               STORAGE_ID,
				                                               O_STORAGE_ID,
				                                               SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
				                                               SUBSTR(ASSORT_ITEM,10) ITEM_ID,
				                                               ASSORT_WEIGHT,
				                                               SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
				                                               SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
				                                               EXC_APP_DT,
				                                               -1 * QTY QTY,
				                                               DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
				                                               -1 * ORDER_DISCOUNT ORDER_DISCOUNT,
				                                               -1 * (SALE_COST + CUSTOMS_TAX) SALE_COST,
				                                               0 CUSTOMS_TAX,
				                                               0 NOPAY_AMT,
				                                               0 SALE_RATE,
				                                               0 SALE_TRAN,
				                                               -1 * ORDER_DISCOUNT SALE_ITEM,
				                                               0 COST_TRAN,
				                                               0 SUM_WEIGHT,
				                                               1 CNT,
				                                               0 BASERATE,
				                                               0 COST_SORTING_FEE,
				                                               0 FIX_SORTING_FEE,
				                                               (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                               a.contact_site
				                                               ,a.join_id
				                                          FROM (
				                                                SELECT /*+ ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
				                                                           NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고*/
				                                                       SUBSTR(A.EFF_STA_DT,1,8) APPLY_DAY,
				                                                       SUBSTR(A.EFF_STA_DT,9,6) APPLY_time,
				                                                       C.STORAGE_ID         STORAGE_ID,
				                                                       B.O_STORAGE_ID           O_STORAGE_ID,
				                                                       B.SITE_GB            SITE_GB,
				                                                       B.SHIP_GB            SHIP_GB,
				                                                       B.SHIP_ID            DEPOSIT_NO,
				                                                       B.SHIP_SEQ           DEPOSIT_SEQ,
				                                                       B.ORDER_ID           ORDER_ID,
				                                                       B.ORDER_SEQ          ORDER_SEQ,
				                                                       NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
				                                                              FROM LSDPSD
				                                                             WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
				                                                               AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
				                                                               AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
				                                                               AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
				                                                       (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
				                                                       ABS(B.SHIP_INDICATE_QTY) QTY,
				                                                       (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                                              COUNT(*)
				                                                         FROM RMORDD R,
				                                                              RMORDD S
				                                                        WHERE D.ORDER_ID = R.ORDER_ID
				                                                          AND D.ORDER_SEQ = R.ORDER_SEQ
				                                                          AND R.ORDER_ID = S.ORDER_ID
				                                                          AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                                       ) SET_QTY,
				                                                       B.ORDER_DISCOUNT ORDER_DISCOUNT,
				                                                       ABS(B.SALE_COST) SALE_COST,
				                                                       B.CUSTOMS_TAX    CUSTOMS_TAX,
				                                                       H.WEIGHT ASSORT_WEIGHT,
				                                                       B.EXC_APP_DT EXC_APP_DT,
				                                                       (SELECT CD_REF1 || CD_REF2
				                                                          FROM CMCODE
				                                                         WHERE CD_MAJOR ='0504'
				                                                           AND CD_MINOR = B.O_STORAGE_ID
				                                                           AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
				                                                           i.contact_site contact_site
				                                                           ,i.join_id
				                                                  FROM LSSHPS A,
				                                                       LSSHPD B,
				                                                       LSSHPM C,
				                                                       CMSTGM X,
				                                                       RMORDD D,
				                                                       RMORDD E,
				                                                       ITASRN H,
				                                                       rmordm i
				                                                 WHERE A.SHIP_STATUS ='41'
				                                                   AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
				                                                   AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
				                                                   AND C.STORAGE_ID  = X.STORAGE_ID
				                                                   AND X.STORAGE_GB  ='01'
				                                                   AND X.AREA_GB     ='01'
				                                                   AND X.STORAGE_TYPE='01'
				                                                   AND X.VENDOR_ID   ='002000'
				                                                   AND A.SHIP_ID     = B.SHIP_ID
				                                                   AND C.SITE_GB  LIKE #{as_service_gb}
				                                                   AND B.SITE_GB  LIKE #{as_site_gb}
				                                                   AND B.SHIP_ID     = C.SHIP_ID
				                                                   AND B.ORDER_ID    = D.ORDER_ID
				                                                   AND B.ORDER_SEQ   = D.ORDER_SEQ
				                                                   AND D.BEF_ORDER_ID= E.ORDER_ID
				                                                   AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
				                                                   AND E.ASSORT_ID   = H.ASSORT_ID
				                                                   AND H.HISTORY_GB  = '01'
				                                                   AND H.VENDOR_ID   = E.VENDOR_ID
				                                                   AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
				                                                   AND NOT EXISTS ( SELECT 'X'||ROWNUM
				                                                                      FROM RMORDD X,
				                                                                           LSPCHD Y
				                                                                     WHERE B.ORDER_ID = X.ORDER_ID
				                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
				                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
				                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
				                                                   and d.order_id = i.order_id                    
				                                                   ) A,
				                                                    LSDLVT B
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
				
				                                    UNION ALL
				
				                                      SELECT /*+ ORDERED USE_HASH(B) */
				                                             /* 사후 입고취소_분실포함 */
				                                             '27.사후 정상반품입고취소_분실포함' DATA_GB,
				                                             FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
				                                       SITE_GB,
				                                             ORDER_ID,
				                                             ORDER_SEQ,
				                                             APPLY_DAY,
				                                             apply_time,
				                                             DEPOSIT_NO,
				                                             DEPOSIT_SEQ,
				                                             SHIP_GB,
				                                             STORAGE_ID,
				                                             O_STORAGE_ID,
				                                             SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
				                                             SUBSTR(ASSORT_ITEM,10) ITEM_ID,
				                                             ASSORT_WEIGHT,
				                                             SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
				                                             SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
				                                             EXC_APP_DT,
				                                             -1 * QTY,
				                                             DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
				                                             ORDER_DISCOUNT,
				                                             SALE_COST SALE_COST,
				                                             CUSTOMS_TAX,
				                                             0 NOPAY_AMT,
				                                             ORDER_DISCOUNT - SALE_COST - CUSTOMS_TAX - (B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY)) SALE_RATE,
				                                             B.TRANS_AMT / DECODE(SET_QTY,0,1,SET_QTY) SALE_TRAN,
				                                             0 SALE_ITEM,
				                                             0 COST_TRAN,
				                                             0 SUM_WEIGHT,
				                                             1 CNT,
				                                             0 BASERATE,
				                                             0 COST_SORTING_FEE,
				                                             0 FIX_SORTING_FEE,
				                                             (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                             a.contact_site,
				                                             a.join_id
				                                        FROM (
				                                              SELECT /*+ USE_CONCAT ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
				                                                         NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고취소*/
				                                                  C.SHIP_STATUS,
				                                                  SUBSTR(A.EFF_STA_DT,1,8)      APPLY_DAY,
				                                                  SUBSTR(A.EFF_STA_DT,9,6)      APPLY_time,
				                                                  C.STORAGE_ID                  STORAGE_ID,
				                                                  B.O_STORAGE_ID                O_STORAGE_ID,
				                                                  B.SITE_GB                     SITE_GB,
				                                                  B.SHIP_GB                     SHIP_GB,
				                                                  B.SHIP_ID                     DEPOSIT_NO,
				                                                  B.SHIP_SEQ                    DEPOSIT_SEQ,
				                                                  B.ORDER_ID                    ORDER_ID,
				                                                  B.ORDER_SEQ                       ORDER_SEQ,
				                                                  NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
				                                                         FROM LSDPSD
				                                                        WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
				                                                          AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
				                                                          AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
				                                                          AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
				                                                  (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
				                                                  B.SHIP_INDICATE_QTY QTY,
				                                                  (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                                         COUNT(*)
				                                                    FROM RMORDD R,
				                                                          RMORDD S
				                                                   WHERE D.ORDER_ID = R.ORDER_ID
				                                                     AND D.ORDER_SEQ = R.ORDER_SEQ
				                                                     AND R.ORDER_ID = S.ORDER_ID
				                                                     AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                                  ) SET_QTY,
				                                                  B.ORDER_DISCOUNT ORDER_DISCOUNT,
				                                                  ABS(B.SALE_COST) SALE_COST,
				                                                  B.CUSTOMS_TAX    CUSTOMS_TAX,
				                                                  H.WEIGHT ASSORT_WEIGHT,
				                                                  B.EXC_APP_DT EXC_APP_DT,
				                                                  (SELECT CD_REF1 || CD_REF2
				                                                     FROM CMCODE
				                                                    WHERE CD_MAJOR ='0504'
				                                                      AND CD_MINOR = B.O_STORAGE_ID
				                                                      AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
				                                                      i.contact_site contact_site
				                                                      ,i.join_id
				                                             FROM LSSHPS A,
				                                                  LSSHPD B,
				                                                  LSSHPM C,
				                                                  CMSTGM X,
				                                                  RMORDD D,
				                                               RMORDD E,
				                                               ITASRN H,
				                                               rmordm i
				                                            WHERE A.SHIP_STATUS IN('30','31')
				                                              AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
				                                              AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
				                                              AND C.STORAGE_ID  = X.STORAGE_ID
				                                              AND X.STORAGE_GB  ='01'
				                                              AND X.AREA_GB     ='01'
				                                              AND X.STORAGE_TYPE='01'
				                                              AND X.VENDOR_ID   ='002000'
				                                              AND A.SHIP_ID     = B.SHIP_ID
				                                              AND C.SITE_GB  LIKE #{as_service_gb}
				                                              AND B.SITE_GB  LIKE #{as_site_gb}
				                                              AND B.SHIP_ID     = C.SHIP_ID
				                                              AND B.ORDER_ID    = D.ORDER_ID
				                                              AND B.ORDER_SEQ   = D.ORDER_SEQ
				                                           AND D.BEF_ORDER_ID= E.ORDER_ID
				                                           AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
				                                                 AND EXISTS (SELECT /*+ INDEX( X LSSHPS_PK) */
				                                                                    'X'||ROWNUM
				                                                                FROM LSSHPS X
				                                                         WHERE SHIP_ID = A.SHIP_ID
				                                                           AND SHIP_STATUS ='41'
				                                                           AND EFF_STA_DT < A.EFF_STA_DT)
				                                                 AND ((A.SHIP_STATUS = '30' AND NOT EXISTS (SELECT 'X'||ROWNUM
				                                                                                        FROM LSSHPS
				                                                                                       WHERE SHIP_ID = A.SHIP_ID
				                                                                                         AND SHIP_STATUS = '31'
				                                                                                         AND EFF_STA_DT > A.EFF_STA_DT))
				                                            OR
				                                               (A.SHIP_STATUS = '31' AND '1' ='1'))
				                                           AND E.ASSORT_ID   = H.ASSORT_ID
				                                           AND H.HISTORY_GB  = '01'
				                                           AND H.VENDOR_ID   = E.VENDOR_ID
				                                           AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
				                                           AND EXISTS ( SELECT 'X'||ROWNUM
				                                                                      FROM RMORDD X,
				                                                                           LSPCHD Y
				                                                                     WHERE B.ORDER_ID = X.ORDER_ID
				                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
				                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
				                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
				                                            and d.order_id = i.order_id                                                                       
				                                           )  A,
				                                                    LSDLVT B
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
				
				                                    UNION ALL
				                                    SELECT /*+ ORDERED USE_HASH(B) */
				                                           /* 사후 입고취소_분실포함 */
				                                             '28.사후 매치반품입고취소_분실포함' DATA_GB,
				                                             FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
				                                             SITE_GB,
				                                             ORDER_ID,
				                                             ORDER_SEQ,
				                                             APPLY_DAY,
				                                             apply_time,
				                                             DEPOSIT_NO,
				                                             DEPOSIT_SEQ,
				                                             SHIP_GB,
				                                             STORAGE_ID,
				                                             O_STORAGE_ID,
				                                             SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
				                                             SUBSTR(ASSORT_ITEM,10) ITEM_ID,
				                                             ASSORT_WEIGHT,
				                                             SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
				                                             SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
				                                             EXC_APP_DT,
				                                             -1 * QTY,
				                                             DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
				                                             ORDER_DISCOUNT ORDER_DISCOUNT,
				                                             SALE_COST + CUSTOMS_TAX SALE_COST,
				                                             0 CUSTOMS_TAX,
				                                             0 NOPAY_AMT,
				                                             0 SALE_RATE,
				                                             0 SALE_TRAN,
				                                             ORDER_DISCOUNT SALE_ITEM,
				                                             0 COST_TRAN,
				                                             0 SUM_WEIGHT,
				                                             1 CNT,
				                                             0 BASERATE,
				                                             0 COST_SORTING_FEE,
				                                             0 FIX_SORTING_FEE,
				                                             (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
				                                             a.contact_site,
				                                             a.join_id
				                                        FROM (
				                                              SELECT /*+ USE_CONCAT ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
				                                                         NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고취소*/
				                                                  C.SHIP_STATUS,
				                                                  SUBSTR(A.EFF_STA_DT,1,8)      APPLY_DAY,
				                                                  SUBSTR(A.EFF_STA_DT,9,6)      APPLY_time,
				                                                  C.STORAGE_ID                  STORAGE_ID,
				                                                  B.O_STORAGE_ID                O_STORAGE_ID,
				                                                  B.SITE_GB                     SITE_GB,
				                                                  B.SHIP_GB                     SHIP_GB,
				                                                  B.SHIP_ID                     DEPOSIT_NO,
				                                                  B.SHIP_SEQ                    DEPOSIT_SEQ,
				                                                  B.ORDER_ID                    ORDER_ID,
				                                                  B.ORDER_SEQ                       ORDER_SEQ,
				                                                  NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
				                                                         FROM LSDPSD
				                                                        WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
				                                                          AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
				                                                          AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
				                                                          AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
				                                                  (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
				                                                  B.SHIP_INDICATE_QTY QTY,
				                                                  (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                                         COUNT(*)
				                                                    FROM RMORDD R,
				                                                          RMORDD S
				                                                   WHERE D.ORDER_ID = R.ORDER_ID
				                                                     AND D.ORDER_SEQ = R.ORDER_SEQ
				                                                     AND R.ORDER_ID = S.ORDER_ID
				                                                     AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                                  ) SET_QTY,
				                                                  B.ORDER_DISCOUNT ORDER_DISCOUNT,
				                                                  ABS(B.SALE_COST) SALE_COST,
				                                                  B.CUSTOMS_TAX    CUSTOMS_TAX,
				                                                  H.WEIGHT ASSORT_WEIGHT,
				                                                  B.EXC_APP_DT EXC_APP_DT,
				                                                  (SELECT CD_REF1 || CD_REF2
				                                                     FROM CMCODE
				                                                    WHERE CD_MAJOR ='0504'
				                                                      AND CD_MINOR = B.O_STORAGE_ID
				                                                      AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
				                                                      i.contact_site contact_site,
				                                                      i.join_id
				                                             FROM LSSHPS A,
				                                                  LSSHPD B,
				                                                  LSSHPM C,
				                                                  CMSTGM X,
				                                                  RMORDD D,
				                                               RMORDD E,
				                                               ITASRN H,
				                                               rmordm i
				                                            WHERE A.SHIP_STATUS IN('30','31')
				                                              AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
				                                              AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
				                                              AND C.STORAGE_ID  = X.STORAGE_ID
				                                              AND X.STORAGE_GB  ='01'
				                                              AND X.AREA_GB     ='01'
				                                              AND X.STORAGE_TYPE='01'
				                                              AND X.VENDOR_ID   ='002000'
				                                              AND A.SHIP_ID     = B.SHIP_ID
				                                              AND C.SITE_GB  LIKE #{as_service_gb}
				                                              AND B.SITE_GB  LIKE #{as_site_gb}
				                                              AND B.SHIP_ID     = C.SHIP_ID
				                                              AND B.ORDER_ID    = D.ORDER_ID
				                                              AND B.ORDER_SEQ   = D.ORDER_SEQ
				                                           AND D.BEF_ORDER_ID= E.ORDER_ID
				                                           AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
				                                                 AND EXISTS (SELECT /*+ INDEX( X LSSHPS_PK) */
				                                                                    'X'||ROWNUM
				                                                                FROM LSSHPS X
				                                                         WHERE SHIP_ID = A.SHIP_ID
				                                                           AND SHIP_STATUS ='41'
				                                                           AND EFF_STA_DT < A.EFF_STA_DT)
				                                                 AND ((A.SHIP_STATUS = '30' AND NOT EXISTS (SELECT 'X'||ROWNUM
				                                                                                        FROM LSSHPS
				                                                                                       WHERE SHIP_ID = A.SHIP_ID
				                                                                                         AND SHIP_STATUS = '31'
				                                                                                         AND EFF_STA_DT > A.EFF_STA_DT))
				                                            OR
				                                               (A.SHIP_STATUS = '31' AND '1' ='1'))
				                                           AND E.ASSORT_ID   = H.ASSORT_ID
				                                           AND H.HISTORY_GB  = '01'
				                                           AND H.VENDOR_ID   = E.VENDOR_ID
				                                           AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
				                                           AND NOT EXISTS ( SELECT 'X'||ROWNUM
				                                                                      FROM RMORDD X,
				                                                                           LSPCHD Y
				                                                                     WHERE B.ORDER_ID = X.ORDER_ID
				                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
				                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
				                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
				                                           and d.order_id = i.order_id                                                                       
				                                           )  A,
				                                                    LSDLVT B
				                                    WHERE   B.VENDOR_ID ='002000'
				                                    AND B.DELI_TYPE = '01'
				                                    AND A.APPLY_DAY >= B.EFF_STA_DT
				                                    AND A.APPLY_DAY <  B.EFF_END_DT
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
				                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
				                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
				                                ) X,
				                                ITASRT Z,
				                                CMCODE B,
				                                CMCODE C
				                        WHERE   X.ASSORT_ID = Z.ASSORT_ID
				                        AND     X.SITE_GB   = B.CD_MINOR
				                        AND     B.CD_MAJOR  = '0072'
				                        AND     B.CD_FR_MINOR = '20'
				                        AND     B.CD_END_DT = '99991231235959'
				                        AND     X.O_STORAGE_ID = C.CD_MINOR
				                        AND     C.CD_MAJOR = '0504'
				                        AND     C.CD_END_DT = '99991231235959'
				                        GROUP BY    X.SITE_GB,
				                                    Z.DISP_CATEGORY_ID,
				                                    X.O_STORAGE_ID,
				                                    X.DATA_GB,
				                                    x.contact_site,
				                                    x.join_id,
				                                    z.vendor_id,
				                                    z.brand_id,
				                                    z.assort_id,
				                                    z.assort_nm,
				                                    z.assort_model
				                                    , x.order_id,x.order_seq
				                                 ,x.apply_day                                    
				                                 ,x.apply_time
				                        UNION ALL
				                        SELECT  /*+ ORDERED USE_NL(X Y) USE_HASH(Z, A, B) */
				                                X.SITE_GB                   AS SITE_GB,
				                                MAX(B.CD_REF1)              AS VENDOR_ID,
				                                MAX(B.CD_FNAME)             AS SITE_NM,
				                                'MALL'                      AS STORAGE_ID,
				                                X.DATA_GB                   AS DATA_GB,
				                                Z.DISP_CATEGORY_ID          AS DISP_CATEGORY_ID,
				                                x.contact_site              as contact_site,
				                                NVL((select join_nm 
				                                from   MKJONM MK 
				                                where  MK.join_id    = x.join_id 
				                                AND    MK.balance_gb = '02'
				                                and    MK.adjst_cd   = '05'
				                                and    MK.join_path  = '01'
				                                and    MK.join_type  IN ('03','13')
				                                and    MK.up_join_id = '*'
				                                ),'WIZWID') join_nm, 
				                                    z.vendor_id vendor_id_n,
				                                    z.brand_id brand_id_n,
				                                    z.assort_id assort_id_n  ,
				                                    z.assort_nm assort_nm_n  ,
				                                    z.assort_model assort_model_n,                                 
				                                SUM(ABS(X.QTY))             AS CNT,
				                                SUM(X.QTY)                  AS QTY,
				                                1                           AS SHIP_CNT,            /*출고건수*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 0, X.QTY, 0), 0))     AS NOSET_QTY_CHGO,      /*출고*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 0, X.QTY, 0), 0))     AS NOSET_QTY_IPGO,      /*반품*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 0, 0, X.QTY), 0))     AS SET_QTY_CHGO,        /*출고*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 0, 0, X.QTY), 0))     AS SET_QTY_IPGO,        /*반품*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_CHGO,     /*출고*/
				                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_IPGO,     /*반품*/
				                                SUM(X.ORDER_DISCOUNT)       AS ORDER_DISCOUNT,
				                                SUM(X.SALE_COST)            AS SALE_COST,
				                                SUM(X.CUSTOMS_TAX)          AS CUSTOMS_TAX,
				                                SUM(X.NOPAY_AMT)            AS NOPAY_AMT,
				                                SUM(X.SALE_RATE)            AS SALE_RATE,
				                                SUM(X.SALE_TRAN)            AS SALE_TRAN,
				                                SUM(X.SALE_ITEM)            AS SALE_ITEM,
				                                SUM(X.NOPAY_AMT)            AS SALE_EXCEPT_ITEM,
				                                0                           AS SUM_WEIGHT,
				                                0                           AS COST_TRAN,
				                                SUM(X.SALE_COST)            AS COST_ITEM,   /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
				                                0                           AS COST_SORTING_FEE,
				                                0                           AS FIX_SORTING_FEE,
				                                TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1 DATE_CNT
				                                ,x.order_id,x.order_seq
				                             ,x.apply_day
				                             ,x.apply_time
				                        FROM    (
				                                SELECT  /*+ ORDERED USE_NL(A B C D F) INDEX(A LSSHPM_IND1)
				                                            INDEX(F, ITASRN_PK) USE_HASH(G) */
				                                        '12.몰매출-위탁-출고'   DATA_GB,
				                                        FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
				                                        A.STORAGE_ID        STORAGE_ID,
				                                        A.SHIP_ID           SHIP_ID,    /* 출고번호 */
				                                        B.SHIP_SEQ          SHIP_SEQ,   /* 출고내역번호 */
				                                        A.SHIP_GB           SHIP_GB,
				                                        B.SITE_GB           SITE_GB,    /* 사이트별 매출 구분값 */
				                                        A.APPLY_DAY         apply_day,    /* 매출일자 */
				                                        a.apply_time        apply_time,
				                                        B.ORDER_ID          ORDER_ID,   /* 주문번호 */
				                                        B.ORDER_SEQ         ORDER_SEQ,  /* 주문순번 */
				                                        B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
				                                        B.ASSORT_ID         ASSORT_ID,  /* 품목코드 */
				                                        B.ORDER_ITEM_ID     ITEM_ID,    /* 상품코드 */
				                                        B.SHIP_QTY          QTY,        /* 수량 */
				                                        (
				                                        SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                               COUNT(*)
				                                          FROM RMORDD R,
				                                               RMORDD S
				                                         WHERE B.ORDER_ID = R.ORDER_ID
				                                           AND B.ORDER_SEQ = R.ORDER_SEQ
				                                           AND R.ORDER_ID = S.ORDER_ID
				                                           AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                        ) SET_QTY,
				                                        B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
				                                        0 SALE_COST,
				                                        0 CUSTOMS_TAX,
				                                        ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) NOPAY_AMT,
				                                        (B.SHIP_QTY * B.ORDER_DISCOUNT) - ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) SALE_RATE,
				                                        0 SALE_TRAN,
				                                        0 SALE_ITEM,
				                                        h.contact_site contact_site,
				                                        h.join_id
				                                   FROM LSSHPM A,
				                                        LSSHPD B,
				                                        ITASRT C,
				                                        RMORDD D,
				                                        ITASRN F,
				                                        CMVDMR G,
				                                        rmordm h
				                                  WHERE A.APPLY_DAY >= #{as_from_dt}
				                                    AND A.APPLY_DAY <= #{as_to_dt}
				                                    AND A.SITE_GB ='22'
				                                    AND A.SHIP_STATUS IN ('14')
				                                    AND A.SHIP_GB||'' IN ('11','12')
				                                    AND B.SHIP_ID = A.SHIP_ID
				                                    AND A.SITE_GB LIKE #{as_service_gb}
				                                    AND B.SITE_GB LIKE #{as_site_gb}
				                                    AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
				                                    AND C.ASSORT_ID = B.ASSORT_ID
				                                    AND D.ORDER_ID (+) = B.ORDER_ID
				                                    AND D.ORDER_SEQ (+) = B.ORDER_SEQ
				                                    AND F.ASSORT_ID = C.ASSORT_ID
				                                    AND F.VENDOR_ID = C.AS_VENDOR_ID
				                                    AND F.HISTORY_GB = '01'
				                                    AND FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID) BETWEEN F.EFF_STA_DT AND F.EFF_END_DT
				                                    AND C.VENDOR_ID    = G.VENDOR_ID
				                                    AND G.EFF_END_DT    = '99991231'
				                                    AND G.VD_TYPE_CD    NOT IN ('0423','0424')
				                                    and d.order_id = h.order_id
				                                UNION ALL
				                                SELECT  /*+ ORDERED USE_NL(A B C D F) INDEX(A LSSHPM_IND1)
				                                            INDEX(F, ITASRN_PK) USE_HASH(G) */
				                                        '23.몰매출-위탁--반품'  DATA_GB,
				                                        FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
				                                        A.STORAGE_ID        STORAGE_ID,
				                                        A.SHIP_ID           SHIP_ID,    /* 출고번호 */
				                                        B.SHIP_SEQ          SHIP_SEQ,   /* 출고내역번호 */
				                                        A.SHIP_GB           SHIP_GB,
				                                        B.SITE_GB           SITE_GB,    /* 사이트별 매출 구분값 */
				                                        A.APPLY_DAY         apply_day,    /* 매출일자 */
				                                        a.apply_time        apply_time,
				                                        B.ORDER_ID          ORDER_ID,   /* 주문번호 */
				                                        B.ORDER_SEQ         ORDER_SEQ,  /* 주문순번 */
				                                        B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
				                                        B.ASSORT_ID         ASSORT_ID,  /* 품목코드 */
				                                        B.ORDER_ITEM_ID     ITEM_ID,    /* 상품코드 */
				                                        B.SHIP_QTY          QTY,        /* 수량 */
				                                        (
				                                        SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                               COUNT(*)
				                                          FROM RMORDD R,
				                                               RMORDD S
				                                         WHERE B.ORDER_ID = R.ORDER_ID
				                                           AND B.ORDER_SEQ = R.ORDER_SEQ
				                                           AND R.ORDER_ID = S.ORDER_ID
				                                           AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                        ) SET_QTY,
				                                        B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
				                                        0 SALE_COST,
				                                        0 CUSTOMS_TAX,
				                                        ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) NOPAY_AMT,
				                                        (B.SHIP_QTY * B.ORDER_DISCOUNT) - ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) SALE_RATE,
				                                        0 SALE_TRAN,
				                                        0 SALE_ITEM,
				                                        h.contact_site contact_site,
				                                        h.join_id
				                                   FROM LSSHPM A,
				                                        LSSHPD B,
				                                        ITASRT C,
				                                        RMORDD D,
				                                        ITASRN F,
				                                        CMVDMR G,
				                                        rmordm h
				                                  WHERE A.APPLY_DAY >= #{as_from_dt}
				                                    AND A.APPLY_DAY <= #{as_to_dt}
				                                    AND A.SITE_GB ='22'
				                                    AND A.SHIP_STATUS IN ('24')
				                                    AND A.SHIP_GB||'' IN ('21','22')
				                                    AND B.SHIP_ID = A.SHIP_ID
				                                    AND A.SITE_GB  LIKE #{as_service_gb}
				                                    AND B.SITE_GB  LIKE #{as_site_gb}
				                                    AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
				                                    AND C.ASSORT_ID = B.ASSORT_ID
				                                    AND D.ORDER_ID (+) = B.ORDER_ID
				                                    AND D.ORDER_SEQ (+) = B.ORDER_SEQ
				                                    AND F.ASSORT_ID = C.ASSORT_ID
				                                    AND F.VENDOR_ID = C.AS_VENDOR_ID
				                                    AND F.HISTORY_GB = '01'
				                                    AND FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID) BETWEEN F.EFF_STA_DT AND F.EFF_END_DT
				                                    AND C.VENDOR_ID    = G.VENDOR_ID
				                                    AND G.EFF_END_DT    = '99991231'
				                                    AND G.VD_TYPE_CD    NOT IN ('0423','0424')
				                                    and d.order_id = h.order_id
				                                UNION ALL
				                                SELECT /*+ ORDERED USE_NL(A B C D) INDEX(A LSSHPM_IND1)
				                                           USE_HASH(G) */
				                                        '12.몰매출-사입-출고'   DATA_GB,
				                                        FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
				                                        A.STORAGE_ID        STORAGE_ID,
				                                        A.SHIP_ID    SHIP_ID,
				                                        B.SHIP_SEQ   SHIP_SEQ,
				                                        A.SHIP_GB    SHIP_GB,
				                                        B.SITE_GB SITE_GB,
				                                        A.APPLY_DAY     APPLY_DAY,
				                                        a.apply_time    apply_time,
				                                        B.ORDER_ID,
				                                        B.ORDER_SEQ,
				                                        B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
				                                        B.ASSORT_ID ASSORT_ID,
				                                        B.ORDER_ITEM_ID ITEM_ID,
				                                        B.SHIP_QTY QTY,
				                                        (
				                                        SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                               COUNT(*)
				                                          FROM RMORDD R,
				                                               RMORDD S
				                                         WHERE B.ORDER_ID = R.ORDER_ID
				                                           AND B.ORDER_SEQ = R.ORDER_SEQ
				                                           AND R.ORDER_ID = S.ORDER_ID
				                                           AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                        ) SET_QTY,
				                                        B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
				                                        B.SALE_COST,
				                                        0 CUSTOMS_TAX,
				                                        0 NOPAY_AMT,
				                                        0 SALE_RATE,
				                                        0 SALE_TRAN,
				                                        (B.SHIP_QTY * B.ORDER_DISCOUNT) SALE_ITEM,
				                                        h.contact_site contact_site
				                                        ,h.join_id
				                                   FROM LSSHPM A,
				                                        LSSHPD B,
				                                        ITASRT C,
				                                        CMVDMR G,
				                                        RMORDD D,
				                                        rmordm h
				                                  WHERE A.APPLY_DAY >= #{as_from_dt}
				                                    AND A.APPLY_DAY <= #{as_to_dt}
				                                    AND A.SITE_GB = '22'
				                                    AND A.SHIP_STATUS IN ('14')
				                                    AND A.SHIP_GB||'' IN ('11','12')
				                                    AND B.SHIP_ID = A.SHIP_ID
				                                    AND A.SITE_GB  LIKE #{as_service_gb}
				                                    AND B.SITE_GB  LIKE #{as_site_gb}
				                                    AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
				                                    AND C.ASSORT_ID = B.ASSORT_ID
				                                    AND C.VENDOR_ID = G.VENDOR_ID
				                                    AND G.EFF_END_DT = '99991231'
				                                    AND G.VD_TYPE_CD IN ('0423','0424')
				                                    AND D.ORDER_ID (+) = B.ORDER_ID
				                                    AND D.ORDER_SEQ (+) = B.ORDER_SEQ
				                                    and d.order_id = h.order_id
				                            UNION ALL
				                            SELECT /*+ ORDERED USE_NL(A B C D) INDEX(A LSSHPM_IND1)
				                                       USE_HASH(G) */
				                                    '22.몰매출-사입-반품'   DATA_GB,
				                                    FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
				                                    A.STORAGE_ID        STORAGE_ID,
				                                    A.SHIP_ID    SHIP_ID,
				                                    B.SHIP_SEQ   SHIP_SEQ,
				                                    A.SHIP_GB    SHIP_GB,
				                                    B.SITE_GB SITE_GB,
				                                    A.APPLY_DAY     APPLY_DAY,
				                                    a.apply_time    apply_time,
				                                    B.ORDER_ID,
				                                    B.ORDER_SEQ,
				                                    B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
				                                    B.ASSORT_ID ASSORT_ID,
				                                    B.ORDER_ITEM_ID ITEM_ID,
				                                    B.SHIP_QTY QTY,
				                                    (
				                                    SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
				                                           COUNT(*)
				                                      FROM RMORDD R,
				                                           RMORDD S
				                                     WHERE B.ORDER_ID = R.ORDER_ID
				                                       AND B.ORDER_SEQ = R.ORDER_SEQ
				                                       AND R.ORDER_ID = S.ORDER_ID
				                                       AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
				                                    ) SET_QTY,
				                                    B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
				                                    B.SALE_COST,
				                                    0 CUSTOMS_TAX,
				                                    0 NOPAY_AMT,
				                                    0 SALE_RATE,
				                                    0 SALE_TRAN,
				                                    (B.SHIP_QTY * B.ORDER_DISCOUNT) SALE_ITEM,
				                                    h.contact_site contact_site
				                                    ,h.join_id
				                               FROM LSSHPM A,
				                                    LSSHPD B,
				                                    ITASRT C,
				                                    CMVDMR G,
				                                    RMORDD D,
				                                    rmordm h
				                              WHERE A.APPLY_DAY >= #{as_from_dt}
				                                AND A.APPLY_DAY <= #{as_to_dt}
				                                AND A.SITE_GB = '22'
				                                AND A.SHIP_STATUS IN ('24')
				                                AND A.SHIP_GB||'' IN ('21','22')
				                                AND B.SHIP_ID = A.SHIP_ID
				                                AND A.SITE_GB  LIKE #{as_service_gb}
				                                AND B.SITE_GB  LIKE #{as_site_gb}
				                                AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
				                                AND C.ASSORT_ID = B.ASSORT_ID
				                                AND C.VENDOR_ID = G.VENDOR_ID
				                                AND G.EFF_END_DT = '99991231'
				                                AND G.VD_TYPE_CD IN ('0423','0424')
				                                AND D.ORDER_ID (+) = B.ORDER_ID
				                                AND D.ORDER_SEQ (+) = B.ORDER_SEQ
				                                and d.order_id = h.order_id
				                                ) X,
				                                ITASRT Z,
				                                CMCODE B
				                        WHERE   X.ASSORT_ID   = Z.ASSORT_ID
				                        AND     X.SITE_GB     = B.CD_MINOR
				                        AND     B.CD_MAJOR    = '0072'
				                        AND     B.CD_FR_MINOR = '20'
				                        AND     B.CD_END_DT   = '99991231235959'
				                    GROUP BY    X.SITE_GB, Z.DISP_CATEGORY_ID, X.DATA_GB,x.contact_site,x.join_id,z.vendor_id,z.brand_id,z.assort_id,z.assort_nm,z.assort_model, x.order_id,x.order_seq          
				                    ,x.apply_day,x.apply_time
				                    ) A
				                ) A
				        GROUP BY    VENDOR_ID, DISP_CATEGORY_ID,contact_site,join_nm,vendor_id_n,brand_id_n,assort_id_n,assort_nm_n,assort_model_n, order_id ,order_seq          
				        ,apply_day
				        ,apply_time
				) A
				,cmvdmr b
				where a.vendor_id_n =b.vendor_id(+)
				and '99991231' = b.eff_end_dt(+)
				GROUP BY a.VENDOR_ID,a.DISP_B_CATEGORY_NM, a.DISP_M_CATEGORY_NM,a.DISP_S_CATEGORY_NM,a.contact_site,a.join_nm,a.vendor_id_n,a.brand_id_n,a.assort_id_n,a.assort_nm_n,a.assorT_model_n          
				 ,a.apply_day
				,b.vd_nm
				,b.VD_INTERNATIONAL_GB
				,b.VD_SELLER_GB       
				,b.VD_GB       
				,a.MOBILE_ORDER_YN       
				,a.order_id
				,a.order_seq
				,a.apply_time
				) aa
				where aa.order_qty > 0
				and aa.apply_day <'20190101' 		  
		  	]]>
		  </select>	

		  <select id="select_ship_2019_list"  resultType="java.util.LinkedHashMap">
			<![CDATA[ 
				select aa.site_gb 
				,aa.site_nm site
				,aa.order_id beq_order_id
				,aa.order_seq beq_order_seq
				,'출고' status
				,aa.DISP_B_CATEGORY_NM large_category
				,aa.DISP_M_CATEGORY_NM medium_category
				,aa.DISP_S_CATEGORY_NM small_category
				,aa.contact_site purchase_site
				,aa.join_nm affiliate
				,aa.vendor_id_n account_id
				,aa.vd_nm account
				,aa.brand_id_n brand_id
				,aa.brand_nm brand
				,aa.brand_enm
				,aa.assort_id_n product_code
				,aa.assort_nm_n product
				,nvl(aa.assort_model_n,'*') assort_model_n
				,aa.user_nm md
				,aa.order_QTY quantity
				,aa.ORDER_DISCOUNT           
				,aa.SALE_COST                
				,aa.CUSTOMS_TAX              
				,aa.NOPAY_AMT                
				,aa.SALE_RATE                
				,aa.SALE_TRAN                
				,aa.SALE_ITEM                
				,aa.SALE_EXCEPT_ITEM         
				,aa.SALE_TOTAL   
				,round ( aa.sale_total / aa.order_discount , 4) * 100 sale_total_rate            
				,aa.COST_ITEM                
				,aa.COST_TRAN                
				,aa.COST_SORTING_FEE         
				,aa.FIX_SORTING_FEE          
				,aa.COST_GSM_CARD_FEE         
				,aa.coupon_amt
				,aa.point_amt
				,aa.sun_SALE_TOTAL
				,round ( sun_sale_total / order_discount , 4) * 100 sun_sale_total_rate
				,aa.c1 company
				,aa.c2 sales
				,aa.c3 marketing
				,aa.c4 operation
				,aa.c5 address
				,aa.c6 employee
				,aa.bb1 coupon_total
				,aa.b4 coupon_sales_marketing
				,aa.coupon_amt_set
				,aa.VD_INTERNATIONAL_GB
				,nvl(aa.VD_SELLER_GB,'*') VD_SELLER_GB       
				,nvl(aa.VD_GB     ,'*') VD_GB
				,aa.MOBILE_ORDER_YN  
				,sun_sale_total - (  cost_item +  cost_tran +  cost_sorting_fee +  fix_sorting_fee ) sale_profit
				,round ( (sun_sale_total - (  cost_item +  cost_tran +  cost_sorting_fee +  fix_sorting_fee )) / order_discount , 4) * 100 sale_profit_rate
				,to_char(to_timestamp(aa.apply_day || aa.apply_time,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') created_at
			from (
			SELECT  /* d_ac110801lp_master_3 : 판매실적(GMS)*/
			        MAX(A.SITE_GB)                          AS  SITE_GB,                    /*사이트구분*/
			        MAX(A.SITE_NM)                          AS  SITE_NM,                    /*사이트명*/
			        a.order_id ,a.order_seq,        
			        apply_day,apply_time,
			        A.DISP_B_CATEGORY_NM                    AS  DISP_B_CATEGORY_NM,         /*카테고리대분류*/
			        A.DISP_M_CATEGORY_NM                    AS  DISP_M_CATEGORY_NM,         /*카테고리중분류*/
			        A.DISP_S_CATEGORY_NM                    AS  DISP_S_CATEGORY_NM,         /*카테고리소분류*/
			        decode(a.contact_site,'10','WIZWID','20','SKINRX','30','HAUOLIN','40','SPORTS25')      as contact_site,
			        a.join_nm,
			         a.vendor_id_n,
			        b.vd_nm,         
			         a.brand_id_n,                 
			         (select max(x.brand_knm) from itbrnd x where x.brand_id = a.brand_id_n) brand_nm,
			         (select max(x.brand_enm) from itbrnd x where x.brand_id = a.brand_id_n) brand_enm,
			         a.assort_id_n,        
			         a.assort_nm_n,
			        a.assort_model_n,
			         (select y.user_nm from itasrt x,cmuser y where x.assort_id = a.assort_id_n and x.user_id = y.user_id) user_nm,
			--        SUM(A.CNT)                              AS  CNT,                        /*전체건수*/
			--        SUM(A.QTY)                              AS  QTY,                        /*전체수량*/
			--        SUM(A.SHIP_CNT)                         AS  SHIP_CNT,                   /*출고건수 : 소팅피 계산시 사용*/
			        SUM(A.QTY_CHGO)                         AS  QTY_CHGO,                   /*출고수량*/
			        SUM(A.QTY_IPGO)                         AS  QTY_IPGO,                   /*반품수량*/
			        SUM(A.QTY_CHGO) + SUM(A.QTY_IPGO)       AS  order_QTY,
			--        SUM(A.ORDER_DISCOUNT_CHGO)              AS  ORDER_DISCOUNT_CHGO,        /*출고금액*/
			--        SUM(A.ORDER_DISCOUNT_IPGO)              AS  ORDER_DISCOUNT_IPGO,        /*반품금액*/
			        SUM(A.ORDER_DISCOUNT)                   AS  ORDER_DISCOUNT,             /*GMS*/
			        SUM(A.SALE_COST)                        AS  SALE_COST,                  /*샵물대 또는 상품원가*/
			        SUM(A.CUSTOMS_TAX)                      AS  CUSTOMS_TAX,                /*관세등*/
			        SUM(A.NOPAY_AMT)                        AS  NOPAY_AMT,                  /*업체물대*/
			        SUM(A.SALE_RATE)                        AS  SALE_RATE,                  /*수수료매출*/
			        SUM(A.SALE_TRAN)                        AS  SALE_TRAN,                  /*운송매출*/
			        SUM(A.SALE_ITEM)                        AS  SALE_ITEM,                  /*상품매출*/
			        SUM(A.SALE_EXCEPT_ITEM)                 AS  SALE_EXCEPT_ITEM,           /*매출제외금액*/
			        SUM(A.SALE_TOTAL)                       AS  SALE_TOTAL,                 /*매출총액*/
			        SUM(A.COST_ITEM)                        AS  COST_ITEM,                  /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
			        SUM(A.COST_TRAN)                        AS  COST_TRAN,                  /*운송매출원가 - 국제운송원가*/
			        SUM(A.COST_SORTING_FEE)                 AS  COST_SORTING_FEE,           /*운송매출원가 - SORTING FEE*/
			        SUM(A.FIX_SORTING_FEE)                  AS  FIX_SORTING_FEE,            /*운송매출원가 - 고정비*/
			        SUM(A.COST_GSM_CARD_FEE)                AS  COST_GSM_CARD_FEE           /*구매대행매출원가 - GSM 카드결제 수수료*/
			        ,sum(nvl(a.coupon_amt,0) + nvl(a.coupon_amt_minus,0)) coupon_amt
			        ,sum(nvl(a.point_amt,0) + nvl(a.point_amt_minus,0)) point_amt
			, SUM(A.SALE_TOTAL)  - (sum(nvl(cc3,0) + nvl(cc4,0))   +   sum(nvl(cc5,0) + nvl(cc6,0))   +   sum(nvl(cc7,0) + nvl(cc8,0))   +   sum(nvl(cc9,0) + nvl(cc10,0))  ) -  (sum(nvl(a.point_amt,0) + nvl(a.point_amt_minus,0)))                    AS  sun_SALE_TOTAL
			,sum(nvl(cc1,0) + nvl(cc2,0)) c1
			,sum(nvl(cc3,0) + nvl(cc4,0)) c2
			,sum(nvl(cc5,0) + nvl(cc6,0)) c3
			,sum(nvl(cc7,0) + nvl(cc8,0)) c4
			,sum(nvl(cc9,0) + nvl(cc10,0)) c5
			,sum(nvl(cc11,0) + nvl(cc12,0)) c6
			,sum(nvl(bb1,0) + nvl(bb2,0)) bb1
			,sum(nvl(cc3,0) + nvl(cc4,0)) + sum(nvl(cc5,0) + nvl(cc6,0)) + sum(nvl(cc7,0) + nvl(cc8,0)) + sum(nvl(cc9,0) + nvl(cc10,0)) b4
			,sum( nvl(coupon_amt_set,0) + nvl(coupon_amt_minus_set,0) ) coupon_amt_set
			,decode(b.VD_INTERNATIONAL_GB,'03','03','') VD_INTERNATIONAL_GB
			,b.VD_SELLER_GB       
			,b.VD_GB     
			,decode(a.MOBILE_ORDER_YN,'01','WEB','02','MOBILE','03','APP') MOBILE_ORDER_YN         
			FROM    (
			        SELECT  /* d_ac110801lp_master_3 : 판매실적(GMS)*/
			                MAX(A.SITE_GB)                          AS  SITE_GB,                    /*사이트구분*/
			                A.VENDOR_ID                             AS  VENDOR_ID,                  /*사이트구분*/
			                MAX(A.SITE_NM)                          AS  SITE_NM,                    /*사이트명*/
			                A.DISP_CATEGORY_ID                      AS  DISP_CATEGORY_ID,           /*부서코드*/
			/*                (SELECT CATEGORY_NM
			                 FROM ITCATG
			                 WHERE LVL = '1'
			                 START WITH CATEGORY_ID = A.DISP_CATEGORY_ID
			                 CONNECT BY PRIOR UP_CATEGORY_ID = CATEGORY_ID
			                 ) DISP_B_CATEGORY_NM,
			               (SELECT CATEGORY_NM
			                 FROM ITCATG
			                 WHERE LVL = '2'
			                 START WITH CATEGORY_ID = A.DISP_CATEGORY_ID
			                 CONNECT BY PRIOR UP_CATEGORY_ID = CATEGORY_ID
			                 ) DISP_M_CATEGORY_NM,
			               (SELECT CATEGORY_NM
			                 FROM ITCATG
			                 WHERE LVL = '3'
			                 START WITH CATEGORY_ID = A.DISP_CATEGORY_ID
			                 CONNECT BY PRIOR UP_CATEGORY_ID = CATEGORY_ID
			                 ) DISP_S_CATEGORY_NM,*/
			                FIT0017P(A.DISP_CATEGORY_ID,1,'02') DISP_B_CATEGORY_NM,
			                FIT0017P(A.DISP_CATEGORY_ID,2,'02') DISP_M_CATEGORY_NM,
			                FIT0017P(A.DISP_CATEGORY_ID,3,'02') DISP_S_CATEGORY_NM,
			                 a.contact_site,
			                 a.join_nm,
			                 a.vendor_id_n,
			                 a.brand_id_n,
			                 a.assort_id_n,
			                 a.assort_nm_n,
			                 a.assort_model_n,
			                SUM(A.CNT)                              AS  CNT,                        /*전체건수*/
			                SUM(A.QTY)                              AS  QTY,                        /*전체수량*/
			                SUM(A.SHIP_CNT)                         AS  SHIP_CNT,                   /*출고건수 : 소팅피 계산시 사용*/
			                SUM(A.QTY_CHGO)                         AS  QTY_CHGO,                   /*출고수량*/
			                SUM(A.QTY_IPGO)                         AS  QTY_IPGO,                   /*반품수량*/
			                SUM(A.ORDER_DISCOUNT_CHGO)              AS  ORDER_DISCOUNT_CHGO,        /*출고금액*/
			                SUM(A.ORDER_DISCOUNT_IPGO)              AS  ORDER_DISCOUNT_IPGO,        /*반품금액*/
			                SUM(A.ORDER_DISCOUNT)                   AS  ORDER_DISCOUNT,             /*GMS*/
			                SUM(A.SALE_COST)                        AS  SALE_COST,                  /*샵물대 또는 상품원가*/
			                SUM(A.CUSTOMS_TAX)                      AS  CUSTOMS_TAX,                /*관세등*/
			                SUM(A.NOPAY_AMT)                        AS  NOPAY_AMT,                  /*업체물대*/
			                SUM(A.SALE_RATE)                        AS  SALE_RATE,                  /*수수료매출*/
			                SUM(A.SALE_TRAN)                        AS  SALE_TRAN,                  /*운송매출*/
			                SUM(A.SALE_ITEM)                        AS  SALE_ITEM,                  /*상품매출*/
			                SUM(A.SALE_EXCEPT_ITEM)                 AS  SALE_EXCEPT_ITEM,           /*매출제외금액*/
			                SUM(A.SALE_TOTAL)                       AS  SALE_TOTAL,                 /*매출총액*/
			                SUM(A.COST_ITEM)                        AS  COST_ITEM,                  /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
			                SUM(A.COST_TRAN)                        AS  COST_TRAN,                  /*운송매출원가 - 국제운송원가*/
			                SUM(A.COST_SORTING_FEE)                 AS  COST_SORTING_FEE,           /*운송매출원가 - SORTING FEE*/
			                SUM(A.FIX_SORTING_FEE1)                 AS  FIX_SORTING_FEE,            /*운송매출원가 - 고정비*/
			                SUM(A.COST_GSM_CARD_FEE)                AS  COST_GSM_CARD_FEE           /*구매대행매출원가 - GSM 카드결제 수수료*/
			                , a.order_id ,a.order_seq
			                ,(
			                select sum(b.amt_real)
			                from rmdmdl b
			                where b.order_id = a.order_id
			                and b.order_seq = a.order_seq
			                and b.pay_cd ='13'
			                and b.INOUT_GB = '01'
			                ) coupon_amt
			                ,(
			                select sum(b.amt_real)
			                from rmdmdl b
			                where b.order_id = a.order_id
			                and b.order_seq = a.order_seq
			                and b.pay_cd ='10'
			                and b.INOUT_GB = '01'
			                ) point_amt    
			                ,(
			                select sum(c.amt_real)
			                from rmordd b,rmdmdl c
			                where b.order_id = a.order_id
			                and b.order_seq = a.order_seq
			                and b.bef_order_id = c.order_id
			                and b.bef_order_seq = c.order_seq
			                and c.pay_cd ='13'
			                and c.INOUT_GB = '02'
			                ) coupon_amt_minus
			                ,(
			                select sum(c.amt_real)
			                from rmordd b,rmdmdl c
			                where b.order_id = a.order_id
			                and b.order_seq = a.order_seq
			                and b.bef_order_id = c.order_id
			                and b.bef_order_seq = c.order_seq
			                and c.pay_cd ='10'
			                and c.INOUT_GB = '02'
			                ) point_amt_minus                
			                ,a.apply_day
			                ,a.apply_time
			
			   ,(
			                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and aa.order_ret_gb like '1%'
			                ) bb1
			                ,(
			                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                and aa.order_ret_gb like '2%'
			                 ) bb2
			                ,(
			                select sum(b.amt_real *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmdmdl b
			                where aa.order_id = a.order_id
			                and aa.order_seq = a.order_seq
			                and aa.order_ret_gb like '1%'
			                and b.order_id = aa.order_id
			                and b.order_seq = decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq)
			                and b.pay_cd ='13'
			                and b.INOUT_GB = '01'
			                and aa.set_gb ='04'
			                ) coupon_amt_set
			                ,(
			                select sum(c.amt_real * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd b,rmordd aa,rmdmdl c
			                where b.order_id = a.order_id
			                and b.order_seq = a.order_seq
			                and b.order_ret_gb like '2%'
			                and b.bef_order_id = aa.order_id
			                and b.bef_order_seq = aa.order_seq
			                and aa.order_id = c.order_id
			                and decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = c.order_seq
			                and c.pay_cd ='13'
			                and c.INOUT_GB = '02'
			                and b.set_gb ='04'
			                ) coupon_amt_minus_set
			                
			                ,(
			                select sum(bb.vendor_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and  bb.md_gb='01'
			                and aa.order_ret_gb like '1%'
			                ) cc1
			                ,(
			                select sum(bb.vendor_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                 and  bb.md_gb='01'
			                and aa.order_ret_gb like '2%'
			                 ) cc2    
			                 
			                ,(
			                select sum(bb.burden_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and  bb.md_gb='01'
			                and aa.order_ret_gb like '1%'
			                ) cc3
			                ,(
			                select sum(bb.burden_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                 and  bb.md_gb='01'
			                and aa.order_ret_gb like '2%'
			                 ) cc4         
			                 
			               ,(
			                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and  bb.md_gb in ('02','03')
			                and aa.order_ret_gb like '1%'
			                ) cc5
			                ,(
			                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                and  bb.md_gb in ('02','03')
			                and aa.order_ret_gb like '2%'
			                 ) cc6      
			               ,(
			                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and  bb.md_gb in ('04')
			                and aa.order_ret_gb like '1%'
			                ) cc7
			                ,(
			                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                and  bb.md_gb in ('04')
			                and aa.order_ret_gb like '2%'
			                 ) cc8                                                 
			               ,(
			                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and  bb.md_gb in ('05')
			                and aa.order_ret_gb like '1%'
			                ) cc9
			                ,(
			                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                and  bb.md_gb in ('05')
			                and aa.order_ret_gb like '2%'
			                 ) cc10       
			              ,(
			                select sum(bb.coupon_amt *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq = a.order_seq
			                and  aa.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',aa.set_order_Seq,aa.order_seq) = bb.order_seq
			                and  bb.md_gb in ('06')
			                and aa.order_ret_gb like '1%'
			                ) cc11
			                ,(
			                select sum(bb.coupon_amt * -1 *  decode(aa.set_gb,'04',0.5,1) )
			                from rmordd aa,rmordd cc,order_coupon@wizwiddw bb
			                where aa.order_id = a.order_id
			                and  aa.order_seq =a.order_seq
			                and aa.bef_order_id = cc.order_id
			                and aa.bef_order_seq = cc.order_seq
			                and  cc.order_id = bb.order_id
			                and  decode(aa.set_gb,'04',cc.set_order_Seq,cc.order_seq) = bb.order_seq
			                and  bb.md_gb in ('06')
			                and aa.order_ret_gb like '2%'
			                 ) cc12                             
			                   ,(select aa.MOBILE_ORDER_YN from rmordm aa where aa.order_id = a.order_id) MOBILE_ORDER_YN                            
			        FROM    (
			                SELECT  A.SITE_GB,
			                        A.VENDOR_ID,
			                        A.SITE_NM,
			                        A.STORAGE_ID,
			                        A.DATA_GB,
			                        A.DISP_CATEGORY_ID,
			                        A.CNT,
			                        A.QTY,
			                        A.SHIP_CNT,
			                        A.NOSET_QTY_CHGO + (A.SET_QTY_CHGO/2) QTY_CHGO,
			                        A.NOSET_QTY_IPGO + (A.SET_QTY_IPGO/2) QTY_IPGO,
			                        A.ORDER_DISCOUNT_CHGO,
			                        A.ORDER_DISCOUNT_IPGO,
			                        A.ORDER_DISCOUNT,
			                        A.SALE_COST,
			                        A.CUSTOMS_TAX,
			                        A.NOPAY_AMT,
			                        ROUND(A.SALE_RATE/1.1)      AS  SALE_RATE,
			                        A.SALE_TRAN                 AS  SALE_TRAN,
			                        ROUND(A.SALE_ITEM/1.1)      AS  SALE_ITEM,
			                        A.SALE_EXCEPT_ITEM                                              AS  SALE_EXCEPT_ITEM,
			                        ROUND(A.SALE_RATE/1.1) + A.SALE_TRAN + ROUND(A.SALE_ITEM/1.1)   AS  SALE_TOTAL,
			                        A.COST_ITEM,                                                        /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
			                        A.COST_TRAN,                                                        /*운송매출원가 - 국제운송원가*/
			                        A.COST_SORTING_FEE,                                                 /*운송매출원가 - SORTING FEE*/
			                        A.FIX_SORTING_FEE,                                                  /*운송매출원가 - 고정 SORTING FEE*/
			                        SUM(CASE WHEN A.STORAGE_ID <> 'MALL' AND ( SUBSTR(A.DATA_GB, 1, 2) = '11' OR SUBSTR(A.DATA_GB, 1, 2) = '12' OR SUBSTR(A.DATA_GB, 1, 2) = '14') THEN A.SHIP_CNT
			                                                ELSE 0
			                                                END ) OVER (PARTITION BY A.STORAGE_ID) FIX_SHIP_CNT,
			                        ROUND(A.FIX_SORTING_FEE / DECODE(SUM(CASE WHEN A.STORAGE_ID <> 'MALL' AND ( SUBSTR(A.DATA_GB, 1, 2) = '11' OR SUBSTR(A.DATA_GB, 1, 2) = '12' OR SUBSTR(A.DATA_GB, 1, 2) = '14') THEN A.SHIP_CNT
			                                                         ELSE 0
			                                                         END ) OVER (PARTITION BY A.STORAGE_ID), 0, 1, SUM(  CASE WHEN A.STORAGE_ID <> 'MALL' AND ( SUBSTR(A.DATA_GB, 1, 2) = '11' OR SUBSTR(A.DATA_GB, 1, 2) = '12' OR SUBSTR(A.DATA_GB, 1, 2) = '14') THEN A.SHIP_CNT
			                                                                                                             ELSE 0
			                                                                                                             END ) OVER (PARTITION BY A.STORAGE_ID))
			                        ) FIX_SORTING_FEE1,
			                        CASE WHEN A.SITE_GB = '22' OR A.SITE_GB = '24' OR A.SITE_GB = '26' OR A.SITE_GB = '28' THEN 0
			                        ELSE (SELECT    TO_NUMBER(CD_REF1)  FROM    CMCODE WHERE    CD_MAJOR = '0619' AND #{as_to_dt}||'000000' BETWEEN CD_STA_DT AND CD_END_DT AND CD_MINOR <> '00')
			                        END * (ROUND(A.SALE_RATE/1.1) + A.SALE_TRAN + ROUND(A.SALE_ITEM/1.1)) COST_GSM_CARD_FEE ,    /*구매대행매출원가 - GSM 카드결제 수수료*/
			                        a.contact_site,
			                        a.join_nm,
			                        a.vendor_id_n vendor_id_n,
			                        a.brand_id_n brand_id_n,
			                        a.assort_id_n assort_id_n,
			                        a.assort_nm_n assort_nm_n
			                        ,a.assort_model_n
			                        , a.order_id ,a.order_seq
			                     ,a.apply_day,a.apply_time
			                FROM    (
			                        SELECT  /*+ ORDERED USE_NL(X Y) USE_HASH(Z, A, B, C) */
			                                X.SITE_GB                   AS SITE_GB,
			                                MAX(B.CD_REF1)              AS VENDOR_ID,
			                                MAX(B.CD_FNAME)             AS SITE_NM,
			                                X.O_STORAGE_ID              AS STORAGE_ID,
			                                X.DATA_GB                   AS DATA_GB,
			                                Z.DISP_CATEGORY_ID          AS DISP_CATEGORY_ID,
			                                x.contact_site              as contact_site,
			                                NVL((select join_nm 
			                                from   MKJONM MK 
			                                where  MK.join_id    = x.join_id 
			                                AND    MK.balance_gb = '02'
			                                and    MK.adjst_cd   = '05'
			                                and    MK.join_path  = '01'
			                                and    MK.join_type  IN ('03','13')
			                                and    MK.up_join_id = '*'
			                                ),'WIZWID') join_nm,      
			                                z.vendor_id vendor_id_n,
			                                z.brand_id brand_id_n,
			                                z.assort_id assort_id_n ,                                                         
			                                z.assort_nm assort_nm_n ,
			                                z.assort_model assort_model_n,
			                                /*x.join_id                   as join_id,*/
			                                SUM(ABS(X.QTY))             AS CNT,
			                                SUM(X.QTY)                  AS QTY,
			                                SUM(1/CNT)                  AS SHIP_CNT,
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 1, X.QTY, 0), 0))     AS NOSET_QTY_CHGO,      /*출고*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 1, X.QTY, 0), 0))     AS NOSET_QTY_IPGO,      /*반품*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 1, 0, X.QTY), 0))     AS SET_QTY_CHGO,        /*출고*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 1, 0, X.QTY), 0))     AS SET_QTY_IPGO,        /*반품*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_CHGO,     /*출고*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_IPGO,     /*반품*/
			                                SUM(X.ORDER_DISCOUNT)       AS ORDER_DISCOUNT,
			                                SUM(X.SALE_COST)            AS SALE_COST,
			                                SUM(X.CUSTOMS_TAX)          AS CUSTOMS_TAX,
			                                SUM(X.NOPAY_AMT)            AS NOPAY_AMT,
			                                SUM(X.SALE_RATE)            AS SALE_RATE,
			                                SUM(X.SALE_TRAN)            AS SALE_TRAN,
			                                SUM(X.SALE_ITEM)            AS SALE_ITEM,
			                                SUM(X.NOPAY_AMT + DECODE(SUBSTR(DATA_GB,1,2), '11', X.SALE_COST, 0) + X.CUSTOMS_TAX) AS SALE_EXCEPT_ITEM,   /*샵은 정상출고일때만 상품대를 매출제외금액에 포함.*/
			                                ROUND(SUM(X.SUM_WEIGHT))    AS SUM_WEIGHT,
			                                TRUNC(SUM(X.COST_TRAN))     AS COST_TRAN,
			                                SUM(DECODE(SUBSTR(X.DATA_GB,1,2), '13', X.SALE_COST, '14', X.SALE_COST, '26', X.SALE_COST,  '28', X.SALE_COST, 0)) COST_ITEM,   /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
			                                SUM(X.BASERATE * X.COST_SORTING_FEE * 1/CNT) COST_SORTING_FEE,                                              /*운송매출원가 - SORTING FEE*/
			                                SUM(X.BASERATE * X.FIX_SORTING_FEE * X.DATE_CNT * 1/CNT)  FIX_SORTING_FEE,
			                                MAX(X.DATE_CNT) DATE_CNT
			                                , x.order_id,x.order_seq
			                             ,x.apply_day
			                             ,x.apply_time
			                        FROM    (
			                                    SELECT /*+ ORDERED USE_HASH(B, C, D) FULL(D) */
			                                           /* SHOP 사전 정상출고 */
			                                           '11.SHOP 사전 정상출고' DATA_GB,
			                                           FLS0039P(ORDER_ID, ORDER_SEQ, ASSORT_ID) ORDER_DT,
			                                           SITE_GB,
			                                           ORDER_ID,
			                                           ORDER_SEQ,
			                                           APPLY_DAY,
			                                           apply_time,
			                                           DEPOSIT_NO,
			                                           DEPOSIT_SEQ,
			                                           SHIP_GB,
			                                           STORAGE_ID,
			                                           O_STORAGE_ID,
			                                           ASSORT_ID,
			                                           ITEM_ID,
			                                           ASSORT_WEIGHT,
			                                           SUBSTR(A.DELI_CURRENCY,1,2) DELI_COMPANY_ID,
			                                           SUBSTR(A.DELI_CURRENCY,3,2) CURRENCY_UNIT,
			                                           EXC_APP_DT,
			                                           QTY,
			                                           DECODE(SET_QTY,0,1,SET_QTY) SET_QTY,
			                                           ORDER_DISCOUNT,
			                                           SALE_COST,
			                                           CUSTOMS_TAX,
			                                           0 NOPAY_AMT,
			                                           ORDER_DISCOUNT - SALE_COST - CUSTOMS_TAX - (B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY)) SALE_RATE,
			                                           B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY) SALE_TRAN,
			                                           0 SALE_ITEM,
			                                           (C.TRANS_COST/CNT) COST_TRAN,
			                                           (SUM_WEIGHT - 0.5 * (CNT - 1)) / CNT SUM_WEIGHT,
			                                           CNT,
			                                           D.BASERATE,
			                                    CASE WHEN A.SITE_GB = '21' THEN  3                                   /*어드레스 3   달러*/
			                                    ELSE CASE WHEN  A.STORAGE_ID = '7' THEN 2.5      /*미국     2   달러*/
			                                        when  A.STORAGE_ID = '3'  then 3
			                                              WHEN A.STORAGE_ID = '4'                       THEN 1.2    /*이태리   1.2 유로*/
			                                              WHEN A.STORAGE_ID = '6'                       THEN 1      /*영국     1   파운드*/
			                                              WHEN A.STORAGE_ID = '8'                       THEN 249.15      /*일본 249.15엔*/
			                                              END
			                                    END COST_SORTING_FEE,                                               /*운송매출원가 - SORTING FEE*/
			                                    CASE WHEN A.SITE_GB = '21' THEN 0                                   /*어드레스 0   달러*/
			                                    ELSE CASE WHEN A.STORAGE_ID = '3' OR A.STORAGE_ID = '7' THEN 0      /*미국     0   달러*/
			                                              WHEN A.STORAGE_ID = '4'                       THEN 2000   /*이태리  2000 유로*/
			                                              WHEN A.STORAGE_ID = '6'                       THEN 1500   /*영국    1500 파운드*/
			                                              WHEN A.STORAGE_ID = '8'                       THEN 0 /*일본 0*/
			                                              END
			                                    END FIX_SORTING_FEE,                                                /*운송매출원가 - 고정비 SORTING FEE*/
			                                            (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                            a.contact_site,
			                                            a.join_id
			                                      FROM (
			                                            SELECT /*+ ORDERED USE_NL ( X A B C D) INDEX( A LSSHPM_IND4)
			                                                       NO_MERGE FULL(X) INDEX(D, ITASRN_PK) INDEX(E, ITASRN_PK) USE_HASH(F) SWAP_JOIN_INPUTS(F) */
			                                                   A.APPLY_DAY    APPLY_DAY,
			                                                   a.apply_time   apply_time,
			                                                   A.STORAGE_ID   STORAGE_ID,
			                                                   A.SHIP_GB      SHIP_GB,
			                                                   A.STORAGE_ID   O_STORAGE_ID,
			                                                   B.SITE_GB      SITE_GB,
			                                                   B.SHIP_ID      DEPOSIT_NO,
			                                                   B.SHIP_SEQ     DEPOSIT_SEQ,
			                                                   B.DEPOSIT_NO   MIN_DEPOSIT_NO,
			                                                   B.DEPOSIT_SEQ      MIN_DEPOSIT_SEQ,
			                                                   B.ORDER_ID     ORDER_ID,
			                                                   B.ORDER_SEQ    ORDER_SEQ,
			                                                   B.ASSORT_ID    ASSORT_ID,
			                                                   B.ORDER_ITEM_ID    ITEM_ID,
			                                                   B.SHIP_QTY     QTY,
			                                                   (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                                    COUNT(*)
			                                                    FROM RMORDD R,
			                                                         RMORDD S
			                                                    WHERE C.ORDER_ID = R.ORDER_ID
			                                                      AND C.ORDER_SEQ = R.ORDER_SEQ
			                                                      AND R.ORDER_ID = S.ORDER_ID
			                                                      AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                                       ) SET_QTY,
			                                                   B.SALE_COST     SALE_COST,
			                                                   B.ORDER_DISCOUNT    ORDER_DISCOUNT,
			                                                   nvl(B.CUSTOMS_TAX,0)       CUSTOMS_TAX,
			                                                   D.WEIGHT        ASSORT_WEIGHT,
			                                                   B.EXC_APP_DT    EXC_APP_DT,
			                                                   (SELECT CD_REF1||CD_REF2
			                                                     FROM CMCODE
			                                                    WHERE CD_MAJOR ='0504'
			                                                      AND CD_MINOR = A.STORAGE_ID
			                                                      AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_CURRENCY,
			                                                   SUM(E.WEIGHT) OVER (PARTITION BY A.SHIP_ID) SUM_WEIGHT,
			                                                   SUM(1) OVER (PARTITION BY A.SHIP_ID) CNT,
			                                                   g.CONTACT_SITE contact_site,
			                                            g.join_id
			                                              FROM CMSTGM X,
			                                                   LSSHPM A,
			                                                   LSSHPD B,
			                                                   RMORDD C,
			                                                   ITASRN D,
			                                                   ITASRN E,
			                                                   CMCODE F,
			                                                   rmordm g
			                                             WHERE X.STORAGE_GB ='01'
			                                               AND X.AREA_GB ='02'
			                                               AND A.STORAGE_ID = X.STORAGE_ID
			                                               AND A.APPLY_DAY >= #{as_from_dt}
			                                               AND A.APPLY_DAY <= #{as_to_dt}
			                                               AND A.SITE_GB  = '23'
			                                               AND A.SHIP_STATUS BETWEEN '12' AND '17'
			                                               AND A.REMAT_GB <> '01'
			                                               AND A.SHIP_ID  = B.SHIP_ID
			                                               AND A.SITE_GB  LIKE #{as_service_gb}
			                                               AND B.SITE_GB  LIKE #{as_site_gb}
			                                               AND B.ORDER_ID = C.ORDER_ID
			                                               AND B.ORDER_SEQ = C.ORDER_SEQ
			                                               AND B.ASSORT_ID = D.ASSORT_ID
			                                               AND D.HISTORY_GB = '01'
			                                               AND D.VENDOR_ID = C.VENDOR_ID
			                                               AND C.REG_DT BETWEEN D.EFF_STA_DT AND D.EFF_END_DT
			                                               AND B.ASSORT_ID = E.ASSORT_ID
			                                               AND E.HISTORY_GB = '01'
			                                               AND E.VENDOR_ID = C.VENDOR_ID
			                                               AND A.APPLY_DAY || A.APPLY_TIME BETWEEN E.EFF_STA_DT AND E.EFF_END_DT
			                                               AND A.STORAGE_ID = F.CD_MINOR
			                                               AND F.CD_MAJOR   = '0504'
			                                               AND B.EXC_APP_DT BETWEEN F.CD_STA_DT AND F.CD_END_DT
			                                               and c.order_id = g.order_id
			                                               ) A,
			                                                LSDLVT B,
			                                                LSDLVT C,
			                                                CMXCHM D
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = B.DELI_COMPANY_ID
			                                    AND C.VENDOR_ID ='002000'
			                                    AND C.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= C.EFF_STA_DT
			                                    AND A.APPLY_DAY <  C.EFF_END_DT
			                                    AND DECODE((A.SUM_WEIGHT - 0.5 * (CNT - 1)),0,1,(A.SUM_WEIGHT - 0.5 * (CNT - 1))) > C.WEIGHT_FROM
			                                    AND DECODE((A.SUM_WEIGHT - 0.5 * (CNT - 1)),0,1,(A.SUM_WEIGHT - 0.5 * (CNT - 1))) <=C.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = C.DELI_COMPANY_ID
			                                    AND SUBSTR(A.DELI_CURRENCY,3,2) = D.CURRENCY_UNIT
			                                    AND #{as_to_dt} BETWEEN D.APPLY_FROM AND D.APPLY_TO
			                                    UNION ALL
			                                    SELECT /*+ ORDERED USE_HASH(B, D) FULL(D) */
			                                           /* ADDRESS 사전 정상출고 */
			                                           '12.ADDRESS 사전 정상출고' DATA_GB,
			                                           FLS0039P(ORDER_ID, '001', ASSORT_ID) ORDER_DT,
			                                           SITE_GB,
			                                           ORDER_ID,
			                                           '001' ORDER_SEQ,
			                                           APPLY_DAY,
			                                           apply_time,
			                                           DEPOSIT_NO,
			                                           DEPOSIT_SEQ,
			                                           SHIP_GB,
			                                           STORAGE_ID,
			                                           O_STORAGE_ID,
			                                           ASSORT_ID,
			                                           ITEM_ID,
			                                           ASSORT_WEIGHT,
			                                           SUBSTR(A.DELI_CURRENCY,1,2) DELI_COMPANY_ID,
			                                           SUBSTR(A.DELI_CURRENCY,3,2) CURRENCY_UNIT,
			                                           EXC_APP_DT,
			                                           QTY,
			                                           SET_QTY,
			                                           ORDER_DISCOUNT,
			                                           SALE_COST,
			                                           CUSTOMS_TAX,
			                                           0 NOPAY_AMT,
			                                           0 SALE_RATE,
			                                           B.TRANS_AMT + (ORDER_DISCOUNT - SALE_COST - CUSTOMS_TAX - B.TRANS_AMT) SALE_TRAN,
			                                           0 SALE_ITEM,
			                                           B.TRANS_COST/DECODE(SET_QTY,0,1,SET_QTY) COST_TRAN,
			                                           0 SUM_WEIGHT,
			                                           1 CNT,
			                                           D.BASERATE,
			                                           3 COST_SORTING_FEE,
			                                           0 FIX_SORTING_FEE,                                               /*운송매출원가 - 고정비 SORTING FEE*/
			                                           (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                           a.contact_site contact_site,
			                                           a.join_id
			                                      FROM (
			                                            SELECT /*+ ORDERED USE_NL (X A B) INDEX(A LSSHPM_IND4)
			                                                       NO_MERGE FULL(X) */
			                                                   A.APPLY_DAY    APPLY_DAY,
			                                                   a.apply_time   apply_time,
			                                                   A.STORAGE_ID   STORAGE_ID,
			                                                   A.SHIP_GB      SHIP_GB,
			                                                   A.STORAGE_ID   O_STORAGE_ID,
			                                                   A.SITE_GB      SITE_GB,
			                                                   A.SHIP_ID      DEPOSIT_NO,
			                                                   '001'          DEPOSIT_SEQ,
			                                                   A.ORDER_ID     ORDER_ID,
			                                                   '799999999'    ASSORT_ID,
			                                                   '9999'         ITEM_ID,
			                                                   1          QTY,
			                                                   1          SET_QTY,
			                                                   (SELECT SUM(ORDER_DISCOUNT)
			                                                          FROM LSSHPD
			                                                         WHERE SHIP_ID = A.SHIP_ID) ORDER_DISCOUNT,
			                                                   0          SALE_COST,
			                                                   (SELECT SUM(CUSTOMS_TAX)
			                                                      FROM LSSHPD
			                                                     WHERE SHIP_ID = A.SHIP_ID) CUSTOMS_TAX,
			                                                   B.DWEIGHT      ASSORT_WEIGHT,
			                                                   A.APPLY_DAY    EXC_APP_DT,
			                                                   (SELECT CD_REF1||CD_REF2
			                                                     FROM CMCODE
			                                                    WHERE CD_MAJOR ='0504'
			                                                      AND CD_MINOR = A.STORAGE_ID
			                                                      AND A.APPLY_DAY BETWEEN CD_STA_DT AND CD_END_DT) DELI_CURRENCY,
			                                                      b.contact_site contact_site,
			                                                b.join_id
			                                              FROM CMSTGM X,
			                                                   LSSHPM A,
			                                                   RMORDM B
			                                             WHERE X.STORAGE_GB ='01'
			                                               AND X.AREA_GB ='02'
			                                               AND A.STORAGE_ID = X.STORAGE_ID
			                                               AND A.APPLY_DAY >= #{as_from_dt}
			                                               AND A.APPLY_DAY <= #{as_to_dt}
			                                               AND A.SITE_GB = '21'
			                                               AND A.SITE_GB = '23'
			                                               AND A.SITE_GB  LIKE #{as_site_gb}
			                                               AND A.SHIP_STATUS BETWEEN '12' AND '17'
			                                               AND A.ORDER_ID = B.ORDER_ID
			                                               ) A,
			                                                LSDLVT B,
			                                                CMXCHM D
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = B.DELI_COMPANY_ID
			                                    AND SUBSTR(A.DELI_CURRENCY,3,2) = D.CURRENCY_UNIT
			                                    AND #{as_to_dt} BETWEEN D.APPLY_FROM AND D.APPLY_TO
			                                    UNION ALL
			                                    SELECT /*+ ORDERED USE_HASH(B, D) FULL(D) */
			                                           /* 사전 재매치출고 */
			                                           '14.사전 재매치 출고' DATA_GB,
			                                           FLS0039P(ORDER_ID, ORDER_SEQ, ASSORT_ID) ORDER_DT,
			                                           SITE_GB,
			                                           ORDER_ID,
			                                           ORDER_SEQ,
			                                           APPLY_DAY,
			                                           apply_time,
			                                           DEPOSIT_NO,
			                                           DEPOSIT_SEQ,
			                                           SHIP_GB,
			                                           STORAGE_ID,
			                                           O_STORAGE_ID,
			                                           ASSORT_ID,
			                                           ITEM_ID,
			                                           ASSORT_WEIGHT,
			                                           SUBSTR(A.DELI_CURRENCY,1,2) DELI_COMPANY_ID,
			                                           SUBSTR(A.DELI_CURRENCY,3,2) CURRENCY_UNIT,
			                                           EXC_APP_DT,
			                                           QTY,
			                                           SET_QTY,
			                                           ORDER_DISCOUNT,
			                                           SALE_COST,
			                                           CUSTOMS_TAX,
			                                           0 NOPAY_AMT,
			                                           0 SALE_RATE,
			                                           0 SALE_TRAN,
			                                           ORDER_DISCOUNT - CUSTOMS_TAX SALE_ITEM,   /*사전재매치는 보험료등 세금은 차감*/
			                                           0 COST_TRAN,
			                                           0 SUM_WEIGHT,
			                                           1 CNT,
			                                           D.BASERATE,
			                                   CASE WHEN A.SITE_GB = '21' THEN  3                                   /*어드레스 3   달러*/
			                                    ELSE CASE WHEN  A.STORAGE_ID = '7' THEN 2.5      /*미국     2   달러*/
			                                        when  A.STORAGE_ID = '3'  then 3
			                                              WHEN A.STORAGE_ID = '4'                       THEN 1.2    /*이태리   1.2 유로*/
			                                              WHEN A.STORAGE_ID = '6'                       THEN 1      /*영국     1   파운드*/
			                                              WHEN A.STORAGE_ID = '8'                       THEN 249.15      /*일본 249.15엔*/
			                                              END
			                                    END COST_SORTING_FEE,                                               /*운송매출원가 - SORTING FEE*/
			                                    CASE WHEN A.SITE_GB = '21' THEN 0                                   /*어드레스 0   달러*/
			                                    ELSE CASE WHEN A.STORAGE_ID = '3' OR A.STORAGE_ID = '7' THEN 0      /*미국     0   달러*/
			                                              WHEN A.STORAGE_ID = '4'                       THEN 2000   /*이태리   2000 유로*/
			                                              WHEN A.STORAGE_ID = '6'                       THEN 1500   /*영국     1500 파운드*/
			                                              WHEN A.STORAGE_ID = '8'                       THEN 0 /*일본 0*/
			                                              END
			                                    END FIX_SORTING_FEE,                                                /*운송매출원가 - 고정비 SORTING FEE*/
			                                            (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT
			                                            ,a.contact_site
			                                            ,a.join_id
			                                      FROM (
			                                            SELECT /*+ ORDERED USE_NL(X A B C D ) INDEX(D ITASRN_PK)
			                                                       NO_MERGE FULL(X) */
			                                                   A.APPLY_DAY,
			                                                   a.apply_time,
			                                                   A.STORAGE_ID,
			                                                   A.SHIP_GB,
			                                                   A.STORAGE_ID      O_STORAGE_ID,
			                                                   B.SITE_GB,
			                                                   B.SHIP_ID         DEPOSIT_NO,
			                                                   B.SHIP_SEQ        DEPOSIT_SEQ,
			                                                   B.ORDER_ID        ORDER_ID,
			                                                   B.ORDER_SEQ       ORDER_SEQ,
			                                                   B.ASSORT_ID       ASSORT_ID,
			                                                   B.ORDER_ITEM_ID   ITEM_ID,
			                                                   B.SHIP_QTY           QTY,
			                                                   B.SHIP_QTY           SET_QTY,
			                                                   B.ORDER_DISCOUNT  ORDER_DISCOUNT,
			                                                   B.SALE_COST   SALE_COST,
			                                                   ROUND(B.CUSTOMS_TAX)         CUSTOMS_TAX,
			                                                   0         DELI_SHED_AMT,
			                                                   D.WEIGHT      ASSORT_WEIGHT,
			                                                   B.EXC_APP_DT  EXC_APP_DT,
			                                                   (SELECT CD_REF1||CD_REF2
			                                                      FROM CMCODE
			                                                     WHERE CD_MAJOR ='0504'
			                                                       AND CD_MINOR = A.STORAGE_ID
			                                                       AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_CURRENCY,
			                                                       f.contact_site contact_site,
			                                                f.join_id
			                                              FROM CMSTGM X,
			                                                   LSSHPM A,
			                                                   LSSHPD B,
			                                                   RMORDD C,
			                                                   ITASRN D,
			                                                   rmordm f
			                                             WHERE X.STORAGE_GB      ='01'
			                                               AND X.AREA_GB         ='02'
			                                               AND X.STORAGE_ID      = A.STORAGE_ID
			                                               AND A.SITE_GB         IN ('23',''/* LIVING */)
			                                               AND A.SHIP_ID     = B.SHIP_ID
			                                               AND A.SITE_GB  LIKE #{as_service_gb}
			                                               AND B.SITE_GB  LIKE #{as_site_gb}
			                                               AND A.REMAT_GB    = '01'
			                                               AND A.APPLY_DAY   >= #{as_from_dt}
			                                               AND A.APPLY_DAY   <= #{as_to_dt}
			                                               AND A.SHIP_STATUS     BETWEEN '12' AND '17'
			                                               AND B.ORDER_ID    = C.ORDER_ID
			                                               AND B.ORDER_SEQ       = C.ORDER_SEQ
			                                               AND C.ASSORT_ID       = D.ASSORT_ID
			                                               AND D.HISTORY_GB      ='01'
			                                               AND C.VENDOR_ID       = D.VENDOR_ID
			                                               AND A.APPLY_DAY || A.APPLY_TIME          BETWEEN D.EFF_STA_DT AND D.EFF_END_DT
			                                               and c.order_id = f.order_id
			                                                ) A,
			                                                LSDLVT B,
			                                                CMXCHM D
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_CURRENCY,1,2) = B.DELI_COMPANY_ID
			                                    AND SUBSTR(A.DELI_CURRENCY,3,2) = D.CURRENCY_UNIT
			                                    AND #{as_to_dt} BETWEEN D.APPLY_FROM AND D.APPLY_TO
			                                    UNION ALL
			                                    SELECT /* 사후 재매치 */
			                                           '13.사후 재매치 출고' DATA_GB,
			                                           ORDER_DT,
			                                           SITE_GB,
			                                           ORDER_ID,
			                                           ORDER_SEQ,
			                                           APPLY_DAY,
			                                           apply_time,
			                                           DEPOSIT_NO,
			                                           DEPOSIT_SEQ,
			                                           SHIP_GB,
			                                           STORAGE_ID,
			                                           O_STORAGE_ID,
			                                           ASSORT_ID,
			                                           ITEM_ID,
			                                           ASSORT_WEIGHT,
			                                           SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
			                                           SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
			                                           EXC_APP_DT,
			                                           QTY,
			                                           SET_QTY,
			                                           ORDER_DISCOUNT,
			                                           SALE_COST + CUSTOMS_TAX SALE_COST,
			                                           0 CUSTOMS_TAX,
			                                           0 NOPAY_AMT,
			                                           0 SALE_RATE,
			                                           0 SALE_TRAN,
			                                           ORDER_DISCOUNT SALE_ITEM,
			                                           0 COST_TRAN,
			                                           0 SUM_WEIGHT,
			                                           1 CNT,
			                                           0 BASERATE,
			                                           0 COST_SORTING_FEE,
			                                           0 FIX_SORTING_FEE,
			                                           (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                           contact_site,
			                                           join_id
			                                      FROM (
			                                            SELECT /*+ ORDERED USE_NL(X A B C D)
			                                                       FULL(X) INDEX(D, ITASRN_PK) */
			                                                   A.APPLY_DAY      APPLY_DAY,
			                                                   a.apply_time     apply_time,
			                                                   A.STORAGE_ID     STORAGE_ID,
			                                                   B.O_STORAGE_ID       O_STORAGE_ID,
			                                                   B.SITE_GB        SITE_GB,
			                                                   A.SHIP_GB,
			                                                   B.SHIP_ID        DEPOSIT_NO,
			                                                   B.SHIP_SEQ       DEPOSIT_SEQ,
			                                                   B.ORDER_ID       ORDER_ID,
			                                                   B.ORDER_SEQ      ORDER_SEQ,
			                                                   C.REG_DT         ORDER_DT,
			                                                   B.ASSORT_ID,
			                                                   B.ORDER_ITEM_ID ITEM_ID,
			                                                   B.SHIP_QTY        QTY,
			                                                   B.SHIP_QTY    SET_QTY,
			                                                   B.ORDER_DISCOUNT   ORDER_DISCOUNT,
			                                                   B.SALE_COST    SALE_COST,
			                                                   B.CUSTOMS_TAX      CUSTOMS_TAX,
			                                                   D.WEIGHT   ASSORT_WEIGHT,
			                                                   B.EXC_APP_DT   EXC_APP_DT,
			                                                   (SELECT CD_REF1 || CD_REF2
			                                                      FROM CMCODE
			                                                     WHERE CD_MAJOR ='0504'
			                                                       AND CD_MINOR = B.O_STORAGE_ID
			                                                       AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
			                                                       f.contact_site,
			                                                        f.join_id
			                                              FROM CMSTGM X,
			                                                   LSSHPM A,
			                                                   LSSHPD B,
			                                                   RMORDD C,
			                                                   ITASRN D,
			                                                   rmordm f
			                                             WHERE X.STORAGE_GB  ='01'
			                                               AND X.AREA_GB     ='01'
			                                               AND X.STORAGE_TYPE='01'
			                                               AND X.VENDOR_ID   ='002000'
			                                               AND A.SITE_GB     = '23'
			                                               AND A.STORAGE_ID = X.STORAGE_ID
			                                               AND A.APPLY_DAY >= #{as_from_dt}
			                                               AND A.APPLY_DAY <= #{as_to_dt}
			                                               AND A.SHIP_STATUS BETWEEN '12' AND '17'
			                                               AND A.SHIP_ID     = B.SHIP_ID
			                                               AND A.SITE_GB  LIKE #{as_service_gb}
			                                               AND B.SITE_GB  LIKE #{as_site_gb}
			                                               AND B.ORDER_ID    = C.ORDER_ID
			                                               AND B.ORDER_SEQ   = C.ORDER_SEQ
			                                               AND A.APPLY_DAY || A.APPLY_TIME   BETWEEN D.EFF_STA_DT AND D.EFF_END_DT
			                                               AND D.HISTORY_GB  ='01'
			                                               AND C.VENDOR_ID   = D.VENDOR_ID
			                                               AND C.ASSORT_ID   = D.ASSORT_ID
			                                               and c.order_id = f.order_id
			                                               )
			                                       UNION ALL
			                                        SELECT /*+ ORDERED USE_HASH(B) */
			                                               /* 사후 입고_분실포함 */
			                                               '25.사후 정상반품 입고_분실포함' DATA_GB,
			                                               FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
			                                               SITE_GB,
			                                               ORDER_ID,
			                                               ORDER_SEQ,
			                                               APPLY_DAY,
			                                               apply_time,
			                                               DEPOSIT_NO,
			                                               DEPOSIT_SEQ,
			                                               SHIP_GB,
			                                               STORAGE_ID,
			                                               O_STORAGE_ID,
			                                               SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
			                                               SUBSTR(ASSORT_ITEM,10) ITEM_ID,
			                                               ASSORT_WEIGHT,
			                                               SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
			                                               SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
			                                               EXC_APP_DT,
			                                               -1 * QTY QTY,
			                                               DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
			                                               -1 * ORDER_DISCOUNT ORDER_DISCOUNT,
			                                               -1 * SALE_COST SALE_COST,
			                                               -1 * CUSTOMS_TAX CUSTOMS_TAX,
			                                               0 NOPAY_AMT,
			                                               (-1 * ORDER_DISCOUNT) - ( -1 * SALE_COST) - (-1 * CUSTOMS_TAX) - (-1 * (B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY))) SALE_RATE,
			                                               -1 * B.TRANS_AMT / DECODE(SET_QTY,0,1,SET_QTY) SALE_TRAN,
			                                               0 SALE_ITEM,
			                                               0 COST_TRAN,
			                                               0 SUM_WEIGHT,
			                                               1 CNT,
			                                               0 BASERATE,
			                                               0 COST_SORTING_FEE,
			                                               0 FIX_SORTING_FEE,
			                                               (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                               a.contact_site,
			                                               a.join_id
			                                               
			                                          FROM (
			                                                SELECT /*+ ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
			                                                           NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고*/
			                                                       SUBSTR(A.EFF_STA_DT,1,8) APPLY_DAY,
			                                                       SUBSTR(A.EFF_STA_DT,9,6) APPLY_time,
			                                                       C.STORAGE_ID         STORAGE_ID,
			                                                       B.O_STORAGE_ID           O_STORAGE_ID,
			                                                       B.SITE_GB            SITE_GB,
			                                                       B.SHIP_GB            SHIP_GB,
			                                                       B.SHIP_ID            DEPOSIT_NO,
			                                                       B.SHIP_SEQ           DEPOSIT_SEQ,
			                                                       B.ORDER_ID           ORDER_ID,
			                                                       B.ORDER_SEQ          ORDER_SEQ,
			                                                        NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
			                                                              FROM LSDPSD
			                                                             WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
			                                                               AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
			                                                               AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
			                                                               AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
			                                                       (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
			                                                       ABS(B.SHIP_INDICATE_QTY) QTY,
			                                                       (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                                              COUNT(*)
			                                                         FROM RMORDD R,
			                                                              RMORDD S
			                                                        WHERE D.ORDER_ID = R.ORDER_ID
			                                                          AND D.ORDER_SEQ = R.ORDER_SEQ
			                                                          AND R.ORDER_ID = S.ORDER_ID
			                                                          AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                                       ) SET_QTY,
			                                                       B.ORDER_DISCOUNT ORDER_DISCOUNT,
			                                                       ABS(B.SALE_COST) SALE_COST,
			                                                       B.CUSTOMS_TAX    CUSTOMS_TAX,
			                                                       H.WEIGHT ASSORT_WEIGHT,
			                                                       B.EXC_APP_DT EXC_APP_DT,
			                                                       (SELECT CD_REF1 || CD_REF2
			                                                          FROM CMCODE
			                                                         WHERE CD_MAJOR ='0504'
			                                                           AND CD_MINOR = B.O_STORAGE_ID
			                                                           AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
			                                                           i.contact_site contact_site
			                                                           ,i.join_id
			                                                  FROM LSSHPS A,
			                                                       LSSHPD B,
			                                                       LSSHPM C,
			                                                       CMSTGM X,
			                                                       RMORDD D,
			                                                       RMORDD E,
			                                                       ITASRN H,
			                                                       rmordm i
			                                                 WHERE A.SHIP_STATUS ='41'
			                                                   AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
			                                                   AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
			                                                   AND C.STORAGE_ID  = X.STORAGE_ID
			                                                   AND X.STORAGE_GB  ='01'
			                                                   AND X.AREA_GB     ='01'
			                                                   AND X.STORAGE_TYPE='01'
			                                                   AND X.VENDOR_ID   ='002000'
			                                                   AND A.SHIP_ID     = B.SHIP_ID
			                                                   AND C.SITE_GB  LIKE #{as_service_gb}
			                                                   AND B.SITE_GB  LIKE #{as_site_gb}
			                                                   AND B.SHIP_ID     = C.SHIP_ID
			                                                   AND B.ORDER_ID    = D.ORDER_ID
			                                                   AND B.ORDER_SEQ   = D.ORDER_SEQ
			                                                   AND D.BEF_ORDER_ID= E.ORDER_ID
			                                                   AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
			                                                   AND E.ASSORT_ID   = H.ASSORT_ID
			                                                   AND H.HISTORY_GB  = '01'
			                                                   AND H.VENDOR_ID   = E.VENDOR_ID
			                                                   AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
			                                                   AND EXISTS ( SELECT 'X'||ROWNUM
			                                                                      FROM RMORDD X,
			                                                                           LSPCHD Y
			                                                                     WHERE B.ORDER_ID = X.ORDER_ID
			                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
			                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
			                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
			                                                   and d.order_id = i.order_id                                                                       
			                                                   ) A,
			                                                    LSDLVT B
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
			                                    UNION ALL
			                                    SELECT /*+ ORDERED USE_HASH(B) */
			                                           /* 사후 입고_분실포함 */
			                                               '26.사후 매치반품 입고_분실포함' DATA_GB,
			                                               FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
			                                               SITE_GB,
			                                               ORDER_ID,
			                                               ORDER_SEQ,
			                                               APPLY_DAY,
			                                               apply_time,
			                                               DEPOSIT_NO,
			                                               DEPOSIT_SEQ,
			                                               SHIP_GB,
			                                               STORAGE_ID,
			                                               O_STORAGE_ID,
			                                               SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
			                                               SUBSTR(ASSORT_ITEM,10) ITEM_ID,
			                                               ASSORT_WEIGHT,
			                                               SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
			                                               SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
			                                               EXC_APP_DT,
			                                               -1 * QTY QTY,
			                                               DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
			                                               -1 * ORDER_DISCOUNT ORDER_DISCOUNT,
			                                               -1 * (SALE_COST + CUSTOMS_TAX) SALE_COST,
			                                               0 CUSTOMS_TAX,
			                                               0 NOPAY_AMT,
			                                               0 SALE_RATE,
			                                               0 SALE_TRAN,
			                                               -1 * ORDER_DISCOUNT SALE_ITEM,
			                                               0 COST_TRAN,
			                                               0 SUM_WEIGHT,
			                                               1 CNT,
			                                               0 BASERATE,
			                                               0 COST_SORTING_FEE,
			                                               0 FIX_SORTING_FEE,
			                                               (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                               a.contact_site
			                                               ,a.join_id
			                                          FROM (
			                                                SELECT /*+ ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
			                                                           NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고*/
			                                                       SUBSTR(A.EFF_STA_DT,1,8) APPLY_DAY,
			                                                       SUBSTR(A.EFF_STA_DT,9,6) APPLY_time,
			                                                       C.STORAGE_ID         STORAGE_ID,
			                                                       B.O_STORAGE_ID           O_STORAGE_ID,
			                                                       B.SITE_GB            SITE_GB,
			                                                       B.SHIP_GB            SHIP_GB,
			                                                       B.SHIP_ID            DEPOSIT_NO,
			                                                       B.SHIP_SEQ           DEPOSIT_SEQ,
			                                                       B.ORDER_ID           ORDER_ID,
			                                                       B.ORDER_SEQ          ORDER_SEQ,
			                                                       NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
			                                                              FROM LSDPSD
			                                                             WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
			                                                               AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
			                                                               AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
			                                                               AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
			                                                       (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
			                                                       ABS(B.SHIP_INDICATE_QTY) QTY,
			                                                       (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                                              COUNT(*)
			                                                         FROM RMORDD R,
			                                                              RMORDD S
			                                                        WHERE D.ORDER_ID = R.ORDER_ID
			                                                          AND D.ORDER_SEQ = R.ORDER_SEQ
			                                                          AND R.ORDER_ID = S.ORDER_ID
			                                                          AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                                       ) SET_QTY,
			                                                       B.ORDER_DISCOUNT ORDER_DISCOUNT,
			                                                       ABS(B.SALE_COST) SALE_COST,
			                                                       B.CUSTOMS_TAX    CUSTOMS_TAX,
			                                                       H.WEIGHT ASSORT_WEIGHT,
			                                                       B.EXC_APP_DT EXC_APP_DT,
			                                                       (SELECT CD_REF1 || CD_REF2
			                                                          FROM CMCODE
			                                                         WHERE CD_MAJOR ='0504'
			                                                           AND CD_MINOR = B.O_STORAGE_ID
			                                                           AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
			                                                           i.contact_site contact_site
			                                                           ,i.join_id
			                                                  FROM LSSHPS A,
			                                                       LSSHPD B,
			                                                       LSSHPM C,
			                                                       CMSTGM X,
			                                                       RMORDD D,
			                                                       RMORDD E,
			                                                       ITASRN H,
			                                                       rmordm i
			                                                 WHERE A.SHIP_STATUS ='41'
			                                                   AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
			                                                   AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
			                                                   AND C.STORAGE_ID  = X.STORAGE_ID
			                                                   AND X.STORAGE_GB  ='01'
			                                                   AND X.AREA_GB     ='01'
			                                                   AND X.STORAGE_TYPE='01'
			                                                   AND X.VENDOR_ID   ='002000'
			                                                   AND A.SHIP_ID     = B.SHIP_ID
			                                                   AND C.SITE_GB  LIKE #{as_service_gb}
			                                                   AND B.SITE_GB  LIKE #{as_site_gb}
			                                                   AND B.SHIP_ID     = C.SHIP_ID
			                                                   AND B.ORDER_ID    = D.ORDER_ID
			                                                   AND B.ORDER_SEQ   = D.ORDER_SEQ
			                                                   AND D.BEF_ORDER_ID= E.ORDER_ID
			                                                   AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
			                                                   AND E.ASSORT_ID   = H.ASSORT_ID
			                                                   AND H.HISTORY_GB  = '01'
			                                                   AND H.VENDOR_ID   = E.VENDOR_ID
			                                                   AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
			                                                   AND NOT EXISTS ( SELECT 'X'||ROWNUM
			                                                                      FROM RMORDD X,
			                                                                           LSPCHD Y
			                                                                     WHERE B.ORDER_ID = X.ORDER_ID
			                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
			                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
			                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
			                                                   and d.order_id = i.order_id                    
			                                                   ) A,
			                                                    LSDLVT B
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
			
			                                    UNION ALL
			
			                                      SELECT /*+ ORDERED USE_HASH(B) */
			                                             /* 사후 입고취소_분실포함 */
			                                             '27.사후 정상반품입고취소_분실포함' DATA_GB,
			                                             FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
			                                       SITE_GB,
			                                             ORDER_ID,
			                                             ORDER_SEQ,
			                                             APPLY_DAY,
			                                             apply_time,
			                                             DEPOSIT_NO,
			                                             DEPOSIT_SEQ,
			                                             SHIP_GB,
			                                             STORAGE_ID,
			                                             O_STORAGE_ID,
			                                             SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
			                                             SUBSTR(ASSORT_ITEM,10) ITEM_ID,
			                                             ASSORT_WEIGHT,
			                                             SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
			                                             SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
			                                             EXC_APP_DT,
			                                             -1 * QTY,
			                                             DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
			                                             ORDER_DISCOUNT,
			                                             SALE_COST SALE_COST,
			                                             CUSTOMS_TAX,
			                                             0 NOPAY_AMT,
			                                             ORDER_DISCOUNT - SALE_COST - CUSTOMS_TAX - (B.TRANS_AMT/DECODE(SET_QTY,0,1,SET_QTY)) SALE_RATE,
			                                             B.TRANS_AMT / DECODE(SET_QTY,0,1,SET_QTY) SALE_TRAN,
			                                             0 SALE_ITEM,
			                                             0 COST_TRAN,
			                                             0 SUM_WEIGHT,
			                                             1 CNT,
			                                             0 BASERATE,
			                                             0 COST_SORTING_FEE,
			                                             0 FIX_SORTING_FEE,
			                                             (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                             a.contact_site,
			                                             a.join_id
			                                        FROM (
			                                              SELECT /*+ USE_CONCAT ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
			                                                         NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고취소*/
			                                                  C.SHIP_STATUS,
			                                                  SUBSTR(A.EFF_STA_DT,1,8)      APPLY_DAY,
			                                                  SUBSTR(A.EFF_STA_DT,9,6)      APPLY_time,
			                                                  C.STORAGE_ID                  STORAGE_ID,
			                                                  B.O_STORAGE_ID                O_STORAGE_ID,
			                                                  B.SITE_GB                     SITE_GB,
			                                                  B.SHIP_GB                     SHIP_GB,
			                                                  B.SHIP_ID                     DEPOSIT_NO,
			                                                  B.SHIP_SEQ                    DEPOSIT_SEQ,
			                                                  B.ORDER_ID                    ORDER_ID,
			                                                  B.ORDER_SEQ                       ORDER_SEQ,
			                                                  NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
			                                                         FROM LSDPSD
			                                                        WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
			                                                          AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
			                                                          AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
			                                                          AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
			                                                  (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
			                                                  B.SHIP_INDICATE_QTY QTY,
			                                                  (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                                         COUNT(*)
			                                                    FROM RMORDD R,
			                                                          RMORDD S
			                                                   WHERE D.ORDER_ID = R.ORDER_ID
			                                                     AND D.ORDER_SEQ = R.ORDER_SEQ
			                                                     AND R.ORDER_ID = S.ORDER_ID
			                                                     AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                                  ) SET_QTY,
			                                                  B.ORDER_DISCOUNT ORDER_DISCOUNT,
			                                                  ABS(B.SALE_COST) SALE_COST,
			                                                  B.CUSTOMS_TAX    CUSTOMS_TAX,
			                                                  H.WEIGHT ASSORT_WEIGHT,
			                                                  B.EXC_APP_DT EXC_APP_DT,
			                                                  (SELECT CD_REF1 || CD_REF2
			                                                     FROM CMCODE
			                                                    WHERE CD_MAJOR ='0504'
			                                                      AND CD_MINOR = B.O_STORAGE_ID
			                                                      AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
			                                                      i.contact_site contact_site
			                                                      ,i.join_id
			                                             FROM LSSHPS A,
			                                                  LSSHPD B,
			                                                  LSSHPM C,
			                                                  CMSTGM X,
			                                                  RMORDD D,
			                                               RMORDD E,
			                                               ITASRN H,
			                                               rmordm i
			                                            WHERE A.SHIP_STATUS IN('30','31')
			                                              AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
			                                              AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
			                                              AND C.STORAGE_ID  = X.STORAGE_ID
			                                              AND X.STORAGE_GB  ='01'
			                                              AND X.AREA_GB     ='01'
			                                              AND X.STORAGE_TYPE='01'
			                                              AND X.VENDOR_ID   ='002000'
			                                              AND A.SHIP_ID     = B.SHIP_ID
			                                              AND C.SITE_GB  LIKE #{as_service_gb}
			                                              AND B.SITE_GB  LIKE #{as_site_gb}
			                                              AND B.SHIP_ID     = C.SHIP_ID
			                                              AND B.ORDER_ID    = D.ORDER_ID
			                                              AND B.ORDER_SEQ   = D.ORDER_SEQ
			                                           AND D.BEF_ORDER_ID= E.ORDER_ID
			                                           AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
			                                                 AND EXISTS (SELECT /*+ INDEX( X LSSHPS_PK) */
			                                                                    'X'||ROWNUM
			                                                                FROM LSSHPS X
			                                                         WHERE SHIP_ID = A.SHIP_ID
			                                                           AND SHIP_STATUS ='41'
			                                                           AND EFF_STA_DT < A.EFF_STA_DT)
			                                                 AND ((A.SHIP_STATUS = '30' AND NOT EXISTS (SELECT 'X'||ROWNUM
			                                                                                        FROM LSSHPS
			                                                                                       WHERE SHIP_ID = A.SHIP_ID
			                                                                                         AND SHIP_STATUS = '31'
			                                                                                         AND EFF_STA_DT > A.EFF_STA_DT))
			                                            OR
			                                               (A.SHIP_STATUS = '31' AND '1' ='1'))
			                                           AND E.ASSORT_ID   = H.ASSORT_ID
			                                           AND H.HISTORY_GB  = '01'
			                                           AND H.VENDOR_ID   = E.VENDOR_ID
			                                           AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
			                                           AND EXISTS ( SELECT 'X'||ROWNUM
			                                                                      FROM RMORDD X,
			                                                                           LSPCHD Y
			                                                                     WHERE B.ORDER_ID = X.ORDER_ID
			                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
			                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
			                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
			                                            and d.order_id = i.order_id                                                                       
			                                           )  A,
			                                                    LSDLVT B
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
			
			                                    UNION ALL
			                                    SELECT /*+ ORDERED USE_HASH(B) */
			                                           /* 사후 입고취소_분실포함 */
			                                             '28.사후 매치반품입고취소_분실포함' DATA_GB,
			                                             FLS0039P(ORDER_ID, ORDER_SEQ, SUBSTR(ASSORT_ITEM,1,9)) ORDER_DT,
			                                             SITE_GB,
			                                             ORDER_ID,
			                                             ORDER_SEQ,
			                                             APPLY_DAY,
			                                             apply_time,
			                                             DEPOSIT_NO,
			                                             DEPOSIT_SEQ,
			                                             SHIP_GB,
			                                             STORAGE_ID,
			                                             O_STORAGE_ID,
			                                             SUBSTR(ASSORT_ITEM,1,9) ASSORT_ID,
			                                             SUBSTR(ASSORT_ITEM,10) ITEM_ID,
			                                             ASSORT_WEIGHT,
			                                             SUBSTR(DELI_COMPANY_CURRENCY,1,2) DELI_COMPANY_ID,
			                                             SUBSTR(DELI_COMPANY_CURRENCY,3) CURRENCY_UNIT,
			                                             EXC_APP_DT,
			                                             -1 * QTY,
			                                             DECODE(SET_QTY,0,-1,SET_QTY) SET_QTY,
			                                             ORDER_DISCOUNT ORDER_DISCOUNT,
			                                             SALE_COST + CUSTOMS_TAX SALE_COST,
			                                             0 CUSTOMS_TAX,
			                                             0 NOPAY_AMT,
			                                             0 SALE_RATE,
			                                             0 SALE_TRAN,
			                                             ORDER_DISCOUNT SALE_ITEM,
			                                             0 COST_TRAN,
			                                             0 SUM_WEIGHT,
			                                             1 CNT,
			                                             0 BASERATE,
			                                             0 COST_SORTING_FEE,
			                                             0 FIX_SORTING_FEE,
			                                             (TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1)/TO_CHAR(LAST_DAY(TO_DATE(#{as_from_dt}, 'YYYYMMDD')), 'DD') DATE_CNT,
			                                             a.contact_site,
			                                             a.join_id
			                                        FROM (
			                                              SELECT /*+ USE_CONCAT ORDERED USE_NL(A B C X D E H) INDEX(A LSSHPS_IND1)
			                                                         NO_MERGE INDEX(H, ITASRN_PK) 사후반품입고취소*/
			                                                  C.SHIP_STATUS,
			                                                  SUBSTR(A.EFF_STA_DT,1,8)      APPLY_DAY,
			                                                  SUBSTR(A.EFF_STA_DT,9,6)      APPLY_time,
			                                                  C.STORAGE_ID                  STORAGE_ID,
			                                                  B.O_STORAGE_ID                O_STORAGE_ID,
			                                                  B.SITE_GB                     SITE_GB,
			                                                  B.SHIP_GB                     SHIP_GB,
			                                                  B.SHIP_ID                     DEPOSIT_NO,
			                                                  B.SHIP_SEQ                    DEPOSIT_SEQ,
			                                                  B.ORDER_ID                    ORDER_ID,
			                                                  B.ORDER_SEQ                       ORDER_SEQ,
			                                                  NVL((SELECT ASSORT_ID||ORDER_ITEM_ID
			                                                         FROM LSDPSD
			                                                        WHERE MIN_DEPOSIT_NO = D.BEF_ORDER_ID
			                                                          AND MIN_DEPOSIT_SEQ = D.BEF_ORDER_SEQ
			                                                          AND DEPOSIT_TYPE ='2F' AND EXTRA_CLS_CD ='22'
			                                                          AND ROWNUM =1),B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM,
			                                                  (B.ASSORT_ID||B.ORDER_ITEM_ID) ASSORT_ITEM1,
			                                                  B.SHIP_INDICATE_QTY QTY,
			                                                  (SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                                         COUNT(*)
			                                                    FROM RMORDD R,
			                                                          RMORDD S
			                                                   WHERE D.ORDER_ID = R.ORDER_ID
			                                                     AND D.ORDER_SEQ = R.ORDER_SEQ
			                                                     AND R.ORDER_ID = S.ORDER_ID
			                                                     AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                                  ) SET_QTY,
			                                                  B.ORDER_DISCOUNT ORDER_DISCOUNT,
			                                                  ABS(B.SALE_COST) SALE_COST,
			                                                  B.CUSTOMS_TAX    CUSTOMS_TAX,
			                                                  H.WEIGHT ASSORT_WEIGHT,
			                                                  B.EXC_APP_DT EXC_APP_DT,
			                                                  (SELECT CD_REF1 || CD_REF2
			                                                     FROM CMCODE
			                                                    WHERE CD_MAJOR ='0504'
			                                                      AND CD_MINOR = B.O_STORAGE_ID
			                                                      AND B.EXC_APP_DT BETWEEN CD_STA_DT AND CD_END_DT) DELI_COMPANY_CURRENCY,
			                                                      i.contact_site contact_site,
			                                                      i.join_id
			                                             FROM LSSHPS A,
			                                                  LSSHPD B,
			                                                  LSSHPM C,
			                                                  CMSTGM X,
			                                                  RMORDD D,
			                                               RMORDD E,
			                                               ITASRN H,
			                                               rmordm i
			                                            WHERE A.SHIP_STATUS IN('30','31')
			                                              AND A.EFF_STA_DT  >= #{as_from_dt}||'000000'
			                                              AND A.EFF_STA_DT  <= #{as_to_dt}||'235959'
			                                              AND C.STORAGE_ID  = X.STORAGE_ID
			                                              AND X.STORAGE_GB  ='01'
			                                              AND X.AREA_GB     ='01'
			                                              AND X.STORAGE_TYPE='01'
			                                              AND X.VENDOR_ID   ='002000'
			                                              AND A.SHIP_ID     = B.SHIP_ID
			                                              AND C.SITE_GB  LIKE #{as_service_gb}
			                                              AND B.SITE_GB  LIKE #{as_site_gb}
			                                              AND B.SHIP_ID     = C.SHIP_ID
			                                              AND B.ORDER_ID    = D.ORDER_ID
			                                              AND B.ORDER_SEQ   = D.ORDER_SEQ
			                                           AND D.BEF_ORDER_ID= E.ORDER_ID
			                                           AND D.BEF_ORDER_SEQ=E.ORDER_SEQ
			                                                 AND EXISTS (SELECT /*+ INDEX( X LSSHPS_PK) */
			                                                                    'X'||ROWNUM
			                                                                FROM LSSHPS X
			                                                         WHERE SHIP_ID = A.SHIP_ID
			                                                           AND SHIP_STATUS ='41'
			                                                           AND EFF_STA_DT < A.EFF_STA_DT)
			                                                 AND ((A.SHIP_STATUS = '30' AND NOT EXISTS (SELECT 'X'||ROWNUM
			                                                                                        FROM LSSHPS
			                                                                                       WHERE SHIP_ID = A.SHIP_ID
			                                                                                         AND SHIP_STATUS = '31'
			                                                                                         AND EFF_STA_DT > A.EFF_STA_DT))
			                                            OR
			                                               (A.SHIP_STATUS = '31' AND '1' ='1'))
			                                           AND E.ASSORT_ID   = H.ASSORT_ID
			                                           AND H.HISTORY_GB  = '01'
			                                           AND H.VENDOR_ID   = E.VENDOR_ID
			                                           AND C.APPLY_DAY || C.APPLY_TIME BETWEEN H.EFF_STA_DT AND H.EFF_END_DT
			                                           AND NOT EXISTS ( SELECT 'X'||ROWNUM
			                                                                      FROM RMORDD X,
			                                                                           LSPCHD Y
			                                                                     WHERE B.ORDER_ID = X.ORDER_ID
			                                                                       AND B.ORDER_SEQ= X.ORDER_SEQ
			                                                                       AND X.BEF_ORDER_ID=Y.ORDER_ID
			                                                                       AND X.BEF_ORDER_SEQ=Y.ORDER_SEQ)
			                                           and d.order_id = i.order_id                                                                       
			                                           )  A,
			                                                    LSDLVT B
			                                    WHERE   B.VENDOR_ID ='002000'
			                                    AND B.DELI_TYPE = '01'
			                                    AND A.APPLY_DAY >= B.EFF_STA_DT
			                                    AND A.APPLY_DAY <  B.EFF_END_DT
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) > B.WEIGHT_FROM
			                                    AND DECODE(A.ASSORT_WEIGHT,0,1,A.ASSORT_WEIGHT) <=B.WEIGHT_TO
			                                    AND SUBSTR(A.DELI_COMPANY_CURRENCY,1,2) = B.DELI_COMPANY_ID
			                                ) X,
			                                ITASRT Z,
			                                CMCODE B,
			                                CMCODE C
			                        WHERE   X.ASSORT_ID = Z.ASSORT_ID
			                        AND     X.SITE_GB   = B.CD_MINOR
			                        AND     B.CD_MAJOR  = '0072'
			                        AND     B.CD_FR_MINOR = '20'
			                        AND     B.CD_END_DT = '99991231235959'
			                        AND     X.O_STORAGE_ID = C.CD_MINOR
			                        AND     C.CD_MAJOR = '0504'
			                        AND     C.CD_END_DT = '99991231235959'
			                        GROUP BY    X.SITE_GB,
			                                    Z.DISP_CATEGORY_ID,
			                                    X.O_STORAGE_ID,
			                                    X.DATA_GB,
			                                    x.contact_site,
			                                    x.join_id,
			                                    z.vendor_id,
			                                    z.brand_id,
			                                    z.assort_id,
			                                    z.assort_nm,
			                                    z.assort_model
			                                    , x.order_id,x.order_seq
			                                 ,x.apply_day  
			                                 ,x.apply_time                                  
			                        UNION ALL
			                        SELECT  /*+ ORDERED USE_NL(X Y) USE_HASH(Z, A, B) */
			                                X.SITE_GB                   AS SITE_GB,
			                                MAX(B.CD_REF1)              AS VENDOR_ID,
			                                MAX(B.CD_FNAME)             AS SITE_NM,
			                                'MALL'                      AS STORAGE_ID,
			                                X.DATA_GB                   AS DATA_GB,
			                                Z.DISP_CATEGORY_ID          AS DISP_CATEGORY_ID,
			                                x.contact_site              as contact_site,
			                                NVL((select join_nm 
			                                from   MKJONM MK 
			                                where  MK.join_id    = x.join_id 
			                                AND    MK.balance_gb = '02'
			                                and    MK.adjst_cd   = '05'
			                                and    MK.join_path  = '01'
			                                and    MK.join_type  IN ('03','13')
			                                and    MK.up_join_id = '*'
			                                ),'WIZWID') join_nm, 
			                                    z.vendor_id vendor_id_n,
			                                    z.brand_id brand_id_n,
			                                    z.assort_id assort_id_n  ,
			                                    z.assort_nm assort_nm_n  ,
			                                    z.assort_model assort_model_n,                                 
			                                SUM(ABS(X.QTY))             AS CNT,
			                                SUM(X.QTY)                  AS QTY,
			                                1                           AS SHIP_CNT,            /*출고건수*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 0, X.QTY, 0), 0))     AS NOSET_QTY_CHGO,      /*출고*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 0, X.QTY, 0), 0))     AS NOSET_QTY_IPGO,      /*반품*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', DECODE(ABS(X.SET_QTY), 0, 0, X.QTY), 0))     AS SET_QTY_CHGO,        /*출고*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', DECODE(ABS(X.SET_QTY), 0, 0, X.QTY), 0))     AS SET_QTY_IPGO,        /*반품*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '1', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_CHGO,     /*출고*/
			                                SUM(DECODE(SUBSTR(X.SHIP_GB,1,1), '2', X.ORDER_DISCOUNT, 0))    AS ORDER_DISCOUNT_IPGO,     /*반품*/
			                                SUM(X.ORDER_DISCOUNT)       AS ORDER_DISCOUNT,
			                                SUM(X.SALE_COST)            AS SALE_COST,
			                                SUM(X.CUSTOMS_TAX)          AS CUSTOMS_TAX,
			                                SUM(X.NOPAY_AMT)            AS NOPAY_AMT,
			                                SUM(X.SALE_RATE)            AS SALE_RATE,
			                                SUM(X.SALE_TRAN)            AS SALE_TRAN,
			                                SUM(X.SALE_ITEM)            AS SALE_ITEM,
			                                SUM(X.NOPAY_AMT)            AS SALE_EXCEPT_ITEM,
			                                0                           AS SUM_WEIGHT,
			                                0                           AS COST_TRAN,
			                                SUM(X.SALE_COST)            AS COST_ITEM,   /*상품매출원가 - 사후재매치, 사전재매치, 사후매치반품 입고 분실포함.*/
			                                0                           AS COST_SORTING_FEE,
			                                0                           AS FIX_SORTING_FEE,
			                                TO_DATE(#{as_to_dt}, 'YYYYMMDD') - TO_DATE(#{as_from_dt}, 'YYYYMMDD') + 1 DATE_CNT
			                                ,                        x.order_id,x.order_seq
			                             ,x.apply_day
			                             ,x.apply_time
			                        FROM    (
			                                SELECT  /*+ ORDERED USE_NL(A B C D F) INDEX(A LSSHPM_IND1)
			                                            INDEX(F, ITASRN_PK) USE_HASH(G) */
			                                        '12.몰매출-위탁-출고'   DATA_GB,
			                                        FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
			                                        A.STORAGE_ID        STORAGE_ID,
			                                        A.SHIP_ID           SHIP_ID,    /* 출고번호 */
			                                        B.SHIP_SEQ          SHIP_SEQ,   /* 출고내역번호 */
			                                        A.SHIP_GB           SHIP_GB,
			                                        B.SITE_GB           SITE_GB,    /* 사이트별 매출 구분값 */
			                                        A.APPLY_DAY         apply_day,    /* 매출일자 */
			                                        A.APPLY_time         apply_time,    /* 매출일자 */
			                                        B.ORDER_ID          ORDER_ID,   /* 주문번호 */
			                                        B.ORDER_SEQ         ORDER_SEQ,  /* 주문순번 */
			                                        B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
			                                        B.ASSORT_ID         ASSORT_ID,  /* 품목코드 */
			                                        B.ORDER_ITEM_ID     ITEM_ID,    /* 상품코드 */
			                                        B.SHIP_QTY          QTY,        /* 수량 */
			                                        (
			                                        SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                               COUNT(*)
			                                          FROM RMORDD R,
			                                               RMORDD S
			                                         WHERE B.ORDER_ID = R.ORDER_ID
			                                           AND B.ORDER_SEQ = R.ORDER_SEQ
			                                           AND R.ORDER_ID = S.ORDER_ID
			                                           AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                        ) SET_QTY,
			                                        B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
			                                        0 SALE_COST,
			                                        0 CUSTOMS_TAX,
			                                        ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) NOPAY_AMT,
			                                        (B.SHIP_QTY * B.ORDER_DISCOUNT) - ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) SALE_RATE,
			                                        0 SALE_TRAN,
			                                        0 SALE_ITEM,
			                                        h.contact_site contact_site,
			                                        h.join_id
			                                   FROM LSSHPM A,
			                                        LSSHPD B,
			                                        ITASRT C,
			                                        RMORDD D,
			                                        ITASRN F,
			                                        CMVDMR G,
			                                        rmordm h
			                                  WHERE A.APPLY_DAY >= #{as_from_dt}
			                                    AND A.APPLY_DAY <= #{as_to_dt}
			                                    AND A.SITE_GB ='22'
			                                    AND A.SHIP_STATUS IN ('14')
			                                    AND A.SHIP_GB||'' IN ('11','12')
			                                    AND B.SHIP_ID = A.SHIP_ID
			                                    AND A.SITE_GB LIKE #{as_service_gb}
			                                    AND B.SITE_GB LIKE #{as_site_gb}
			                                    AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
			                                    AND C.ASSORT_ID = B.ASSORT_ID
			                                    AND D.ORDER_ID (+) = B.ORDER_ID
			                                    AND D.ORDER_SEQ (+) = B.ORDER_SEQ
			                                    AND F.ASSORT_ID = C.ASSORT_ID
			                                    AND F.VENDOR_ID = C.AS_VENDOR_ID
			                                    AND F.HISTORY_GB = '01'
			                                    AND FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID) BETWEEN F.EFF_STA_DT AND F.EFF_END_DT
			                                    AND C.VENDOR_ID    = G.VENDOR_ID
			                                    AND G.EFF_END_DT    = '99991231'
			                                    AND G.VD_TYPE_CD    NOT IN ('0423','0424')
			                                    and d.order_id = h.order_id
			                                UNION ALL
			                                SELECT  /*+ ORDERED USE_NL(A B C D F) INDEX(A LSSHPM_IND1)
			                                            INDEX(F, ITASRN_PK) USE_HASH(G) */
			                                        '23.몰매출-위탁--반품'  DATA_GB,
			                                        FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
			                                        A.STORAGE_ID        STORAGE_ID,
			                                        A.SHIP_ID           SHIP_ID,    /* 출고번호 */
			                                        B.SHIP_SEQ          SHIP_SEQ,   /* 출고내역번호 */
			                                        A.SHIP_GB           SHIP_GB,
			                                        B.SITE_GB           SITE_GB,    /* 사이트별 매출 구분값 */
			                                        A.APPLY_DAY         apply_day,    /* 매출일자 */
			                                        A.APPLY_time         apply_time,    /* 매출일자 */
			                                        B.ORDER_ID          ORDER_ID,   /* 주문번호 */
			                                        B.ORDER_SEQ         ORDER_SEQ,  /* 주문순번 */
			                                        B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
			                                        B.ASSORT_ID         ASSORT_ID,  /* 품목코드 */
			                                        B.ORDER_ITEM_ID     ITEM_ID,    /* 상품코드 */
			                                        B.SHIP_QTY          QTY,        /* 수량 */
			                                        (
			                                        SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                               COUNT(*)
			                                          FROM RMORDD R,
			                                               RMORDD S
			                                         WHERE B.ORDER_ID = R.ORDER_ID
			                                           AND B.ORDER_SEQ = R.ORDER_SEQ
			                                           AND R.ORDER_ID = S.ORDER_ID
			                                           AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                        ) SET_QTY,
			                                        B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
			                                        0 SALE_COST,
			                                        0 CUSTOMS_TAX,
			                                        ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) NOPAY_AMT,
			                                        (B.SHIP_QTY * B.ORDER_DISCOUNT) - ROUND((D.SALE_PRICE * B.SHIP_QTY) *(1-F.MARGIN*0.01)) SALE_RATE,
			                                        0 SALE_TRAN,
			                                        0 SALE_ITEM,
			                                        h.contact_site contact_site,
			                                        h.join_id
			                                   FROM LSSHPM A,
			                                        LSSHPD B,
			                                        ITASRT C,
			                                        RMORDD D,
			                                        ITASRN F,
			                                        CMVDMR G,
			                                        rmordm h
			                                  WHERE A.APPLY_DAY >= #{as_from_dt}
			                                    AND A.APPLY_DAY <= #{as_to_dt}
			                                    AND A.SITE_GB ='22'
			                                    AND A.SHIP_STATUS IN ('24')
			                                    AND A.SHIP_GB||'' IN ('21','22')
			                                    AND B.SHIP_ID = A.SHIP_ID
			                                    AND A.SITE_GB  LIKE #{as_service_gb}
			                                    AND B.SITE_GB  LIKE #{as_site_gb}
			                                    AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
			                                    AND C.ASSORT_ID = B.ASSORT_ID
			                                    AND D.ORDER_ID (+) = B.ORDER_ID
			                                    AND D.ORDER_SEQ (+) = B.ORDER_SEQ
			                                    AND F.ASSORT_ID = C.ASSORT_ID
			                                    AND F.VENDOR_ID = C.AS_VENDOR_ID
			                                    AND F.HISTORY_GB = '01'
			                                    AND FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID) BETWEEN F.EFF_STA_DT AND F.EFF_END_DT
			                                    AND C.VENDOR_ID    = G.VENDOR_ID
			                                    AND G.EFF_END_DT    = '99991231'
			                                    AND G.VD_TYPE_CD    NOT IN ('0423','0424')
			                                    and d.order_id = h.order_id
			                                UNION ALL
			                                SELECT /*+ ORDERED USE_NL(A B C D) INDEX(A LSSHPM_IND1)
			                                           USE_HASH(G) */
			                                        '12.몰매출-사입-출고'   DATA_GB,
			                                        FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
			                                        A.STORAGE_ID        STORAGE_ID,
			                                        A.SHIP_ID    SHIP_ID,
			                                        B.SHIP_SEQ   SHIP_SEQ,
			                                        A.SHIP_GB    SHIP_GB,
			                                        B.SITE_GB SITE_GB,
			                                        A.APPLY_DAY     APPLY_DAY,
			                                        A.APPLY_time     APPLY_time,
			                                        B.ORDER_ID,
			                                        B.ORDER_SEQ,
			                                        B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
			                                        B.ASSORT_ID ASSORT_ID,
			                                        B.ORDER_ITEM_ID ITEM_ID,
			                                        B.SHIP_QTY QTY,
			                                        (
			                                        SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                               COUNT(*)
			                                          FROM RMORDD R,
			                                               RMORDD S
			                                         WHERE B.ORDER_ID = R.ORDER_ID
			                                           AND B.ORDER_SEQ = R.ORDER_SEQ
			                                           AND R.ORDER_ID = S.ORDER_ID
			                                           AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                        ) SET_QTY,
			                                        B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
			                                        B.SALE_COST,
			                                        0 CUSTOMS_TAX,
			                                        0 NOPAY_AMT,
			                                        0 SALE_RATE,
			                                        0 SALE_TRAN,
			                                        (B.SHIP_QTY * B.ORDER_DISCOUNT) SALE_ITEM,
			                                        h.contact_site contact_site
			                                        ,h.join_id
			                                   FROM LSSHPM A,
			                                        LSSHPD B,
			                                        ITASRT C,
			                                        CMVDMR G,
			                                        RMORDD D,
			                                        rmordm h
			                                  WHERE A.APPLY_DAY >= #{as_from_dt}
			                                    AND A.APPLY_DAY <= #{as_to_dt}
			                                    AND A.SITE_GB = '22'
			                                    AND A.SHIP_STATUS IN ('14')
			                                    AND A.SHIP_GB||'' IN ('11','12')
			                                    AND B.SHIP_ID = A.SHIP_ID
			                                    AND A.SITE_GB  LIKE #{as_service_gb}
			                                    AND B.SITE_GB  LIKE #{as_site_gb}
			                                    AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
			                                    AND C.ASSORT_ID = B.ASSORT_ID
			                                    AND C.VENDOR_ID = G.VENDOR_ID
			                                    AND G.EFF_END_DT = '99991231'
			                                    AND G.VD_TYPE_CD IN ('0423','0424')
			                                    AND D.ORDER_ID (+) = B.ORDER_ID
			                                    AND D.ORDER_SEQ (+) = B.ORDER_SEQ
			                                    and d.order_id = h.order_id
			                            UNION ALL
			                            SELECT /*+ ORDERED USE_NL(A B C D) INDEX(A LSSHPM_IND1)
			                                       USE_HASH(G) */
			                                    '22.몰매출-사입-반품'   DATA_GB,
			                                    FLS0039P(B.ORDER_ID,B.ORDER_SEQ,B.ASSORT_ID)            ORDER_DT,
			                                    A.STORAGE_ID        STORAGE_ID,
			                                    A.SHIP_ID    SHIP_ID,
			                                    B.SHIP_SEQ   SHIP_SEQ,
			                                    A.SHIP_GB    SHIP_GB,
			                                    B.SITE_GB SITE_GB,
			                                    A.APPLY_DAY     APPLY_DAY,
			                                    A.APPLY_time     APPLY_time,
			                                    B.ORDER_ID,
			                                    B.ORDER_SEQ,
			                                    B.SHIP_VENDOR_ID    VENDOR_ID,  /* 납품거래처 */
			                                    B.ASSORT_ID ASSORT_ID,
			                                    B.ORDER_ITEM_ID ITEM_ID,
			                                    B.SHIP_QTY QTY,
			                                    (
			                                    SELECT /*+ ORDERED USE_NL(R S) INDEX( R RMORDD_PK) INDEX( S RMORDD_PK) */
			                                           COUNT(*)
			                                      FROM RMORDD R,
			                                           RMORDD S
			                                     WHERE B.ORDER_ID = R.ORDER_ID
			                                       AND B.ORDER_SEQ = R.ORDER_SEQ
			                                       AND R.ORDER_ID = S.ORDER_ID
			                                       AND R.SET_ORDER_SEQ = S.SET_ORDER_SEQ
			                                    ) SET_QTY,
			                                    B.SHIP_QTY * B.ORDER_DISCOUNT   ORDER_DISCOUNT,
			                                    B.SALE_COST,
			                                    0 CUSTOMS_TAX,
			                                    0 NOPAY_AMT,
			                                    0 SALE_RATE,
			                                    0 SALE_TRAN,
			                                    (B.SHIP_QTY * B.ORDER_DISCOUNT) SALE_ITEM,
			                                    h.contact_site contact_site
			                                    ,h.join_id
			                               FROM LSSHPM A,
			                                    LSSHPD B,
			                                    ITASRT C,
			                                    CMVDMR G,
			                                    RMORDD D,
			                                    rmordm h
			                              WHERE A.APPLY_DAY >= #{as_from_dt}
			                                AND A.APPLY_DAY <= #{as_to_dt}
			                                AND A.SITE_GB = '22'
			                                AND A.SHIP_STATUS IN ('24')
			                                AND A.SHIP_GB||'' IN ('21','22')
			                                AND B.SHIP_ID = A.SHIP_ID
			                                AND A.SITE_GB  LIKE #{as_service_gb}
			                                AND B.SITE_GB  LIKE #{as_site_gb}
			                                AND nvl(B.ORDER_DISCOUNT,0) + nvl(B.SHIP_QTY,0) <> 0
			                                AND C.ASSORT_ID = B.ASSORT_ID
			                                AND C.VENDOR_ID = G.VENDOR_ID
			                                AND G.EFF_END_DT = '99991231'
			                                AND G.VD_TYPE_CD IN ('0423','0424')
			                                AND D.ORDER_ID (+) = B.ORDER_ID
			                                AND D.ORDER_SEQ (+) = B.ORDER_SEQ
			                                and d.order_id = h.order_id
			                                ) X,
			                                ITASRT Z,
			                                CMCODE B
			                        WHERE   X.ASSORT_ID   = Z.ASSORT_ID
			                        AND     X.SITE_GB     = B.CD_MINOR
			                        AND     B.CD_MAJOR    = '0072'
			                        AND     B.CD_FR_MINOR = '20'
			                        AND     B.CD_END_DT   = '99991231235959'
			                    GROUP BY    X.SITE_GB, Z.DISP_CATEGORY_ID, X.DATA_GB,x.contact_site,x.join_id,z.vendor_id,z.brand_id,z.assort_id,z.assort_nm,z.assort_model, x.order_id,x.order_seq          
			                    ,x.apply_day,x.apply_time
			                    ) A
			                ) A
			        GROUP BY    VENDOR_ID, DISP_CATEGORY_ID,contact_site,join_nm,vendor_id_n,brand_id_n,assort_id_n,assort_nm_n,assort_model_n, order_id ,order_seq          
			        ,apply_day,apply_time
			) A
			,cmvdmr b
			where a.vendor_id_n =b.vendor_id(+)
			and '99991231' = b.eff_end_dt(+)
			GROUP BY a.VENDOR_ID,a.DISP_B_CATEGORY_NM, a.DISP_M_CATEGORY_NM,a.DISP_S_CATEGORY_NM,a.contact_site,a.join_nm,a.vendor_id_n,a.brand_id_n,a.assort_id_n,a.assort_nm_n,a.assorT_model_n          
			 ,a.apply_day
			 ,a.apply_time
			,b.vd_nm
			,b.VD_INTERNATIONAL_GB
			,b.VD_SELLER_GB       
			,b.VD_GB       
			,a.MOBILE_ORDER_YN       
			, a.order_id ,a.order_seq 
			) aa
			where aa.order_qty > 0
			and aa.apply_day >='20190101'
			]]>
		  
		  </select>	

	
	
		  <select id="select_order_list"  resultType="java.util.LinkedHashMap">
		  <![CDATA[ 
				select xx.site_gb site 
				,xx.contact_site purchase_site
				,xx.join_nm affiliate
				,xx.vd_nm account_id
				,xx.vendor_id account
				,xx.brand_nm brand_id
				,xx.brand_id brand
				,xx.cat1 large_category
				,xx.cat2 medium_category
				,xx.cat3 small_category
				,xx.cat4 tiny_category
				,xx.user_nm md
				,substr(xx.item_cd,1,9) product_code
				,substr(xx.item_cd,10,4) property_code
				,xx.order_id beq_order_id
				,xx.order_seq beq_order_seq
				,xx.order_status status
				,xx.item_nm product
				,xx.variation_nm1 property_1
				,xx.variation_nm2 property_2
				,xx.order_qty quantity
				,xx.sale_rprice amount
				,xx.point saving
				,xx.vendor company
				,xx.md sales
				,xx.marketing marketing
				,xx.vendor + xx.md + xx.marketing coupon_total
				,xx.md + xx.marketing coupon_sales_marketing
				,decode(xx.site_gb_n,'22', sun_order_amt * magin_rate /100/1.1
				,'24', sun_order_amt * magin_rate /100/1.1
				,'26', sun_order_amt * magin_rate /100/1.1
				,'28', sun_order_amt * magin_rate /100/1.1
				,sun_order_amt * magin_rate /100
				) gm
				,xx.magin_rate gm_percentage
				,xx.coupon coupon
				,xx.etc etc
				,to_char(to_timestamp(xx.reg_dt,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') created_at
				from (
				select /* 상품별 수주현황 - 일별  [RM110109LP] */
				x.order_id,x.order_Seq,
				       x.order_dt, x.item_cd, x.category_nm
				     ,upper(decode(site_gb,'22','WIZMALL','23','WIZSHOP','24','SKINRX','25','hauolin-shop','26','hauolin-MALL','27','sports25-shop','28','sports25-mall','29','beauty-shop','etc')) site_gb
				     ,site_gb site_gb_n
				    ,vendor_id
				     ,vd_nm
				     , nvl(cat_nm_1,upper(decode(site_gb,'22','WIZMALL','23','WIZSHOP','24','SKINRX','25','hauolin-shop','26','hauolin-mall','27','sports25-shop','28','sports25-mall','29','beauty-shop','etc'))) cat1
				 ,      nvl(cat_nm_2         ,upper(decode(site_gb,'22','WIZMALL','23','WIZSHOP','24','SKINRX','25','hauolin-shop','26','hauolin-mall','27','sports25-shop','28','sports25-mall','29','beauty-shop','etc'))) cat2
				,      cat_nm_3 cat3
				,      cat_nm_4 cat4 
				,decode(contact_site,'10','WIZWID','20','SKINRX','30','HAUOLIN','40','SPORTS25') contact_site ,           
				       nvl(min(nvl(x.brand_nm,' ')),0)      brand_nm,
				       nvl(min(nvl(x.item_nm,' ')),0)       item_nm,
				       nvl(min(nvl(x.variation_nm1,' ')),0) variation_nm1,
				       nvl(min(nvl(x.variation_nm2,' ')),0) variation_nm2,
				       nvl(sum(nvl(x.order_qty,0)),0)     order_qty,
				       nvl(sum(nvl(x.sale_rprice,0)),0)   sale_rprice,
				       nvl(sum(nvl(x.cancel_qty,0)),0)    cancel_qty,
				       nvl(sum(nvl(x.cancel_amt,0)),0)    cancel_amt,         
				       nvl(sum(nvl(x.cust_cancel_qty,0)),0)    cust_ancel_qty,
				       nvl(sum(nvl(x.cust_cancel_amt,0)),0)    cust_cancel_amt,
				       nvl(sum(nvl(x.return_qty,0)),0)    return_qty,
				       nvl(sum(nvl(x.return_amt,0)),0)    return_amt,
				       nvl(sum(nvl(x.order_qty,0)), 0) + nvl(sum(nvl(x.cust_cancel_qty,0)),0) + nvl(sum(nvl(x.cancel_qty,0)), 0) + nvl(sum(nvl(x.return_qty,0)), 0)   sun_order_qty,
				       nvl(sum(nvl(x.sale_rprice,0)), 0) + nvl(sum(nvl(x.cust_cancel_amt,0)),0) + nvl(sum(nvl(x.cancel_amt,0)), 0) + nvl(sum(nvl(x.return_amt,0)), 0) sun_order_amt
				     ,max(aa1) order_status
				     ,sum(nvl(aa2,0)) coupon
				     ,sum(nvl(aa3,0)) point
				     ,ftm0008p(substr(x.item_cd,1,9),substr(x.item_cd,10,4),min(min_reg_dt),min(decode(site_gb,'22','22','23','23','24','22','25','23','26','22','27','23','28','22','29','23'))) magin_rate
				     ,sum(nvl(aa4,0)) vendor
				     ,sum(nvl(aa5,0)) md
				     ,sum(nvl(aa6,0)) marketing
				    ,sum(nvl(aa7,0)) etc
				     ,(select xx.user_nm from cmuser xx where xx.user_id = x.user_id) user_nm
				,decode(site_gb,'21','ADDRESS','22','MALL','23','SHOP','24','MALL','25','SHOP','26','MALL','27','SHOP','28','MALL','29','SHOP') site
				,brand_id 
				,reg_Dt
				,join_nm
				from  (select /*+ ordered index(a rmordd_ind3) use_nl(a b c d f h i j k l m) */
				
				              a.order_id,a.order_Seq,
				              a.site_gb,
				              a.order_dt,
				              a.category_id,
				              decode(l.contact_type,'04','WIZFAMILY',NVL((select join_nm 
				                                                          from   MKJONM MK 
				                                                          where  MK.join_id    = l.join_id 
				                                                          ),'WIZWID')) category_nm,
				              c.user_id, d.user_nm, a.assort_id||a.item_id item_cd, j.brand_enm brand_nm, b.item_nm,
				              h.option_nm variation_nm1,
				              i.option_nm variation_nm2,
				              case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then a.order_qty
				              end                                                             order_qty,
				              case when a.order_ret_gb in ('11', '12', '13', '14', '16') then case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                                             from   rmordd k
				                                                                                                                                                             where  k.order_id = a.order_id
				                                                                                                                                                             and    k.set_order_seq = a.order_seq)
				                                                                                   else a.order_qty * a.sale_rprice
				                                                                              end
				              end                                                             sale_rprice,
				              decode(a.order_ret_gb, '15',decode(nvl(m.cancel_gb,'XX')
				                                                            ,'94',a.order_qty
				                                                            ,'72',a.order_qty
				                                                            ,'73',a.order_qty
				                                                            ,'74',a.order_qty
				                                                            ,'60',a.order_qty
				                                                            ,'10',a.order_qty
				                                                            ,'11',a.order_qty
				                                                            ,'12',a.order_qty
				                                                            ,'20',a.order_qty
				                                                            ,'30',a.order_qty
				                                                            ,'31',a.order_qty
				                                                            ,'32',a.order_qty
				                                                            ,'38',a.order_qty
				                                                                                ,'XX',a.order_qty
				                                                            ,0))                       cust_cancel_qty,
				              case when a.order_ret_gb = '15' then case when nvl(m.cancel_gb,'XX') = '94' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end
				                                                        when nvl(m.cancel_gb,'XX') = '72' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end 
				                                                        when nvl(m.cancel_gb,'XX') = '73' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end                                                                                                                                                       
				                                                        when nvl(m.cancel_gb,'XX') = '74' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end 
				                                                        when nvl(m.cancel_gb,'XX') = '60' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end                                                                                                                                                       
				                                                        when nvl(m.cancel_gb,'XX') = '10' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end
				                                                        when nvl(m.cancel_gb,'XX') = '11' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end  
				                                                        when nvl(m.cancel_gb,'XX') = '12' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end 
				                                                        when nvl(m.cancel_gb,'XX') = '20' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end 
				                                                        when nvl(m.cancel_gb,'XX') = '30' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end  
				                                                        when nvl(m.cancel_gb,'XX') = '31' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end   
				                                                        when nvl(m.cancel_gb,'XX') = '32' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end
				                                                        when nvl(m.cancel_gb,'XX') = '38' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
				                                                        when nvl(m.cancel_gb,'XX') = 'XX' then 
				                                                                            case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
				                                                                        else 0
				                                                                        end 
				              end                                                             cust_cancel_amt,
				              decode(a.order_ret_gb, '15',decode(nvl(m.cancel_gb,'XX')
				                                                            ,'94',0
				                                                            ,'72',0
				                                                            ,'73',0
				                                                            ,'74',0
				                                                            ,'60',0
				                                                            ,'10',0
				                                                            ,'11',0
				                                                            ,'12',0
				                                                            ,'20',0
				                                                            ,'30',0
				                                                            ,'31',0
				                                                            ,'32',0
				                                                            ,'38',0
				                                                            ,'XX',0
				                                                            ,a.order_qty))                       cancel_qty,
				              case when a.order_ret_gb = '15' then case when nvl(m.cancel_gb,'XX') = '94' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '72' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '73' then 0                                                                                                                                                   
				                                                        when nvl(m.cancel_gb,'XX') = '74' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '60' then 0                                                                                                                                                   
				                                                        when nvl(m.cancel_gb,'XX') = '10' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '11' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '12' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '20' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '30' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '31' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '32' then 0
				                                                        when nvl(m.cancel_gb,'XX') = '38' then 0
				                                                        when nvl(m.cancel_gb,'XX') = 'XX' then 0
				                                                                        else 
				                                                                                                                                                    case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                 from   rmordd k
				                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                                                                                  else a.order_qty * a.sale_rprice
				                                                                            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
				                                                                        end 
				              end                                                             cancel_amt,
				              case when substr(a.order_ret_gb, 1, 1) = '2'               then a.order_qty
				              end                                                             return_qty,
				              case when a.order_ret_gb in ('21', '22', '23', '24', '25') then 
				                  case when a.set_gb in ('01','02') then (select sum(k.order_qty * k.sale_rprice)
				                                                                                                                                                                 from   rmordd k
				                                                                                                                                                                 where  k.order_id = a.order_id
				                                                                                                                                                                 and    k.set_order_seq = a.order_seq)
				                  else
				                  a.order_qty * a.sale_rprice
				                  end
				              end                                                             return_amt,
				             case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				             '수주'
				              when a.order_ret_gb in ('15') then
				              '취소'
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              '반품'
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              '반품취소'
				              end                                                             aa1              
				         
				             ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select sum(xx.amt_real) 
				                     from rmdmdl xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     and xx.inout_gb ='01'
				                     and xx.pay_cd ='13'
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select sum(xx.amt_real)  * -1
				                     from rmdmdl xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     and xx.inout_gb ='01'
				                     and xx.pay_cd ='13'
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select sum(xx.amt_real)  * -1
				                    from rmdmdl xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    and xx.inout_gb ='01'
				                    and xx.pay_cd ='13'
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select sum(xx.amt_real) 
				                    from rmordd yy,rmdmdl xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    and xx.inout_gb ='01'
				                    and xx.pay_cd ='13'
				                    )              
				              
				              
				              end                                                             aa2
				             ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select sum(xx.amt_real) 
				                     from rmdmdl xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     and xx.inout_gb ='01'
				                     and xx.pay_cd ='10'
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select sum(xx.amt_real)  * -1
				                     from rmdmdl xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     and xx.inout_gb ='01'
				                     and xx.pay_cd ='10'
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select sum(xx.amt_real)  * -1
				                    from rmdmdl xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    and xx.inout_gb ='01'
				                    and xx.pay_cd ='10'
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select sum(xx.amt_real) 
				                    from rmordd yy,rmdmdl xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    and xx.inout_gb ='01'
				                    and xx.pay_cd ='10'
				                    )              
				              
				              
				              end                                                             aa3     
				             ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select min(xx.reg_dt) 
				                     from rmordd xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select min(xx.reg_dt) 
				                     from rmordd xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select min(xx.reg_dt)
				                    from rmordd xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select min(xx.reg_dt)
				                    from rmordd yy,rmordd xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    )              
				           
				              
				              end                                                             min_reg_dt 
				            ,c.vendor_id
				              ,(select max(xx.vd_nm) from cmvdmr xx where xx.vendor_id = c.vendor_id) vd_nm
				              ,(select gg.category_nm from itcatg xx,itcatg yy,itcatg zz,itcatg gg where xx.category_id = c.disp_category_id and xx.up_category_id = yy.category_id and yy.up_category_id = zz.category_id and zz.up_category_id = gg.category_id )  cat_nm_1        
				              ,(select zz.category_nm from itcatg xx,itcatg yy,itcatg zz where xx.category_id = c.disp_category_id and xx.up_category_id = yy.category_id and yy.up_category_id = zz.category_id )  cat_nm_2              
				              ,(select yy.category_nm from itcatg xx,itcatg yy where xx.category_id = c.disp_category_id and xx.up_category_id = yy.category_id )  cat_nm_3                      
				              ,(select xx.category_nm from itcatg xx where xx.category_id = c.disp_category_id)  cat_nm_4
				              
				              
				            ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select sum(xx.vendor_amt) 
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     and xx.md_gb='01'
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select sum(xx.vendor_amt)   * -1
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     and xx.md_gb='01'
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select sum(xx.vendor_amt)   * -1
				                    from ORDER_COUPON@wizwiddw xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    and xx.md_gb='01'
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select sum(xx.vendor_amt) 
				                    from rmordd yy,ORDER_COUPON@wizwiddw xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    and xx.md_gb='01'
				                    
				                    )              
				              
				              
				              end                                                             aa4 
				            ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select sum(xx.burden_amt) 
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     and xx.md_gb='01'
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select sum(xx.burden_amt)   * -1
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     and xx.md_gb='01'
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select sum(xx.burden_amt)   * -1
				                    from ORDER_COUPON@wizwiddw xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    and xx.md_gb='01'
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select sum(xx.burden_amt) 
				                    from rmordd yy,ORDER_COUPON@wizwiddw xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    and xx.md_gb='01'
				                    
				                    )              
				              
				              
				              end                                                             aa5       
				            ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select sum(xx.coupon_amt) 
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     and xx.md_gb in ('02','03')
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select sum(xx.coupon_amt)   * -1
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     and xx.md_gb in ('02','03')
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select sum(xx.coupon_amt)   * -1
				                    from ORDER_COUPON@wizwiddw xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    and xx.md_gb in ('02','03')
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select sum(xx.coupon_amt) 
				                    from rmordd yy,ORDER_COUPON@wizwiddw xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    and xx.md_gb in ('02','03')
				                    
				                    )              
				              
				              
				              end                                                             aa6         
				           ,case when a.order_ret_gb in ('11', '12', '13', '14', '16') and nvl(a.set_gb,'99') not in ('06') then
				             
				                     (select sum(xx.coupon_amt) 
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.order_id 
				                     and xx.order_seq = a.order_seq
				                     and xx.md_gb in ('04')
				                     )
				              when a.order_ret_gb in ('15') then
				              
				                      (select sum(xx.coupon_amt)   * -1
				                     from ORDER_COUPON@wizwiddw xx
				                     where xx.order_id = a.bef_order_id 
				                     and xx.order_seq = a.bef_order_seq
				                     and xx.md_gb in ('04')
				                     )
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb <> '25'            then 
				              
				                    (select sum(xx.coupon_amt)   * -1
				                    from ORDER_COUPON@wizwiddw xx
				                    where xx.order_id = a.bef_order_id 
				                    and xx.order_seq = a.bef_order_seq
				                    and xx.md_gb in ('04')
				                    )              
				              
				              
				              when substr(a.order_ret_gb, 1, 1) = '2'  and  a.order_ret_gb = '25'            then 
				              
				              
				                    (select sum(xx.coupon_amt) 
				                    from rmordd yy,ORDER_COUPON@wizwiddw xx
				                    where yy.order_id =   a.bef_order_id
				                     and yy.order_seq =   a.bef_order_seq  
				                    and xx.order_id = yy.bef_order_id
				                    and xx.order_seq = yy.bef_order_seq
				                    and xx.md_gb in ('04')
				                    
				                    )              
				              
				              
				              end          aa7,         
				                FIT0017P(c.DISP_CATEGORY_ID,1,'02') DISP_B_CATEGORY_NM,
				                FIT0017P(c.DISP_CATEGORY_ID,2,'02') DISP_M_CATEGORY_NM,
				                FIT0017P(c.DISP_CATEGORY_ID,3,'02') DISP_S_CATEGORY_NM,
				                l.contact_site,
				                c.brand_id      
				              ,l.reg_dt
				              ,NVL((select join_nm 
				                                from   MKJONM MK 
				                                where  MK.join_id    = l.join_id 
				                                AND    MK.balance_gb = '02'
				                                and    MK.adjst_cd   = '05'
				                                and    MK.join_path  = '01'
				                                and    MK.join_type  IN ('03','13')
				                                and    MK.up_join_id = '*'
				                                ),'WIZWID') join_nm                                          
				     from   rmordd a, ititmm b, itasrt c, cmuser d, mkprmd f,
				              itvari h, itvari i, itbrnd j,
				              VCD00720 K, rmordm l,rmords m
				       where  /* a.site_gb       like substr(as_site_gb,1,1)||'%' and a.vendor_id     like as_vendor_id||'%' */
				              a.site_gb in (SELECT A.CD_MINOR FROM CMCODE A
				                            WHERE  A.CD_MAJOR    = '0072'
				                            AND    A.CD_FR_MINOR = '20'
				                            AND    A.CD_MINOR    <> '21'
				                            AND    #{as_service_gb}   = '00'
				                            AND    #{as_site_gb}      = '00' 
				                            UNION ALL
				                            SELECT A.CD_MINOR FROM CMCODE A
				                            WHERE  A.CD_MAJOR    = '0072'
				                            AND    A.CD_FR_MINOR = '20'
				                            AND    A.CD_MINOR    <> '21'
				                            AND    #{as_service_gb}   = '00'
				                            AND    #{as_site_gb}     != '00' 
				                            AND    A.CD_MINOR    = #{as_site_gb}
				                            UNION ALL
				                            SELECT A.CD_MINOR FROM CMCODE A
				                            WHERE  A.CD_MAJOR    = '0072'
				                            AND    A.CD_FR_MINOR = '20'
				                            AND    A.CD_MINOR    <> '21'
				                            AND    #{as_service_gb}  != '00'
				                            AND    #{as_site_gb}      = '00'
				                            AND    A.CD_REF2     = #{as_service_gb}
				                            UNION ALL
				                            SELECT A.CD_MINOR FROM CMCODE A
				                            WHERE  A.CD_MAJOR    = '0072'
				                            AND    A.CD_FR_MINOR = '20'
				                            AND    A.CD_MINOR    <> '21'
				                            AND    #{as_service_gb}  != '00'
				                            AND    #{as_site_gb}     != '00'
				                            AND    A.CD_MINOR    = #{as_site_gb}
				                            AND    A.CD_REF2     = #{as_service_gb}
				                           )    
				       and    a.order_dt      between #{as_from_dt} and #{as_to_dt}
				       and a.order_ret_gb like '1%'
				       and a.order_ret_gb <>  '15'
				       and    a.set_order_seq is null
				       and    b.assort_id     = a.assort_id
				       and    b.item_id       = a.item_id
				       and    c.assort_id     = a.assort_id
				       and    d.user_id       = c.user_id
				       and    c.brand_id      = j.brand_id(+)
				       and    decode(a.order_item_gb,'02',a.category_id) = f.catalog_no(+)
				       and    h.assort_id(+)  = b.assort_id
				       and    h.seq(+)        = b.variation_seq1
				       and    h.option_gb(+)  = b.variation_gb1
				       and    i.assort_id (+) = b.assort_id
				       and    i.seq (+)       = b.variation_seq2
				       and    i.option_gb(+)  = b.variation_gb2
				       and    a.site_gb       = K.cd_minor
				       and    a.order_id          = l.order_id
				              and    a.order_id = m.order_id
				       and    a.order_seq = m.order_seq
				       and    m.eff_end_dt = '99991231235959'
				       and    not exists (select /*+ index (z rmdmdm_ind1) */
				                                 z.order_id
				                          from   rmdmdm z
				                          where  z.order_id = a.order_id
				                          and    z.demand_status = '31')
				                         ) x
				group by x.order_id,x.order_seq,x.order_dt, x.item_cd, x.category_nm,vendor_id,vd_nm 
				,upper(decode(site_gb,'22','WIZMALL','23','WIZSHOP','24','SKINRX','25','hauolin-shop','26','hauolin-MALL','27','sports25-shop','28','sports25-mall','29','beauty-shop','etc'))
				     , nvl(cat_nm_1,upper(decode(site_gb,'22','WIZMALL','23','WIZSHOP','24','SKINRX','25','hauolin-shop','26','hauolin-mall','27','sports25-shop','28','sports25-mall','29','beauty-shop','etc')))
				,      nvl(cat_nm_2         ,upper(decode(site_gb,'22','WIZMALL','23','WIZSHOP','24','SKINRX','25','hauolin-shop','26','hauolin-mall','27','sports25-shop','28','sports25-mall','29','beauty-shop','etc')))
				,      cat_nm_3
				,      cat_nm_4
				,x.user_id
				,decode(site_gb,'21','ADDRESS','22','MALL','23','SHOP','24','MALL','25','SHOP','26','MALL','27','SHOP','28','MALL','29','SHOP')
				,decode(contact_site,'10','WIZWID','20','SKINRX','30','HAUOLIN','40','SPORTS25')
				,brand_id
				,site_gb
				,reg_dt
				,join_nm
				) xx  	
				
				]]>
		 </select> 	 	
	
	
	
	  	 
	
	  	 		 
	
</mapper>